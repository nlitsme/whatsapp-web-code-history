/*! Copyright (c) 2023 WhatsApp Inc. All Rights Reserved. */
(self.webpackChunkwhatsapp_web_client=self.webpackChunkwhatsapp_web_client||[]).push([[9916],{219916:(e,n,t)=>{"use strict";var o=t(595318);Object.defineProperty(n,"__esModule",{value:!0}),n.impressionOnQuickPromotion=void 0;var i=o(t(81109)),s=o(t(348926)),r=t(400538),u=t(193182),a=t(658265),p=t(732011);function c(){return(c=(0,s.default)((function*(e,n){let{id:t,ts:o}=n;const i=yield(0,r.sendEventRPC)({eventType:"impression",eventPromotionId:t,eventTimestampSec:o,eventLogdata:""});"EventResponseSuccess"!==i.name&&(i.name,__LOG__(4,void 0,new Error)`impressionOnQuickPromotion: unable to log`)}))).apply(this,arguments)}const l=(0,u.defineWebPersistedJob)().step("saveToDb",(function(e){let{id:n,ts:t}=e;return(0,p.getStorage)().lock(["quick-promotions"],function(){var e=(0,s.default)((function*(e){let[o]=e;const s=yield o.get(n);if(null==s)return void __LOG__(3)`impressionOnQuickPromotion: promotion not found`;const r=(0,i.default)((0,i.default)({},s.tracking),{},{impressions:s.tracking.impressions+1}),{lastImpressionTs:u}=r;(null==u||t>u)&&(r.lastImpressionTs=t),yield o.merge(n,{tracking:r})}));return function(){return e.apply(this,arguments)}}()).then(a.loadQuickPromotions)})).finalStep("reportToComms",(function(){return c.apply(this,arguments)})).end();n.impressionOnQuickPromotion=l}}]);
//# sourceMappingURL=https://web.whatsapp.com/9916.7cdc9dfcbb56497ecd89.js.map
