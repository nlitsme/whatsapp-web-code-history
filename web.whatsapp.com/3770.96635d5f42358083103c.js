/*! Copyright (c) 2022 WhatsApp Inc. All Rights Reserved. */
(self.webpackChunkwhatsapp_web_client=self.webpackChunkwhatsapp_web_client||[]).push([[3770],{63770:(e,t,n)=>{"use strict";var l=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{chat:t}=e;const[n,l]=(0,o.useState)($.ORDER_SUMMARY),[a,i]=(0,o.useState)([]),[d,c]=(0,o.useState)(null),[m,f]=(0,o.useState)(!1),h=(0,s.hasCatalog)(u.BusinessProfileCollection.get((0,R.getMaybeMeUser)())),p=(0,r.default)((()=>{b.Cmd.closeDrawerRight()})),g=()=>{a.length>0?J(p):p()},x=()=>{l($.ORDER_SUMMARY)},j=()=>{l($.CATALOG_PRODUCTS_FORM)},y=(e,t)=>{f(!0===t),c(Number.isInteger(e)?e:null),l($.CUSTOM_ITEM_FORM)},C=e=>{i((t=>[...t.slice(0,e),...t.slice(e+1)]))},k=e=>{null!=d?((e,t)=>{i((n=>[...n.slice(0,t),e,...n.slice(t+1)]))})(e,d):(e=>{i((t=>[...t,e]))})(e)},S=e=>{i((t=>{const n=t.reduce(((e,t,n)=>e.set(t.id,n)),new Map),l=t.length;return[...t.filter((e=>e.isCustom)),...e].sort(((e,t)=>{var r,a;return(null!==(r=n.get(e.id))&&void 0!==r?r:l)-(null!==(a=n.get(t.id))&&void 0!==a?a:l)}))})),x()},_=X.indexOf(n);if(!n)return null;return(0,Q.jsx)(G.default,{children:(0,Q.jsx)(z.UIE,{displayName:`FlowDrawer${_}`,escapable:!0,requestDismiss:function(){p()},children:(0,Q.jsx)("div",{children:function(e){switch(e){case $.CATALOG_PRODUCTS_FORM:return(0,Q.jsx)(le,{orderProducts:a,onBack:x,onAddProdutcs:S,onAddCustomItem:()=>{y(null,!0)}});case $.CUSTOM_ITEM_FORM:return(0,Q.jsx)(ne,{onBack:m?j:x,onSaveCustomItem:e=>{k(e),x()},customItem:a[Number.isInteger(d)?Number(d):-1]});case $.ORDER_SUMMARY:return(0,Q.jsx)(re,{chat:t,onBack:g,customItems:a,onAddItem:h?j:y,onDeleteItem:C,onEditCustomItem:y,onEditCatalogItem:j})}}(n)})},_)})};var r=l(n(51463)),a=n(28298),i=n(48360),o=n(67294),d=l(n(56720)),u=n(93581),s=n(94010),c=l(n(39770)),m=l(n(39864)),f=n(99989),h=n(64481),p=l(n(44356)),g=l(n(90233)),b=n(88102),x=l(n(52665)),j=n(79502),y=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=Y(t);if(n&&n.has(e))return n.get(e);var l={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var i=r?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(l,a,i):l[a]=e[a]}l.default=e,n&&n.set(e,l);return l}(n(74764)),C=l(n(52814)),k=l(n(60453)),S=l(n(69637)),_=n(94790),v=l(n(33308)),M=n(47915),A=l(n(44942)),T=l(n(30855)),I=n(29623),R=n(99234),P=l(n(48456)),w=n(57701),D=l(n(26757)),E=l(n(18985)),O=l(n(42116)),N=l(n(82240)),B=(l(n(96152)),n(9468)),F=l(n(88990)),L=n(3013),q=l(n(23217)),U=n(13923),W=n(90011),z=n(18644),H=l(n(59909)),V=l(n(59552)),G=l(n(41956)),Q=n(85893);function Y(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Y=function(e){return e?n:t})(e)}const $=n(54302).Mirrored(["CATALOG_PRODUCTS_FORM","CUSTOM_ITEM_FORM","ORDER_SUMMARY"]),X=Array.from($.members()),K={drawerBody:{backgroundColor:"ihvf49ua"},buttonContainer:{display:"p357zi0d",flexDirection:"f8m0rgwh",alignItems:"gndfcl4n"},iconContainer:{display:"p357zi0d",alignItems:"gndfcl4n",width:"dyxdk6fi",height:"m3o1wsh7",borderTopStartRadius:"bbr44loe",borderTopEndRadius:"ooj5yc5b",borderBottomEndRadius:"m8i16etx",borderBottomStartRadius:"cw0ivh8j",backgroundColor:"lzol1dln"},iconSVG:{marginTop:"m3ct2rho",marginEnd:"k1jo73ug",marginBottom:"ec1z5skj",marginStart:"isfiuinm",color:"s4recxw2"},orderFieldsContainer:{gap:"sxkbojvh"},clickableText:{color:"o0rubyzf",cursor:"ajgl1lbb"},catalogBar:{borderTop:"gq6acybq",borderEnd:"toel9vei",borderBottom:"eyd9s9cm",borderStart:"ap1jplnr"},catalogTitleText:{fontWeight:"m1e7cby3",lineHeight:"a4ywakfo",color:"q70jrbp7"},orderTotal:{display:"p357zi0d",flexDirection:"sap93d0t",justifyContent:"o4u7okr9",fontWeight:"nbipi2bn"}},Z=y.currencyForCountryShortcode((0,j.getCountryShortcodeByPhone)((0,R.getMeUser)().user)),J=e=>{b.Cmd.openModal((0,Q.jsx)(x.default,{title:i.fbt._("Discard changes?",null,{hk:"2aroAx"}),onOK:()=>{b.Cmd.closeModal(),e()},okText:i.fbt._("Discard",null,{hk:"2rIxjp"}),onCancel:()=>b.Cmd.closeModal(),children:(0,Q.jsx)(U.TextDiv,{theme:"muted",children:i.fbt._("If you close this, your draft will be discarded.",null,{hk:"2Sbnur"})})}))};function ee(e){return Number.isInteger(e)&&+e>0}function te(e){const t=y.formatAmount1000ToParts(Z,e);return`${t.symbol}${t.integer}${t.decimal}`}function ne(e){let{customItem:t,onBack:n,onSaveCustomItem:l}=e;const[r,u]=(0,o.useState)(null==t?void 0:t.name),[s,m]=(0,o.useState)(Number.isInteger(null==t?void 0:t.priceAmount1000)?String(Number(null==t?void 0:t.priceAmount1000)/1e3):null),[f,h]=(0,o.useState)(Number(null==t?void 0:t.priceAmount1000)),[p,g]=(0,o.useState)(null==t?void 0:t.quantity),[b,x]=(0,o.useState)(Number.isInteger(null==t?void 0:t.quantity)?String(null==t?void 0:t.quantity):null),j=(0,o.useMemo)((()=>function(e){if(null==e)return"";const t=String(i.fbt._("Add a title",null,{hk:"3QauyV"}));return""===e.trim()?t:""}(r)),[r]),C=(0,o.useMemo)((()=>function(e){if(null==e)return"";const t=String(i.fbt._("Enter a valid price",null,{hk:"nzgo4"}));return""!==e.trim()&&y.validatePriceString(Z,e,B.MIN_PRICE,B.MAX_PRICE)?"":t}(s)),[s]),v=(0,o.useMemo)((()=>function(e){if(null==e)return"";const t=String(i.fbt._("Enter a valid quantity",null,{hk:"13oaEC"}));return ee(Number(e))?"":t}(b)),[b]);return(0,Q.jsxs)(k.default,{children:[(0,Q.jsx)(_.DrawerHeader,{title:t?i.fbt._("Update items",null,{hk:"8H9jW"}):i.fbt._("Add items",null,{hk:"2SjafD"}),type:_.DRAWER_HEADER_TYPE.SMALL,onBack:n,focusBackOrCancel:!0}),(0,Q.jsxs)(S.default,{className:(0,d.default)(K.drawerBody,a.uiPadding.all16),children:[(0,Q.jsx)(W.TextInput,{a8n:"product-edit-drawer-item-name-input",value:r,placeholder:i.fbt._("Item name",null,{hk:"1LDktG"}),onChange:e=>{u(e)},theme:"small",customStyleThemes:["desaturated"],maxLength:150,error:j}),(0,Q.jsx)(W.TextInput,{a8n:"product-edit-drawer-item-price-input",value:s,placeholder:i.fbt._("Price {symbol}",[i.fbt._param("symbol",y.formatAmount1000ToParts(Z,0).symbol)],{hk:"3yCPZW"}),onChange:e=>{const t=y.valueFromString(Z,e);h(t),m(e)},theme:"small",maxLength:30,customStyleThemes:["desaturated"],error:C}),(0,Q.jsx)(W.TextInput,{a8n:"product-edit-drawer-item-quantity-input",value:b,placeholder:i.fbt._("Quantity (Optional)",null,{hk:"30uF5W"}),onChange:e=>{let t=""===e?null:Number(e);ee(t)||(t=null),g(t),x(""===e?null:e)},theme:"small",maxLength:30,customStyleThemes:["desaturated"],error:v}),(0,Q.jsx)("div",{className:(0,d.default)(K.buttonContainer,a.uiMargin.top16),children:(0,Q.jsx)(c.default,{type:"primary",disabled:null==r||null==s||[j,C,v].some((e=>e)),onClick:()=>{const e={id:(null==t?void 0:t.id)||(0,P.default)(),media:null,name:r,priceAmount1000:f,quantity:p,isCustom:!0};l(e)},children:t?i.fbt._("Update",null,{hk:"iXFTM"}):i.fbt._("Add",null,{hk:"3ogfSW"})})})]})]})}function le(e){let{orderProducts:t,onBack:n,onAddProdutcs:l,onAddCustomItem:r}=e;const[u,s]=(0,o.useState)(0),[m,g]=(0,o.useState)(!0),[b,x]=(0,o.useState)(!1),j=(0,H.default)(),y=(0,V.default)((()=>new T.default)),C=()=>{const e=f.CatalogCollection.get((0,R.getMaybeMeUser)());if(!e)return[];return e.productCollection.getProductModels().map((e=>({itemKey:e.id.toString(),product:e})))},v=(0,V.default)((()=>new D.default([],(e=>e.id.toString())))).current,I=e=>{const t=v.isSelected(e);v.setVal(e,t?0:1),s(u+(t?-1:1)),b||x(!0),j()},P=(e,t)=>{v.setVal(e,t),b||x(!0),j()};(0,o.useEffect)((()=>{let e=0;C().forEach((n=>{const l=t.find((e=>e.id===n.product.id));void 0!==l&&(v.setVal(n.product,Number(l.quantity)),e+=1)})),j(),s(e),g(0===e)}),[t,v,j]);const E=v.getSelected().reduce(((e,t)=>e+(t.priceAmount1000||0)*Number(v.getVal(t))),0);return(0,Q.jsxs)(k.default,{children:[(0,Q.jsx)(_.DrawerHeader,{title:i.fbt._("Add items",null,{hk:"2nsVXo"}),type:_.DRAWER_HEADER_TYPE.SMALL,onBack:(m?u:b)?()=>{J(n)}:n,focusBackOrCancel:!0}),(0,Q.jsxs)(S.default,{children:[(0,Q.jsxs)(A.default,{className:(0,d.default)(K.drawerBody),flatListControllers:[y.current],children:[(0,w.orderDetailsCustomItemEnabled)()&&(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(p.default,{image:(0,Q.jsx)("div",{className:(0,d.default)(K.iconContainer),children:(0,Q.jsx)(q.default,{className:(0,d.default)(K.iconSVG),name:"add-item"})}),primary:i.fbt._("Add custom item",null,{hk:"DCIZF"}),theme:"add-order-item",onClick:r}),(0,Q.jsx)("hr",{className:(0,d.default)(K.catalogBar,a.uiMargin.top0)})]}),(0,Q.jsx)("p",{className:(0,d.default)(K.catalogTitleText,a.uiMargin.start15),children:i.fbt._("Catalog items",null,{hk:"2rgdJA"})}),(0,Q.jsx)(M.FlatList,{flatListController:y.current,direction:"vertical",forceConsistentRenderCount:!1,data:C(),renderItem:e=>{let{product:t}=e;return(0,Q.jsx)(ae,{product:t,selections:v,onProductClick:I,onProductQuantityChange:P})},defaultItemHeight:h.PRODUCT_LIST_ITEM_HEIGHT})]}),(0,Q.jsxs)("div",{className:(0,d.default)(K.drawerBody,a.uiPadding.all16,a.uiMargin.top10),children:[(0,Q.jsxs)("div",{className:(0,d.default)(K.orderTotal),children:[i.fbt._("Total",null,{hk:"pz5vA"}),(0,Q.jsx)("p",{children:te(E)})]}),(0,Q.jsx)("div",{className:(0,d.default)(K.buttonContainer,a.uiMargin.top16),children:(0,Q.jsx)(c.default,{type:"primary",disabled:m?0===u:!b,onClick:()=>{const e=v.getSelected().map((e=>({id:e.id,media:e.getPreviewImage(),name:e.name,priceAmount1000:e.priceAmount1000,quantity:Number(v.getVal(e))||null})));l(e)},children:m?i.fbt._("Add",null,{hk:"3ErADm"}):i.fbt._("Update",null,{hk:"2vxW5D"})})})]})]})]})}function re(e){let{chat:t,customItems:n,onBack:l,onAddItem:r,onDeleteItem:u,onEditCustomItem:s,onEditCatalogItem:m}=e;const[f,h]=(0,o.useState)(null),g=(0,Q.jsx)("div",{className:(0,d.default)(K.iconContainer),children:(0,Q.jsx)(q.default,{className:(0,d.default)(K.iconSVG),name:"add-item"})}),b=n.reduce(((e,t)=>{var n;return e+(t.priceAmount1000||0)*(null!==(n=t.quantity)&&void 0!==n?n:1)}),0),x=0!==n.length;return(0,Q.jsxs)(k.default,{children:[(0,Q.jsx)(_.DrawerHeader,{title:x?i.fbt._("Review Order",null,{hk:"1yDsQ1"}):i.fbt._("Create order",null,{hk:"3snLWG"}),onBack:l,type:_.DRAWER_HEADER_TYPE.SMALL}),(0,Q.jsxs)(S.default,{children:[(0,Q.jsx)(v.default,{xstyle:[a.uiPadding.top20,a.uiPadding.horiz16,a.uiPadding.bottom15],theme:"refresh-padding-title",children:(0,Q.jsxs)(E.default,{children:[(0,Q.jsx)(O.default,{sellerWid:(0,R.getMeUser)(),orderStatus:(0,Q.jsx)(N.default,{})}),(0,Q.jsxs)(I.FlexColumn,{align:"stretch",xstyle:a.uiMargin.horiz0,children:[(0,Q.jsx)(p.default,{image:g,primary:i.fbt._("Add item",null,{hk:"3uoH1r"}),theme:"add-order-item",onClick:r}),(()=>{const e=(0,Q.jsx)("div",{className:(0,d.default)(K.iconContainer),children:(0,Q.jsx)(q.default,{className:(0,d.default)(K.iconSVG),name:"list-msg-icon"})});return n.map(((t,n)=>{const l=null!=t.priceAmount1000?te(+t.priceAmount1000):"",r=i.fbt._("Quantity {item-quantity}",[i.fbt._param("item-quantity",t.quantity)],{hk:"39jSdf"}),o=null!=t.media?(0,Q.jsx)(L.ProductThumb,{mediaData:t.media.mediaData,theme:"squareThumb"}):null;return(0,Q.jsx)("div",{className:(0,d.default)(a.uiPadding.top20),children:(0,Q.jsx)(p.default,{image:null!=o?o:e,primary:t.name,secondary:null!=t.quantity?r:null,theme:"media",onMouseOver:()=>{h(n)},onMouseLeave:()=>{h(null)},detail:f===n&&!0===t.isCustom?(0,Q.jsx)(C.default,{onClick:e=>{e.stopPropagation(),u(n)}}):l,onClick:()=>{!0===t.isCustom?s(n):m()}})},n)}))})()]}),(0,Q.jsxs)(I.FlexColumn,{align:"stretch",xstyle:K.orderFieldsContainer,children:[(0,Q.jsxs)(I.FlexRow,{justify:"all",children:[(0,Q.jsx)(U.TextSpan,{color:"secondary",size:"16",children:i.fbt._("Subtotal",null,{hk:"4ciFet"})}),(0,Q.jsx)(U.TextSpan,{color:"secondary",size:"16",children:te(b)})]}),x&&(0,Q.jsx)(I.FlexRow,{justify:"all",align:"center",children:(0,Q.jsx)("span",{className:(0,d.default)(K.clickableText),children:i.fbt._("Additional Charges",null,{hk:"3I4vSr"})})})]}),x&&(0,Q.jsx)(I.FlexRow,{justify:"all",align:"center",children:(0,Q.jsx)("span",{className:(0,d.default)(K.clickableText),children:i.fbt._("Add payment method",null,{hk:"1FNuLD"})})})]})}),x&&(0,Q.jsxs)(v.default,{xstyle:[a.uiPadding.top20,a.uiPadding.horiz16],theme:"refresh-padding-title",children:[(0,Q.jsxs)("div",{className:(0,d.default)(K.orderTotal),children:[i.fbt._("Total",null,{hk:"4kHQl"}),(0,Q.jsx)("p",{children:te(b)})]}),(0,Q.jsx)("div",{className:(0,d.default)(K.buttonContainer,a.uiMargin.vert15),children:(0,Q.jsx)(c.default,{type:"primary",children:i.fbt._("Send Order",null,{hk:"3wTiM3"})})})]})]})]})}function ae(e){let{product:t,selections:n,onProductClick:l,onProductQuantityChange:r}=e;return(0,Q.jsx)(g.default,{model:t,selections:n,children:(0,Q.jsx)(F.default,{product:t,onClick:()=>l(t),checkbox:!0,detail:n.isSelected(t)&&(0,Q.jsx)("div",{children:(0,Q.jsx)(m.default,{quantity:Number(n.getVal(t)),onChange:e=>r(t,e)})})})},t.id.toString())}}}]);
//# sourceMappingURL=https://web.whatsapp.com/3770.96635d5f42358083103c.js.map
