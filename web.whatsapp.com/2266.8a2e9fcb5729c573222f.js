/*! Copyright (c) 2022 WhatsApp Inc. All Rights Reserved. */
(self.webpackChunkwhatsapp_web_client=self.webpackChunkwhatsapp_web_client||[]).push([[2266],{217810:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JobBuilder=void 0,t.definePersistedJob=function(){return new o([])};var n=r(814271),s=r(990445);class o{constructor(e){this.steps=e}step(e,t){return this._stepWithOptions(e,"function"==typeof t?{code:t}:t)}_stepWithOptions(e,t){const{stopRetryIf:r,requirements:d,code:u}=t;let p=a(d,u,r);if(r){const{timePassedSeconds:e,appCrashed:t,onStopRetry:o}=r,d=a(null,function(e){return(t,r,s)=>Promise.resolve(e(t,r,s)).then((e=>e instanceof n.InterruptJob?e:new n.InterruptJob(e)))}(o),r);null!=e&&(p=i(((t,r,n)=>{let{jobStartTime:o}=n;return(0,s.happenedWithin)(o,e)}),p,d)),t&&(p=i(((e,t,r)=>{let{afterCrash:n}=r;return!n}),p,d))}return new o([...this.steps,{stepName:e,info:p}])}finalStep(e,t){const r=this.step(e,t);return{end:()=>r.steps}}}function i(e,t,r){return(n,s,o)=>e(n,s,o)?t(n,s,o):r(n,s,o)}function a(e,t,r){const n={requirements:e,code:t,stopRetryIf:r};return()=>n}t.JobBuilder=o},193182:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defineWebPersistedJob=function(){return(0,n.definePersistedJob)()};var n=r(217810)},322266:(e,t,r)=>{"use strict";var n=r(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.rotateKey=void 0;var s=n(r(348926)),o=r(911794),i=r(738102),a=r(769707),d=r(403206),u=r(193182),p=r(9210),l=r(304834),c=r(165269),y=r(425137);const _=new a.WapParser("rotateKeyResponseParser",(e=>{e.assertFromServer()})),f=(0,u.defineWebPersistedJob)().step("uploadKeys",(0,s.default)((function*(){const e=yield l.waSignalStore.getRegistrationInfo().then((e=>{if(!e)throw new Error("No registration info is available");return l.waSignalStore.rotateSignedPreKey((0,d.toSignalCurveKeyPair)(e.identityKeyPair),c.generateSignedKeyPair)}));__LOG__(2)`rotateKey: signedPreKey uploading`;const t=(0,i.wap)("iq",{xmlns:"encrypt",type:"set",to:i.S_WHATSAPP_NET,id:(0,i.generateId)()},(0,i.wap)("rotate",null,(0,y.xmppSignedPreKey)(e))),r=yield(0,o.deprecatedSendIq)(t,_);if(r.success)return{shouldDigestKey:!1};let n=!1;const s=r.errorCode;return 406===s?__LOG__(3)`rotateKey generated bad key`:409===s?(__LOG__(3)`skey does not pass server validation`,n=!0):s>=500?__LOG__(2)`rotateKey server error ${s}, wait a day`:(__LOG__(2)`rotateKey unrecognized error ${s}`,n=!0),{shouldDigestKey:n}}))).finalStep("maybeDigestKey",(e=>{const{shouldDigestKey:t}=e;if(t)return(0,p.digestKey)()})).end();t.rotateKey=f}}]);
//# sourceMappingURL=https://web.whatsapp.com/2266.8a2e9fcb5729c573222f.js.map
