/*! Copyright (c) 2022 WhatsApp Inc. All Rights Reserved. */
(self.webpackChunkwhatsapp_web_client=self.webpackChunkwhatsapp_web_client||[]).push([[4106],{217810:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JobBuilder=void 0,t.definePersistedJob=function(){return new i([])};var n=s(814271),r=s(990445);class i{constructor(e){this.steps=e}step(e,t){return this._stepWithOptions(e,"function"==typeof t?{code:t}:t)}_stepWithOptions(e,t){const{stopRetryIf:s,requirements:d,code:l}=t;let c=a(d,l,s);if(s){const{timePassedSeconds:e,appCrashed:t,onStopRetry:i}=s,d=a(null,function(e){return(t,s,r)=>Promise.resolve(e(t,s,r)).then((e=>e instanceof n.InterruptJob?e:new n.InterruptJob(e)))}(i),s);null!=e&&(c=o(((t,s,n)=>{let{jobStartTime:i}=n;return(0,r.happenedWithin)(i,e)}),c,d)),t&&(c=o(((e,t,s)=>{let{afterCrash:n}=s;return!n}),c,d))}return new i([...this.steps,{stepName:e,info:c}])}finalStep(e,t){const s=this.step(e,t);return{end:()=>s.steps}}}function o(e,t,s){return(n,r,i)=>e(n,r,i)?t(n,r,i):s(n,r,i)}function a(e,t,s){const n={requirements:e,code:t,stopRetryIf:s};return()=>n}t.JobBuilder=i},193182:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defineWebPersistedJob=function(){return(0,n.definePersistedJob)()};var n=s(217810)},254106:(e,t,s)=>{"use strict";var n=s(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteReactionsV2=t.deleteAddOns=void 0;var r=n(s(348926)),i=s(798299),o=s(297673),a=s(728088),d=s(193182),l=s(980787),c=s(97858),u=n(s(565754)),p=s(172188),f=s(671598);const y=(0,d.defineWebPersistedJob)().finalStep("deleteAddOns",function(){var e=(0,r.default)((function*(e){let{chatId:t,parentMsgKeys:s}=e;const n=yield Promise.allSettled([_({chatId:t,parentMsgKeys:s}),v({chatId:t,parentMsgKeys:s})]);for(const e of n)if("rejected"===e.status)throw e.reason}));return function(){return e.apply(this,arguments)}}()).end();t.deleteAddOns=y;const h=(0,d.defineWebPersistedJob)().finalStep("deleteReactionsV2",(e=>{let{chatId:t,parentMsgKeys:s}=e;return _({chatId:t,parentMsgKeys:s})})).end();function _(){return b.apply(this,arguments)}function b(){return(b=(0,r.default)((function*(e){let{chatId:t,parentMsgKeys:s}=e;if(!(0,c.receiveReactionsEnabled)())return;__LOG__(2)`Persisted: deleteReactionsV2 persisted job started for ${t}`;const n=yield(0,o.getAllReactionsFromParentMsgs)(s),r=n.map((e=>e.msgKey));if(0===r.length)return void __LOG__(2)`Persisted: deleteReactionsV2 finished, no reactionsMsgKeys`;const d=[];r.forEach((e=>{u.default.fromString(e).fromMe&&d.push(e)})),d.length>0&&(yield(0,a.removeMessagesFromHistory)(d));const p=n.map((e=>[e.parentMsgKey,e.senderUserJid]));yield(0,i.deleteReactionsByRecords)(p),yield(0,l.deleteDatabaseForLastReactionPreview)(s),__LOG__(2)`Persisted: deleteReactionsV2 finished`}))).apply(this,arguments)}function v(){return P.apply(this,arguments)}function P(){return(P=(0,r.default)((function*(e){let{chatId:t,parentMsgKeys:s}=e;(0,f.isPollsReceivingEnabled)()&&(__LOG__(2)`Persisted: deletePollVotes persisted job started for ${t}`,yield(0,p.deleteVotesByParentMsgKeys)(s),__LOG__(2)`Persisted: deleteReactionsV2 finished`)}))).apply(this,arguments)}t.deleteReactionsV2=h},980787:(e,t,s)=>{"use strict";var n=s(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteDatabaseForLastReactionPreview=function(){return l.apply(this,arguments)};var r=n(s(348926)),i=s(697588),o=s(97858),a=n(s(565754)),d=s(609622);function l(){return(l=(0,r.default)((function*(e){if(!(0,o.showReactionChatListPreview)())return Promise.resolve();const t=new Set(e.map((e=>a.default.fromString(e).remote.toString()))),s=yield(0,d.bulkGetChatLastReactionPreviewMap)(Array.from(t)),n=new Map;s.forEach(((t,s)=>{e.includes(null==t?void 0:t.parentMsgKey)&&n.set(s,void 0)})),yield(0,i.bulkUpdateChatLastReactionPreview)(n)}))).apply(this,arguments)}},172188:(e,t,s)=>{"use strict";var n=s(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteVotesByParentMsgKeys=function(){return a.apply(this,arguments)};var r=n(s(348926)),i=s(728088),o=s(816990);function a(){return(a=(0,r.default)((function*(e){const t=yield(0,o.getTable)().anyOf(["parentMsgKey"],e);if(0===t.length)return;const s=t.map((e=>e.msgKey)),n=t.map((e=>[e.parentMsgKey,e.sender])),r=yield Promise.allSettled([(0,i.removeMessagesFromHistory)(s),(0,o.getTable)().bulkRemove(n)]);for(const e of r)if("rejected"===e.status)throw e.reason}))).apply(this,arguments)}}}]);
//# sourceMappingURL=https://web.whatsapp.com/4106.061173861f6168767c2c.js.map
