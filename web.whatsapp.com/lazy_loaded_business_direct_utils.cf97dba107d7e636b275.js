/*! Copyright (c) 2021 WhatsApp Inc. All Rights Reserved. */
(self.webpackChunkwhatsapp_web_client=self.webpackChunkwhatsapp_web_client||[]).push([[6],{58521:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.isExpired=function(e,t=(0,a.default)()){if(null==e)return!0;const n=(0,a.default)(e,f);return!(n.isValid()&&n.isAfter(t))},t.getValidCertificate=function(){return d.apply(this,arguments)},t.getCypher=function(e,t){const n=(0,s.arrayBufferToBase64)((0,o.getRandomValues)(new Uint8Array(16)));return(0,l.genCypher)(e[0],n,{phone_number:t.phoneNumber,ttl_timestamp:t.phoneNumberSignatureExpiration,phone_number_signature:t.phoneNumberSignature})},t.fetchCertificateFullChain=function(){return y.apply(this,arguments)},t.timestampFormat=void 0;var i=r(n(48926)),u=r(n(7900)),a=r(n(30381)),o=n(14231),c=n(98216),l=n(83701),s=n(13980);const f="YYYYMMDDTHHmmssZ";function d(){return(d=(0,i.default)((function*(e){const t=(0,s.extractCertificates)(e),{result:n}=yield(0,s.validateCertificates)(t.slice(1,-1),t.slice(-1));return n?{string:e,chain:t}:null}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){const[{certificate:t},n]=yield Promise.all([(0,c.queryBusinessPublicKey)(e),(0,s.fetchFromCABundle)()]);if(null==t)throw new Error("[direct-connection] no certificate returned from the get_public_key IQ");const r=(0,s.extractCertificates)(t),i=(0,u.default)(yield(0,s.genRootIssuers)(r,n),"yield genRootIssuers(extractedCertificate, caBundle)");return(0,s.encodeToString)([...r,...i])}))).apply(this,arguments)}t.timestampFormat=f},83701:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.genCypher=function(){return o.apply(this,arguments)};var i=r(n(48926)),u=n(14231),a=n(13980);function o(){return(o=(0,i.default)((function*(e,t,n){try{const{subtle:r}=(0,u.getEngine)(),i=yield r.generateKey({name:"AES-GCM",length:256},!0,["encrypt"]),o=(0,a.arrayBufferToBase64)(yield r.encrypt({name:"AES-GCM",iv:new Uint8Array((0,a.base64ToArrayBuffer)(t)),tagLength:128},i,(0,a.stringToArrayBuffer)(JSON.stringify(n)))),c=yield r.exportKey("raw",i);return`AesKey=${yield(0,a.encryptWithPublicKey)(e,c)};IV=${t};Data=${o}`}catch(e){return __LOG__(3)`[direct-connection] cypher creation failed with ${e.toString()}`,null}}))).apply(this,arguments)}},13980:(e,t,n)=>{"use strict";var r=n(20862),i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.base64ToArrayBuffer=y,t.arrayBufferToBase64=p,t.stringToArrayBuffer=h,t.arrayBufferToString=g,t.fetchFromCABundle=function(){return b.apply(this,arguments)},t.extractCertificates=C,t.validateCertificates=function(e,t){return m(e,t).verify()},t.genRootIssuers=function(){return A.apply(this,arguments)},t.getCommonName=v,t.encodeToString=function(e){return e.map((e=>{const t=p(e.toSchema(!0).toBER(!1)).split(/(.{0,64})/g).filter((e=>""!==e)).join("\n");return`${s}\n${t}\n${f}`})).join("\n")},t.encryptWithPublicKey=function(){return B.apply(this,arguments)};var u=i(n(48926)),a=r(n(65267)),o=i(n(77093)),c=n(14231),l=n(29595);const s="-----BEGIN CERTIFICATE-----",f="-----END CERTIFICATE-----",d=`(?:${s})((?:.|\n)*?)(?:${f})`;function y(e){let t="";try{t=atob(e)}catch(e){__LOG__(3)`[direct-connection] base64 decoding failed with ${e.toString()}`}return h(t)}function p(e){return btoa(g(e))}function h(e){const t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);return n.buffer}function g(e){return String.fromCharCode(...new Uint8Array(e))}function m(e,t){return new c.CertificateChainValidationEngine({trustedCerts:t,certs:e})}function _(e,t){return e.flat().reduce(((e,n)=>e.every((e=>!(0,l.isEqualBuffer)(e.tbs,n.tbs)))&&t.includes(n)?[...e,n]:e),[])}function b(){return(b=(0,u.default)((function*(){const{CA_BUNDLE:e}=yield n.e(239).then(n.bind(n,47995));return C(e)}))).apply(this,arguments)}function C(e){return(0,o.default)(Array.from(e.matchAll(new RegExp(d,"gm"))).map((([e,t])=>{const{result:n}=a.fromBER(y(t));let r;try{r=n.error?null:new c.Certificate({schema:n})}catch(e){__LOG__(3)`[direct-connection] certificate chain parsing from Get Public Key IQ failed with ${e.toString()}`}return r})))}function A(){return(A=(0,u.default)((function*(e,t){const n=m(e,t),r=_(yield Promise.all(e.map((e=>n.findIssuer(e,n)))),t);return 0===r.length?(__LOG__(3)`[direct-connection] no trusted root certificates could be found for ${v(e[0])}`,null):r}))).apply(this,arguments)}function v(e){var t;return null===(t=e.issuer.typesAndValues.find((({type:e})=>"2.5.4.3"===e)))||void 0===t?void 0:t.value.valueBlock.value}function B(){return(B=(0,u.default)((function*(e,t){const n=yield e.getPublicKey({algorithm:{algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]}});return p(yield(0,c.getEngine)().subtle.encrypt({name:"RSA-OAEP"},n,t))}))).apply(this,arguments)}},77093:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=[];for(const n of e)null!=n&&t.push(n);return t}}}]);