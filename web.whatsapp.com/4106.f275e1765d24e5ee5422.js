/*! Copyright (c) 2023 WhatsApp Inc. All Rights Reserved. */
(self.webpackChunkwhatsapp_web_client=self.webpackChunkwhatsapp_web_client||[]).push([[4106],{273925:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JobBuilder=void 0,t.definePersistedJob=function(){return new i([])};var s=n(811158),r=n(632157);class i{constructor(e){this.steps=e}step(e,t){return this._stepWithOptions(e,"function"==typeof t?{code:t}:t)}_stepWithOptions(e,t){const{stopRetryIf:n,requirements:d,code:l}=t;let u=a(d,l,n);if(n){const{timePassedSeconds:e,appCrashed:t,onStopRetry:i}=n,d=a(null,function(e){return(t,n,r)=>Promise.resolve(e(t,n,r)).then((e=>e instanceof s.InterruptJob?e:new s.InterruptJob(e)))}(i),n);null!=e&&(u=o(((t,n,s)=>{let{jobStartTime:i}=s;return(0,r.happenedWithin)(i,e)}),u,d)),t&&(u=o(((e,t,n)=>{let{afterCrash:s}=n;return!s}),u,d))}return new i([...this.steps,{stepName:e,info:u}])}finalStep(e,t){const n=this.step(e,t);return{end:()=>n.steps}}}function o(e,t,n){return(s,r,i)=>e(s,r,i)?t(s,r,i):n(s,r,i)}function a(e,t,n){const s={requirements:e,code:t,stopRetryIf:n};return()=>s}t.JobBuilder=i},193182:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defineWebPersistedJob=function(){return(0,s.definePersistedJob)()};var s=n(273925)},254106:(e,t,n)=>{"use strict";var s=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteReactionsV2=t.deleteAddOns=void 0;var r=s(n(348926)),i=n(69056),o=n(364622),a=n(384766),d=n(646218),l=n(193182),u=n(198602),c=s(n(565754)),f=n(671598);const p=(0,l.defineWebPersistedJob)().finalStep("deleteAddOns",function(){var e=(0,r.default)((function*(e){let{chatId:t,parentMsgKeys:n}=e;const s=yield Promise.allSettled([h({chatId:t,parentMsgKeys:n}),v({chatId:t,parentMsgKeys:n})]);for(const e of s)if("rejected"===e.status)throw e.reason}));return function(){return e.apply(this,arguments)}}()).end();t.deleteAddOns=p;const y=(0,l.defineWebPersistedJob)().finalStep("deleteReactionsV2",(e=>{let{chatId:t,parentMsgKeys:n}=e;return h({chatId:t,parentMsgKeys:n})})).end();function h(){return g.apply(this,arguments)}function g(){return(g=(0,r.default)((function*(e){let{chatId:t,parentMsgKeys:n}=e;__LOG__(2)`Persisted: deleteReactionsV2 persisted job started for ${t}`;const s=yield(0,o.getAllReactionsFromParentMsgs)(n),r=s.map((e=>e.msgKey));if(0===r.length)return void __LOG__(2)`Persisted: deleteReactionsV2 finished, no reactionsMsgKeys`;const d=[];r.forEach((e=>{c.default.fromString(e).fromMe&&d.push(e)})),d.length>0&&(yield(0,a.removeMessagesFromHistory)(d));const l=s.map((e=>[e.parentMsgKey,e.senderUserJid]));yield(0,i.deleteReactionsByRecords)(l),yield(0,u.deleteLastAddOnsPreview)(n),__LOG__(2)`Persisted: deleteReactionsV2 finished`}))).apply(this,arguments)}function v(){return _.apply(this,arguments)}function _(){return(_=(0,r.default)((function*(e){let{chatId:t,parentMsgKeys:n}=e;(0,f.isPollsReceivingEnabled)()&&(__LOG__(2)`Persisted: deletePollVotes persisted job started for ${t}`,yield(0,d.deleteVotesByParentMsgKeys)(n),__LOG__(2)`Persisted: deleteReactionsV2 finished`)}))).apply(this,arguments)}t.deleteReactionsV2=y},198602:(e,t,n)=>{"use strict";var s=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteLastAddOnsPreview=function(){return l.apply(this,arguments)};var r=s(n(348926)),i=n(697588),o=n(97858),a=s(n(565754)),d=n(696859);function l(){return(l=(0,r.default)((function*(e){if(!(0,o.showReactionChatListPreview)())return;const t=new Set(e.map((e=>a.default.fromString(e).remote.toString()))),n=yield(0,d.bulkGetChatLastAddOnPreviewMap)(Array.from(t)),s=new Map;n.forEach(((t,n)=>{e.includes(null==t?void 0:t.parentMsgKey)&&s.set(n,void 0)})),yield(0,i.bulkUpdateChatLastAddOnPreview)(s)}))).apply(this,arguments)}},646218:(e,t,n)=>{"use strict";var s=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteVotesByParentMsgKeys=function(){return a.apply(this,arguments)};var r=s(n(348926)),i=n(384766),o=n(941322);function a(){return(a=(0,r.default)((function*(e){const t=yield(0,o.getTable)().anyOf(["parentMsgKey"],e);if(0===t.length)return;const n=t.map((e=>e.msgKey)),s=t.map((e=>[e.parentMsgKey,e.sender])),r=yield Promise.allSettled([(0,i.removeMessagesFromHistory)(n),(0,o.getTable)().bulkRemove(s)]);for(const e of r)if("rejected"===e.status)throw e.reason}))).apply(this,arguments)}},69056:(e,t,n)=>{"use strict";var s=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteReactionsByParentMessageKey=function(e){const t=[];return(0,i.getStorage)().lock(["reactions"],function(){var n=(0,r.default)((function*(n){let[s]=n;return(yield s.equals(["parentMsgKey"],e)).forEach((e=>t.push([e.parentMsgKey,e.senderUserJid]))),s.bulkRemove(t)}));return function(){return n.apply(this,arguments)}}())},t.deleteReactionsByParentMessageKeys=function(e){const t=[];return(0,i.getStorage)().lock(["reactions"],function(){var n=(0,r.default)((function*(n){let[s]=n;const r=yield s.anyOf(["parentMsgKey"],e);return r.forEach((e=>t.push([e.parentMsgKey,e.senderUserJid]))),yield s.bulkRemove(t),r.map((e=>e.msgKey))}));return function(){return n.apply(this,arguments)}}())},t.deleteReactionsByRecords=function(e){return(0,i.getStorage)().lock(["reactions"],function(){var t=(0,r.default)((function*(t){let[n]=t;yield n.bulkRemove(e)}));return function(){return t.apply(this,arguments)}}())};var r=s(n(348926)),i=n(605316)}}]);
//# sourceMappingURL=https://web.whatsapp.com/4106.f275e1765d24e5ee5422.js.map
