/*! Copyright (c) 2024 WhatsApp Inc. All Rights Reserved. */(()=>{var e={504:e=>{function t(e,t,n,r,s,i,o){try{var a=e[i](o),f=a.value}catch(e){return void n(e)}a.done?t(f):Promise.resolve(f).then(r,s)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(s,i){var o=e.apply(n,r);function a(e){t(o,s,i,a,f,"next",e)}function f(e){t(o,s,i,a,f,"throw",e)}a(void 0)}))}}},526:e=>{e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},914:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}}},982:(e,t,n)=>{var r=n(526);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}e.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}},302:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="function"==typeof WeakMap?new WeakMap:new Map;function r(e){var t=n.get(e);if(void 0!==t)return t;var r=new Map;return Object.getOwnPropertyNames(e).forEach((function(t){r.set(e[t],t)})),n.set(e,r),r}var s=Object.freeze(Object.defineProperties(Object.create(null),{isValid:{value:function(e){return r(this).has(e)}},cast:{value:function(e){return this.isValid(e)?e:void 0}},members:{value:function(){return r(this).keys()}},getName:{value:function(e){return r(this).get(e)}}}));function i(e){var n=Object.create(s);for(var r in e)t.call(e,r)&&Object.defineProperty(n,r,{value:e[r]});return Object.freeze(n)}var o=Object.freeze(Object.defineProperties(Object.create(null),{isValid:{value:function(e){return"string"==typeof e&&t.call(this,e)}},cast:{value:s.cast},members:{value:function(){return Object.getOwnPropertyNames(this)}},getName:{value:function(e){return e}}}));i.Mirrored=function(e){for(var t=Object.create(o),n=0,r=e.length;n<r;++n)Object.defineProperty(t,e[n],{value:e[n]});return Object.freeze(t)},Object.freeze(i.Mirrored),e.exports=Object.freeze(i)},926:e=>{function t(e,t,n,r,s,i,o){try{var a=e[i](o),f=a.value}catch(e){return void n(e)}a.done?t(f):Promise.resolve(f).then(r,s)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(s,i){var o=e.apply(n,r);function a(e){t(o,s,i,a,f,"next",e)}function f(e){t(o,s,i,a,f,"throw",e)}a(void 0)}))}},e.exports.default=e.exports,e.exports.__esModule=!0},318:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},230:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseCallSync=function(e,t){try{for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];return Promise.resolve(e.apply(t,r))}catch(e){return Promise.reject(e)}}},841:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.compareArrayBuffer=function(e,t){if(!e||!t)return!1;const n=new Uint8Array(e),r=new Uint8Array(t),s=n.length,i=r.length;if(s!==i)return!1;for(let e=0;e<s;e++)if(n[e]!==r[e])return!1;return!0},t.intToBytes=function(e,t){let n=t;const r=new Uint8Array(e);for(let t=e-1;t>=0;t--)r[t]=255&n,n>>>=8;return r},t.uint8ArrayToBuffer=function(e){return e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset)}},227:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=new Error(e);if(void 0===t.stack)try{throw t}catch(e){}return t}},647:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cacheWhilePending=function(e,t){const n=new Map;return r=>{const s=e(r),i=n.get(s);if(i)return i;let o;try{o=Promise.resolve(t(r))}catch(e){o=Promise.reject(e)}const a=o.finally((()=>{n.delete(s)}));return n.set(s,a),a}},t.nullaryCacheWhilePending=function(e){let t=null;const n=()=>(t||(t=(0,r.promiseCallSync)(e).finally((()=>{t=null}))),t);return n.isPending=()=>!!t,n},t.preventGarbageCollection=function(e){s.add(e),e.finally((()=>{s.delete(e)}))};var r=n(230);const s=new Set},781:(e,t,n)=>{"use strict";var r=n(914);Object.defineProperty(t,"__esModule",{value:!0}),t.asyncChain=function(e,t){if(e.success)return t(e.value);return Promise.resolve(e)},t.asyncMapError=u,t.asyncMapResult=f,t.catchError=function(e){return function(){var t=(0,s.default)((function*(t){yield u(t,e)}));return function(){return t.apply(this,arguments)}}()},t.chain=function(e,t){if(e.success)return t(e.value);return e},t.makeError=i,t.makeResult=o,t.mapAsyncResult=function(){return a.apply(this,arguments)},t.mapError=function(e,t){if(e.success)return o(e.value);return i(t(e.error),e.payload)},t.mapResult=function(e,t){if(!e.success)return e;return o(t(e.value))},t.onResult=function(e){return t=>f(t,e)};var s=r(n(504));function i(e,t){return null!=t?{success:!1,error:e,payload:t}:{success:!1,error:e}}function o(e){return{success:!0,value:e}}function a(){return(a=(0,s.default)((function*(e,t){const n=yield e;return n.success?o(t(n.value)):n}))).apply(this,arguments)}function f(){return c.apply(this,arguments)}function c(){return(c=(0,s.default)((function*(e,t){if(!e.success)return e;return o(yield t(e.value))}))).apply(this,arguments)}function u(){return l.apply(this,arguments)}function l(){return(l=(0,s.default)((function*(e,t){if(e.success)return o(e.value);return i(yield t(e.error),e.payload)}))).apply(this,arguments)}},70:(e,t,n)=>{"use strict";var r=n(914);Object.defineProperty(t,"__esModule",{value:!0}),t.loadWasmModule=void 0;var s=r(n(504)),i=n(647);const o=n.g.fetch;let a;const f=(0,i.cacheWhilePending)((e=>e),function(){var e=(0,s.default)((function*(e){return null!=a||(a=yield function(){return c.apply(this,arguments)}(e)),a}));return function(){return e.apply(this,arguments)}}());function c(){return(c=(0,s.default)((function*(e){const t=o(e);if("function"==typeof WebAssembly.compileStreaming)return WebAssembly.compileStreaming(t);const n=yield t;return WebAssembly.compile(yield n.arrayBuffer())}))).apply(this,arguments)}t.loadWasmModule=f},763:(e,t,n)=>{"use strict";var r=n(914);Object.defineProperty(t,"__esModule",{value:!0}),t.createMp4CheckAndRepair=function(e){let{getWasmModule:t,logError:n,logMessage:r}=e;return function(){var e=(0,s.default)((function*(e){var s;let{input:E}=e;const{getImportObject:h,start:p}=(0,a.createWasi)(function(e){let{input:t,stdout:n,stderr:r}=e;return{args:["mp4checkAndRepair",f,c],fs:{[u]:{path:u,timestamps:{access:new Date,change:new Date,modification:new Date},mode:"binary",content:new Uint8Array(t)}},stdout:n,stderr:r}}({input:E,stderr:n,stdout:r})),d=yield t(),S=yield WebAssembly.instantiate(d,h()),{exitCode:g,fs:T}=p(S),_=null===(s=T[l])||void 0===s?void 0:s.content;return 0!==g?(n(`mp4CheckAndRepair failed with exit code ${g}`),(0,o.makeError)("invalid-mp4")):_ instanceof Uint8Array?(0,o.makeResult)((0,i.uint8ArrayToBuffer)(_)):(n("mp4CheckAndRepair failed invalid result type"),(0,o.makeError)("internal-error"))}));return function(){return e.apply(this,arguments)}}()};var s=r(n(504)),i=n(841),o=n(781),a=n(952);const f="input",c="output",u="/input",l="/output"},952:(e,t,n)=>{"use strict";var r=n(914);Object.defineProperty(t,"__esModule",{value:!0}),t.createWasi=function(e){let t;const n=new i.WASIContext(e),r=new o.WASIDrive(n.fs);function E(){return Object.entries(n.env).map((e=>{let[t,n]=e;return`${t}=${n}`}))}const h={args_get(e,r){let s=e,i=r;const o=new DataView(t.buffer);for(const e of n.args){o.setUint32(s,i,!0),s+=4;const n=(new TextEncoder).encode(`${e}\0`);new Uint8Array(t.buffer,i,n.byteLength).set(n),i+=n.byteLength}return a.RESULT.SUCCESS},args_sizes_get(e,r){const s=n.args,i=s.reduce(((e,t)=>e+(new TextEncoder).encode(`${t}\0`).byteLength),0),o=new DataView(t.buffer);return o.setUint32(e,s.length,!0),o.setUint32(r,i,!0),a.RESULT.SUCCESS},clock_res_get(){throw(0,s.default)("clock_res_get is not implemented")},clock_time_get(e,n,r){const s=a.Clock.cast(e);if(null==s)return a.RESULT.EINVAL;switch(s){case a.Clock.REALTIME:case a.Clock.MONOTONIC:case a.Clock.PROCESS_CPUTIME_ID:case a.Clock.THREAD_CPUTIME_ID:return new DataView(t.buffer).setBigUint64(r,(i=new Date,BigInt(i.getTime())*BigInt(1e6)),!0),a.RESULT.SUCCESS}var i},environ_get(e,n){let r=e,s=n;const i=new DataView(t.buffer);for(const e of E()){i.setUint32(r,s,!0),r+=4;const n=(new TextEncoder).encode(`${e}\0`);new Uint8Array(t.buffer,s,n.byteLength).set(n),s+=n.byteLength}return a.RESULT.SUCCESS},environ_sizes_get(e,n){const r=E().reduce(((e,t)=>e+(new TextEncoder).encode(`${t}\0`).byteLength),0),s=new DataView(t.buffer);return s.setUint32(e,E().length,!0),s.setUint32(n,r,!0),a.RESULT.SUCCESS},fd_advise(){throw(0,s.default)("fd_advise is not implemented")},fd_allocate(){throw(0,s.default)("fd_allocate is not implemented")},fd_close:e=>r.close(e),fd_datasync(){throw(0,s.default)("fd_datasync is not implemented")},fd_fdstat_get(e,s){if(e<3){let e;if(n.isTTY){const t=c^a.RightsFlags.FD_SEEK^a.RightsFlags.FD_TELL;e=l(a.FileType.CHARACTER_DEVICE,0,t)}else e=l(a.FileType.CHARACTER_DEVICE,0);return new Uint8Array(t.buffer,s,e.byteLength).set(e),a.RESULT.SUCCESS}if(!r.exists(e))return a.RESULT.EBADF;const i=l(r.fileType(e),r.fileFdflags(e));return new Uint8Array(t.buffer,s,i.byteLength).set(i),a.RESULT.SUCCESS},fd_fdstat_set_flags:(e,t)=>r.setFlags(e,t),fd_fdstat_set_rights:()=>a.RESULT.SUCCESS,fd_filestat_get(){throw(0,s.default)("fd_filestat_get is not implemented")},fd_filestat_set_size(){throw(0,s.default)("fd_filestat_set_size is not implemented")},fd_filestat_set_times(){throw(0,s.default)("fd_filestat_set_times is not implemented")},fd_pread(){throw(0,s.default)("fd_pread is not implemented")},fd_prestat_dir_name(e,n,r){if(3!==e)return a.RESULT.EBADF;const s=(new TextEncoder).encode("/");return new Uint8Array(t.buffer,n,r).set(s.subarray(0,r)),a.RESULT.SUCCESS},fd_prestat_get(e,n){if(3!==e)return a.RESULT.EBADF;const r=(new TextEncoder).encode("."),s=new DataView(t.buffer,n);return s.setUint8(0,a.PreopenType.DIR),s.setUint32(4,r.byteLength,!0),a.RESULT.SUCCESS},fd_pwrite(){throw(0,s.default)("fd_pwrite is not implemented")},fd_read(e,s,i,o){if(1===e||2===e)return a.RESULT.ENOTSUP;const f=new DataView(t.buffer),c=u(f,s,i),l=new TextEncoder;let E=0,h=a.RESULT.SUCCESS;for(const t of c){let s;if(0===e){const e=n.stdin(t.byteLength);if(null==e)break;s=l.encode(e)}else{const n=r.read(e,t.byteLength);if(1===n.length){h=n[0];break}s=n[1]}const i=Math.min(t.byteLength,s.byteLength);t.set(s.subarray(0,i)),E+=i}return f.setUint32(o,E,!0),h},fd_readdir(){throw(0,s.default)("fd_readdir is not implemented")},fd_renumber(){throw(0,s.default)("fd_renumber is not implemented")},fd_seek(e,n,i,o){const f=a.Whence.cast(i);if(null==f)throw(0,s.default)("fd_seek: invalid whence");const c=r.seek(e,n,f);if(1===c.length)return c[0];const[u,l]=c;return new DataView(t.buffer).setBigUint64(o,l,!0),u},fd_sync(){throw(0,s.default)("fd_sync is not implemented")},fd_tell(){throw(0,s.default)("fd_tell is not implemented")},fd_write(e,s,i,o){if(0===e)return a.RESULT.ENOTSUP;const f=new DataView(t.buffer),c=u(f,s,i),l=new TextDecoder;let E=0,h=a.RESULT.SUCCESS;for(const t of c)if(0!==t.byteLength){if(1===e||2===e){(1===e?n.stdout:n.stderr)(l.decode(t))}else if(h=r.write(e,t),h!==a.RESULT.SUCCESS)break;E+=t.byteLength}return f.setUint32(o,E,!0),h},path_create_directory(){throw(0,s.default)("path_create_directory is not implemented")},path_filestat_get(){throw(0,s.default)("path_filestat_get is not implemented")},path_filestat_set_times(){throw(0,s.default)("path_filestat_set_times is not implemented")},path_link(){throw(0,s.default)("path_link is not implemented")},path_open(e,n,s,i,o,a,f,c,u){const l=new DataView(t.buffer),E=function(e,t,n){return(new TextDecoder).decode(new Uint8Array(e.buffer,t,n))}(t,s,i),h=r.open(e,E,o,c);if(1===h.length)return h[0];const[p,d]=h;return l.setUint32(u,d,!0),p},path_readlink(){throw(0,s.default)("path_readlink is not implemented")},path_remove_directory(){throw(0,s.default)("path_remove_directory is not implemented")},path_rename(){throw(0,s.default)("path_rename is not implemented")},path_symlink(){throw(0,s.default)("path_symlink is not implemented")},path_unlink_file(){throw(0,s.default)("path_unlink_file is not implemented")},poll_oneoff(){throw(0,s.default)("poll_oneoff is not implemented")},proc_exit(e){throw new f(e)},proc_raise(){throw(0,s.default)("proc_raise is not implemented")},random_get(e,n){const r=new Uint8Array(t.buffer,e,n);return self.crypto.getRandomValues(r),a.RESULT.SUCCESS},sched_yield(){throw(0,s.default)("sched_yield is not implemented")},sock_accept(){throw(0,s.default)("sock_accept is not implemented")},sock_recv(){throw(0,s.default)("sock_recv is not implemented")},sock_send(){throw(0,s.default)("sock_send is not implemented")},sock_shutdown(){throw(0,s.default)("sock_shutdown is not implemented")}};return{getImportObject:()=>({wasi_snapshot_preview1:h}),start(e){const n=e.exports.memory;if(!(n instanceof WebAssembly.Memory))throw(0,s.default)("Expected memory object");t=n;const i=e.exports._start;try{i()}catch(e){if(e instanceof f)return{exitCode:e.code,fs:r.fs};if(e instanceof WebAssembly.RuntimeError)return{exitCode:134,fs:r.fs};throw e}return{exitCode:0,fs:r.fs}}}};var s=r(n(227)),i=n(461),o=n(554),a=n(266);class f extends Error{constructor(e){super(),this.code=e}}const c=a.RightsFlags.FD_DATASYNC|a.RightsFlags.FD_READ|a.RightsFlags.FD_SEEK|a.RightsFlags.FD_FDSTAT_SET_FLAGS|a.RightsFlags.FD_SYNC|a.RightsFlags.FD_TELL|a.RightsFlags.FD_WRITE|a.RightsFlags.FD_ADVISE|a.RightsFlags.FD_ALLOCATE|a.RightsFlags.PATH_CREATE_DIRECTORY|a.RightsFlags.PATH_CREATE_FILE|a.RightsFlags.PATH_LINK_SOURCE|a.RightsFlags.PATH_LINK_TARGET|a.RightsFlags.PATH_OPEN|a.RightsFlags.FD_READDIR|a.RightsFlags.PATH_READLINK|a.RightsFlags.PATH_RENAME_SOURCE|a.RightsFlags.PATH_RENAME_TARGET|a.RightsFlags.PATH_FILESTAT_GET|a.RightsFlags.PATH_FILESTAT_SET_SIZE|a.RightsFlags.PATH_FILESTAT_SET_TIMES|a.RightsFlags.FD_FILESTAT_GET|a.RightsFlags.FD_FILESTAT_SET_SIZE|a.RightsFlags.FD_FILESTAT_SET_TIMES|a.RightsFlags.PATH_SYMLINK|a.RightsFlags.PATH_REMOVE_DIRECTORY|a.RightsFlags.PATH_UNLINK_FILE|a.RightsFlags.POLL_FD_READWRITE|a.RightsFlags.SOCK_SHUTDOWN|a.RightsFlags.SOCK_ACCEPT;function u(e,t,n){const r=new Array(n);let s=t;for(let t=0;t<n;t++){const n=e.getUint32(s,!0);s+=4;const i=e.getUint32(s,!0);s+=4,r[t]=new Uint8Array(e.buffer,n,i)}return r}function l(e,t,n){const r=null!=n?n:c,s=null!=n?n:c,i=new Uint8Array(24),o=new DataView(i.buffer,0,24);return o.setUint8(0,e),o.setUint32(2,t,!0),o.setBigUint64(8,r,!0),o.setBigUint64(16,s,!0),i}},461:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WASIContext=void 0;t.WASIContext=class{constructor(e){var t,n,r,s,i,o;this.fs=null!==(t=null==e?void 0:e.fs)&&void 0!==t?t:{},this.args=null!==(n=null==e?void 0:e.args)&&void 0!==n?n:[],this.env=null!==(r=null==e?void 0:e.env)&&void 0!==r?r:{},this.stdin=null!==(s=null==e?void 0:e.stdin)&&void 0!==s?s:()=>null,this.stdout=null!==(i=null==e?void 0:e.stdout)&&void 0!==i?i:()=>{},this.stderr=null!==(o=null==e?void 0:e.stderr)&&void 0!==o?o:()=>{},this.debug=null==e?void 0:e.debug,this.isTTY=!!(null==e?void 0:e.isTTY)}}},554:(e,t,n)=>{"use strict";var r=n(914);Object.defineProperty(t,"__esModule",{value:!0}),t.WASIDrive=void 0;var s=r(n(982)),i=n(266);t.WASIDrive=class{constructor(e){this.nextFD=10,this.openMap=new Map,this.fs=(0,s.default)({},e),this.openMap.set(3,new f(this.fs,"/"))}_openFile(e,t,n){const r=new o(e,n);t&&(r.buffer=new Uint8Array(new ArrayBuffer(1024),0,0));const s=this.nextFD;return this.openMap.set(s,r),this.nextFD++,[i.RESULT.SUCCESS,s]}_openDir(e,t){const n=new f(e,t),r=this.nextFD;return this.openMap.set(r,n),this.nextFD++,[i.RESULT.SUCCESS,r]}_hasDir(e,t){return"."===t||e.containsDirectory(t)}open(e,t,n,r){const s=!!(n&i.OpenFlags.CREAT),o=!!(n&i.OpenFlags.DIRECTORY),a=!!(n&i.OpenFlags.EXCL),c=!!(n&i.OpenFlags.TRUNC),u=this.openMap.get(e);if(!(u instanceof f))return[i.RESULT.EBADF];if(u.containsFile(t)){if(o)return[i.RESULT.ENOTDIR];if(a)return[i.RESULT.EEXIST];const e=u.get(t);return this._openFile(e,c,r)}if(this._hasDir(u,t)){if("."===t)return this._openDir(this.fs,"/");const e=`/${t}/`,n=Object.entries(this.fs).filter((t=>{let[n]=t;return n.startsWith(e)}));return this._openDir(Object.fromEntries(n),e)}if(s){const e=u.fullPath(t);return this.fs[e]={path:e,mode:"binary",content:new Uint8Array(0),timestamps:{access:new Date,modification:new Date,change:new Date}},this._openFile(this.fs[e],c,r)}return[i.RESULT.ENOTCAPABLE]}close(e){if(!this.openMap.has(e))return i.RESULT.EBADF;const t=this.openMap.get(e);return t instanceof o&&t.sync(),this.openMap.delete(e),i.RESULT.SUCCESS}read(e,t){const n=this.openMap.get(e);return!n||n instanceof f?[i.RESULT.EBADF]:[i.RESULT.SUCCESS,n.read(t)]}pread(e,t,n){const r=this.openMap.get(e);return!r||r instanceof f?[i.RESULT.EBADF]:[i.RESULT.SUCCESS,r.pread(t,n)]}write(e,t){const n=this.openMap.get(e);return!n||n instanceof f?i.RESULT.EBADF:(n.write(t),i.RESULT.SUCCESS)}pwrite(e,t,n){const r=this.openMap.get(e);return!r||r instanceof f?i.RESULT.EBADF:(r.pwrite(t,n),i.RESULT.SUCCESS)}sync(e){const t=this.openMap.get(e);return!t||t instanceof f?i.RESULT.EBADF:(t.sync(),i.RESULT.SUCCESS)}seek(e,t,n){const r=this.openMap.get(e);return!r||r instanceof f?[i.RESULT.EBADF]:[i.RESULT.SUCCESS,r.seek(t,n)]}tell(e){const t=this.openMap.get(e);return!t||t instanceof f?[i.RESULT.EBADF]:[i.RESULT.SUCCESS,t.tell()]}renumber(e,t){if(!this.exists(e)||!this.exists(t))return i.RESULT.EBADF;if(e===t)return i.RESULT.SUCCESS;this.close(t);const n=this.openMap.get(e);return this.openMap.set(t,n),i.RESULT.SUCCESS}unlink(e,t){const n=this.openMap.get(e);if(!(n instanceof f))return i.RESULT.EBADF;if(!n.contains(t))return i.RESULT.ENOENT;for(const e of Object.keys(this.fs))(e===n.fullPath(t)||e.startsWith(`${n.fullPath(t)}/`))&&delete this.fs[e];return i.RESULT.SUCCESS}rename(e,t,n,r){const s=this.openMap.get(e),o=this.openMap.get(n);if(!(s instanceof f&&o instanceof f))return i.RESULT.EBADF;if(!s.contains(t))return i.RESULT.ENOENT;if(o.contains(r))return i.RESULT.EEXIST;const a=s.fullPath(t),c=o.fullPath(r);for(const e of Object.keys(this.fs))if(e.startsWith(a)){const t=e.replace(a,c);this.fs[t]=this.fs[e],this.fs[t].path=t,delete this.fs[e]}return i.RESULT.SUCCESS}list(e){const t=this.openMap.get(e);return t instanceof f?[i.RESULT.SUCCESS,t.list()]:[i.RESULT.EBADF]}stat(e){const t=this.openMap.get(e);return t instanceof o?[i.RESULT.SUCCESS,t.stat()]:[i.RESULT.EBADF]}pathStat(e,t){const n=this.openMap.get(e);if(!(n instanceof f))return[i.RESULT.EBADF];if(n.containsFile(t)){const e=n.fullPath(t),r=new o(this.fs[e],0).stat();return[i.RESULT.SUCCESS,r]}if(this._hasDir(n,t)){if("."===t)return[i.RESULT.SUCCESS,new f(this.fs,"/").stat()];const e=`/${t}/`,n=Object.entries(this.fs).filter((t=>{let[n]=t;return n.startsWith(e)})),r=new f(Object.fromEntries(n),e).stat();return[i.RESULT.SUCCESS,r]}return[i.RESULT.ENOTCAPABLE]}setFlags(e,t){const n=this.openMap.get(e);return n instanceof o?(n.setFlags(t),i.RESULT.SUCCESS):i.RESULT.EBADF}setSize(e,t){const n=this.openMap.get(e);return n instanceof o?(n.setSize(Number(t)),i.RESULT.SUCCESS):i.RESULT.EBADF}setAccessTime(e,t){const n=this.openMap.get(e);return n instanceof o?(n.setAccessTime(t),i.RESULT.SUCCESS):i.RESULT.EBADF}setModificationTime(e,t){const n=this.openMap.get(e);return n instanceof o?(n.setModificationTime(t),i.RESULT.SUCCESS):i.RESULT.EBADF}pathSetAccessTime(e,t,n){const r=this.openMap.get(e);if(!(r instanceof f))return i.RESULT.EBADF;const s=r.get(t);if(null==s)return i.RESULT.ENOTCAPABLE;const a=new o(s,0);return a.setAccessTime(n),a.sync(),i.RESULT.SUCCESS}pathSetModificationTime(e,t,n){const r=this.openMap.get(e);if(!(r instanceof f))return i.RESULT.EBADF;const s=r.get(t);if(null==s)return i.RESULT.ENOTCAPABLE;const a=new o(s,0);return a.setModificationTime(n),a.sync(),i.RESULT.SUCCESS}pathCreateDir(e,t){const n=this.openMap.get(e);if(!(n instanceof f))return i.RESULT.EBADF;if(n.contains(t))return i.RESULT.ENOTCAPABLE;const r=`${n.fullPath(t)}/.runno`;return this.fs[r]={path:r,timestamps:{access:new Date,modification:new Date,change:new Date},mode:"string",content:""},i.RESULT.SUCCESS}exists(e){return this.openMap.has(e)}fileType(e){const t=this.openMap.get(e);return t?t instanceof o?i.FileType.REGULAR_FILE:i.FileType.DIRECTORY:i.FileType.UNKNOWN}fileFdflags(e){const t=this.openMap.get(e);return t instanceof o?t.fdflags:0}};class o{getOffset(){return Number(this._offset)}constructor(e,t){if(this._offset=BigInt(0),this.isDirty=!1,this.file=e,"string"===this.file.mode){const e=this.file.content,t=new TextEncoder;this.buffer=t.encode(e)}else this.buffer=this.file.content;this.fdflags=t,this.flagAppend=!!(t&i.FileDescriptorFlags.APPEND),this.flagDSync=!!(t&i.FileDescriptorFlags.DSYNC),this.flagNonBlock=!!(t&i.FileDescriptorFlags.NONBLOCK),this.flagRSync=!!(t&i.FileDescriptorFlags.RSYNC),this.flagSync=!!(t&i.FileDescriptorFlags.SYNC)}read(e){const t=this.buffer.subarray(this.getOffset(),this.getOffset()+e);return this._offset+=BigInt(t.length),t}pread(e,t){return this.buffer.subarray(t,t+e)}write(e){if(this.isDirty=!0,this.flagAppend){const t=this.buffer.length;this._resize(t+e.byteLength),this.buffer.set(e,t)}else{const t=Math.max(this.getOffset()+e.byteLength,this.buffer.byteLength);this._resize(t),this.buffer.set(e,this.getOffset()),this._offset+=BigInt(e.byteLength)}(this.flagDSync||this.flagSync)&&this.sync()}pwrite(e,t){if(this.isDirty=!0,this.flagAppend){const t=this.buffer.length;this._resize(t+e.byteLength),this.buffer.set(e,t)}else{const n=Math.max(t+e.byteLength,this.buffer.byteLength);this._resize(n),this.buffer.set(e,t)}(this.flagDSync||this.flagSync)&&this.sync()}sync(){if(!this.isDirty)return;if(this.isDirty=!1,"binary"===this.file.mode)return void(this.file.content=new Uint8Array(this.buffer));const e=new TextDecoder;this.file.content=e.decode(this.buffer)}seek(e,t){switch(t){case i.Whence.SET:this._offset=e;break;case i.Whence.CUR:this._offset+=e;break;case i.Whence.END:this._offset=BigInt(this.buffer.length)+e}return this._offset}tell(){return this._offset}stat(){return{path:this.file.path,timestamps:this.file.timestamps,type:i.FileType.REGULAR_FILE,byteLength:this.buffer.length}}setFlags(e){this.fdflags=e}setSize(e){this._resize(e)}setAccessTime(e){this.file.timestamps.access=e}setModificationTime(e){this.file.timestamps.modification=e}_resize(e){if(e<=this.buffer.buffer.byteLength)return void(this.buffer=new Uint8Array(this.buffer.buffer,0,e));let t;t=0===this.buffer.buffer.byteLength?new ArrayBuffer(e<1024?1024:2*e):e>2*this.buffer.buffer.byteLength?new ArrayBuffer(2*e):new ArrayBuffer(2*this.buffer.buffer.byteLength);const n=new Uint8Array(t,0,e);n.set(this.buffer),this.buffer=n}}function a(e,t){const n=t.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&"),r=new RegExp(`^${n}`);return e.replace(r,"")}class f{constructor(e,t){this.dir=e,this.prefix=t}containsFile(e){for(const t of Object.keys(this.dir)){if(a(t,this.prefix)===e)return!0}return!1}containsDirectory(e){for(const t of Object.keys(this.dir)){if(a(t,this.prefix).startsWith(`${e}/`))return!0}return!1}contains(e){for(const t of Object.keys(this.dir)){const n=a(t,this.prefix);if(n===e||n.startsWith(`${e}/`))return!0}return!1}get(e){return this.dir[this.fullPath(e)]}fullPath(e){return`${this.prefix}${e}`}list(){const e=[],t=new Set;for(const n of Object.keys(this.dir)){const r=a(n,this.prefix);if(r.includes("/")){const n=r.split("/")[0];if(t.has(n))continue;t.add(n),e.push({name:n,type:i.FileType.DIRECTORY})}else e.push({name:r,type:i.FileType.REGULAR_FILE})}return e}stat(){return{path:this.prefix,timestamps:{access:new Date,modification:new Date,change:new Date},type:i.FileType.DIRECTORY,byteLength:0}}}},266:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Whence=t.SubscriptionClockFlags=t.SUBSCRIPTION_SIZE=t.RightsFlags=t.RESULT=t.PreopenType=t.OpenFlags=t.LookupFlags=t.FileType=t.FileStatTimestampFlags=t.FileDescriptorFlags=t.FILESTAT_SIZE=t.EventType=t.EventReadWriteFlags=t.EVENT_SIZE=t.Clock=void 0;const r=Object.freeze({SUCCESS:0,E2BIG:1,EACCESS:2,EADDRINUSE:3,EADDRNOTAVAIL:4,EAFNOSUPPORT:5,EAGAIN:6,EALREADY:7,EBADF:8,EBADMSG:9,EBUSY:10,ECANCELED:11,ECHILD:12,ECONNABORTED:13,ECONNREFUSED:14,ECONNRESET:15,EDEADLK:16,EDESTADDRREQ:17,EDOM:18,EDQUOT:19,EEXIST:20,EFAULT:21,EFBIG:22,EHOSTUNREACH:23,EIDRM:24,EILSEQ:25,EINPROGRESS:26,EINTR:27,EINVAL:28,EIO:29,EISCONN:30,EISDIR:31,ELOOP:32,EMFILE:33,EMLINK:34,EMSGSIZE:35,EMULTIHOP:36,ENAMETOOLONG:37,ENETDOWN:38,ENETRESET:39,ENETUNREACH:40,ENFILE:41,ENOBUFS:42,ENODEV:43,ENOENT:44,ENOEXEC:45,ENOLCK:46,ENOLINK:47,ENOMEM:48,ENOMSG:49,ENOPROTOOPT:50,ENOSPC:51,ENOSYS:52,ENOTCONN:53,ENOTDIR:54,ENOTEMPTY:55,ENOTRECOVERABLE:56,ENOTSOCK:57,ENOTSUP:58,ENOTTY:59,ENXIO:60,EOVERFLOW:61,EOWNERDEAD:62,EPERM:63,EPIPE:64,EPROTO:65,EPROTONOSUPPORT:66,EPROTOTYPE:67,ERANGE:68,EROFS:69,ESPIPE:70,ESRCH:71,ESTALE:72,ETIMEDOUT:73,ETXTBSY:74,EXDEV:75,ENOTCAPABLE:76});t.RESULT=r;const s=n(302)({REALTIME:0,MONOTONIC:1,PROCESS_CPUTIME_ID:2,THREAD_CPUTIME_ID:3});t.Clock=s;const i=n(302)({SET:0,CUR:1,END:2});t.Whence=i;const o=n(302)({UNKNOWN:0,BLOCK_DEVICE:1,CHARACTER_DEVICE:2,DIRECTORY:3,REGULAR_FILE:4,SOCKET_DGRAM:5,SOCKET_STREAM:6,SYMBOLIC_LINK:7});t.FileType=o;const a=n(302)({DIR:0});t.PreopenType=a;const f=n(302)({CLOCK:0,FD_READ:1,FD_WRITE:2});t.EventType=f;t.LookupFlags={SYMLINK_FOLLOW:1};t.OpenFlags={CREAT:1,DIRECTORY:2,EXCL:4,TRUNC:8};t.FileDescriptorFlags={APPEND:1,DSYNC:2,NONBLOCK:4,RSYNC:8,SYNC:16};const c={FD_DATASYNC:BigInt(1)<<BigInt(0),FD_READ:BigInt(1)<<BigInt(1),FD_SEEK:BigInt(1)<<BigInt(2),FD_FDSTAT_SET_FLAGS:BigInt(1)<<BigInt(3),FD_SYNC:BigInt(1)<<BigInt(4),FD_TELL:BigInt(1)<<BigInt(5),FD_WRITE:BigInt(1)<<BigInt(6),FD_ADVISE:BigInt(1)<<BigInt(7),FD_ALLOCATE:BigInt(1)<<BigInt(8),PATH_CREATE_DIRECTORY:BigInt(1)<<BigInt(9),PATH_CREATE_FILE:BigInt(1)<<BigInt(10),PATH_LINK_SOURCE:BigInt(1)<<BigInt(11),PATH_LINK_TARGET:BigInt(1)<<BigInt(12),PATH_OPEN:BigInt(1)<<BigInt(13),FD_READDIR:BigInt(1)<<BigInt(14),PATH_READLINK:BigInt(1)<<BigInt(15),PATH_RENAME_SOURCE:BigInt(1)<<BigInt(16),PATH_RENAME_TARGET:BigInt(1)<<BigInt(17),PATH_FILESTAT_GET:BigInt(1)<<BigInt(18),PATH_FILESTAT_SET_SIZE:BigInt(1)<<BigInt(19),PATH_FILESTAT_SET_TIMES:BigInt(1)<<BigInt(20),FD_FILESTAT_GET:BigInt(1)<<BigInt(21),FD_FILESTAT_SET_SIZE:BigInt(1)<<BigInt(22),FD_FILESTAT_SET_TIMES:BigInt(1)<<BigInt(23),PATH_SYMLINK:BigInt(1)<<BigInt(24),PATH_REMOVE_DIRECTORY:BigInt(1)<<BigInt(25),PATH_UNLINK_FILE:BigInt(1)<<BigInt(26),POLL_FD_READWRITE:BigInt(1)<<BigInt(27),SOCK_SHUTDOWN:BigInt(1)<<BigInt(28),SOCK_ACCEPT:BigInt(1)<<BigInt(29)};t.RightsFlags=c;t.FileStatTimestampFlags={ATIM:1,ATIM_NOW:2,MTIM:4,MTIM_NOW:8};t.SubscriptionClockFlags={SUBSCRIPTION_CLOCK_ABSTIME:1};t.EventReadWriteFlags={FD_READWRITE_HANGUP:1};t.FILESTAT_SIZE=64;t.SUBSCRIPTION_SIZE=48;t.EVENT_SIZE=32},848:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=n.p+"43896fdb23710d48ff5791ba4143f555.wasm"}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/",(()=>{"use strict";var e=n(318),t=e(n(926)),r=n(763),s=n(70),i=e(n(848));function o(e){let{error:t}=e;self.postMessage({type:"parsingError",error:t})}function a(e){self.postMessage({type:"log",msg:e})}function f(){return(f=(0,t.default)((function*(e){const{data:t}=e;if(null!=t&&"object"==typeof t&&!Array.isArray(t)){const e=t.file;if(e instanceof Blob)return e.arrayBuffer()}}))).apply(this,arguments)}self.onmessage=function(){var e=(0,t.default)((function*(e){const t=(0,r.createMp4CheckAndRepair)({getWasmModule:()=>(0,s.loadWasmModule)(i.default),logError:a,logMessage:a}),n=yield function(){return f.apply(this,arguments)}(e);if(null==n)return o({error:"null file passed"});const c=yield t({input:n});if(c.success)return function(e){let{value:t}=e;self.postMessage({type:"result",result:{type:"video/mp4",file:new Blob([t],{type:"video/mp4"}),isGif:!1}})}({value:c.value});o({error:c.error})}));return function(){return e.apply(this,arguments)}}()})()})();
//# sourceMappingURL=https://web.whatsapp.com/WAWebMediaWasm.worker.cca37bcdca5dd249703e.worker.js.map
