/*! Copyright (c) 2021 WhatsApp Inc. All Rights Reserved. */
(self.webpackChunkwhatsapp_web_client=self.webpackChunkwhatsapp_web_client||[]).push([[6976],{15760:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.defineWebPersistedJob=function(e){return(0,a.definePersistedJob)(e)};var a=t(27682)},86976:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var a=t(61297),i=t(34176),n=t(26081),s=t(60110),o=t(40362),d=t(42412),_=t(24978),u=t(26767),y=t(15760),l=new a.WapParser("rotateKeyResponseParser",(e=>{e.assertFromServer()})),p=(0,y.defineWebPersistedJob)("rotateKey").step("uploadKeys",(()=>o.waSignalStore.getRegistrationInfo().then((e=>{if(!e)throw new Error("No registration info is available");return o.waSignalStore.rotateSignedPreKey((0,n.toSignalCurveKeyPair)(e.identityKeyPair),d.generateSignedKeyPair)})).then((e=>{__LOG__(2)`rotateKey: signedPreKey uploading`;var r=(0,i.wap)("iq",{xmlns:"encrypt",type:"set",to:i.S_WHATSAPP_NET,id:(0,i.generateId)()},(0,i.wap)("rotate",null,(0,_.xmppSignedPreKey)(e)));return(0,s.sendIq)(r,l).then((e=>{if(e.success)return{shouldDigestKey:!1};var r=!1,t=e.errorCode;return 406===t?__LOG__(3)`rotateKey generated bad key`:409===t?(__LOG__(3)`skey does not pass server validation`,r=!0):t>=500?__LOG__(2)`rotateKey server error ${t}, wait a day`:(__LOG__(2)`rotateKey unrecognized error ${t}`,r=!0),{shouldDigestKey:r}}))})))).finalStep("maybeDigestKey",(e=>{var{shouldDigestKey:r}=e;if(r)return(0,u.digestKey)()})).end();r.default=p}}]);