/*! Copyright (c) 2023 WhatsApp Inc. All Rights Reserved. */
(self.webpackChunkwhatsapp_web_client=self.webpackChunkwhatsapp_web_client||[]).push([[3405],{123405:(e,o,t)=>{"use strict";var n=t(595318);Object.defineProperty(o,"__esModule",{value:!0}),o.userExposureToQuickPromotion=void 0;var r=n(t(81109)),u=n(t(348926)),i=t(259618),s=t(193182),p=t(658265),d=t(732011);function l(){return(l=(0,u.default)((function*(e,o){let{id:t,ts:n,experimentKey:r}=o;if("updated"!==e&&"old-job"!==e)return void __LOG__(3)`userExposureToQuickPromotion: skipping comms step: ${e}`;const u=yield(0,i.sendEventRPC)({eventType:"exposure",eventPromotionId:t,eventTimestampSec:n,eventLogdata:r});"EventResponseSuccess"!==u.name&&(u.name,__LOG__(4,void 0,new Error)`userExposureToQuickPromotion: unable to log`)}))).apply(this,arguments)}const a=(0,s.defineWebPersistedJob)().step("saveToDb",(function(e){let{id:o,experimentKey:t,exposureHoldout:n}=e;return 0===t.length?(__LOG__(4,void 0,new Error,!0)`userExposureToQuickPromotion: missing experiment key`,SEND_LOGS("user-exposure-quick-promotion-missing-exp-key"),"missing-key"):(0,d.getStorage)().lock(["quick-promotions"],function(){var e=(0,u.default)((function*(e){let[u]=e;const i=yield u.get(o);if(null==i)return"not-found";if(null==n)return"old-job";const{tracking:s}=i,{lastLoggedExposure:p}=s;if(null!=p&&p.experimentKey===t&&p.exposureHoldout===n)return"deduped";const d=(0,r.default)((0,r.default)({},s),{},{lastLoggedExposure:{experimentKey:t,exposureHoldout:n}});return yield u.merge(o,{tracking:d}),"updated"}));return function(){return e.apply(this,arguments)}}()).then((e=>"updated"===e?(0,p.loadQuickPromotions)().then((()=>e)):e))})).finalStep("reportToComms",(function(){return l.apply(this,arguments)})).end();o.userExposureToQuickPromotion=a}}]);
//# sourceMappingURL=https://web.whatsapp.com/3405.f109c09bb38af116bea7.js.map
