/*! Copyright (c) 2021 WhatsApp Inc. All Rights Reserved. */
(self.webpackChunkwhatsapp_web_client=self.webpackChunkwhatsapp_web_client||[]).push([[67],{50113:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.defineWebPersistedJob=function(e){return(0,a.definePersistedJob)(e)};var a=t(80547)},60067:(e,r,t)=>{"use strict";var a=t(95318);Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=a(t(48926)),s=t(8701),n=t(43129),o=t(86109),d=t(84922),_=t(93381),y=t(29334),l=t(84105),u=t(44759),p=t(50113),g=new s.WapParser("rotateKeyResponseParser",(e=>{e.assertFromServer()})),f=(0,p.defineWebPersistedJob)("rotateKey").step("uploadKeys",(0,i.default)((function*(){var e=yield _.waSignalStore.getRegistrationInfo().then((e=>{if(!e)throw new Error("No registration info is available");return _.waSignalStore.rotateSignedPreKey((0,o.toSignalCurveKeyPair)(e.identityKeyPair),y.generateSignedKeyPair)}));__LOG__(2)`rotateKey: signedPreKey uploading`;var r=(0,n.wap)("iq",{xmlns:"encrypt",type:"set",to:n.S_WHATSAPP_NET,id:(0,n.generateId)()},(0,n.wap)("rotate",null,(0,l.xmppSignedPreKey)(e))),t=yield(0,d.sendIq)(r,g);if(t.success)return{shouldDigestKey:!1};var a=!1,i=t.errorCode;return 406===i?__LOG__(3)`rotateKey generated bad key`:409===i?(__LOG__(3)`skey does not pass server validation`,a=!0):i>=500?__LOG__(2)`rotateKey server error ${i}, wait a day`:(__LOG__(2)`rotateKey unrecognized error ${i}`,a=!0),{shouldDigestKey:a}}))).finalStep("maybeDigestKey",(e=>{var{shouldDigestKey:r}=e;if(r)return(0,u.digestKey)()})).end();r.default=f}}]);