/*! Copyright (c) 2022 WhatsApp Inc. All Rights Reserved. */
(self.webpackChunkwhatsapp_web_client=self.webpackChunkwhatsapp_web_client||[]).push([[3770],{608219:(e,t,r)=>{"use strict";var n=r(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.AdditionalChargesFormDrawer=function(e){let{currency:t,subtotal:r,additionalCharges:n,onBack:h,onApply:S}=e;const C=(null==n?void 0:n.discountText)||"",[M,T]=(0,u.useState)(C),O=(null==n?void 0:n.taxText)||"",[j,A]=(0,u.useState)(O),P=(null==n?void 0:n.shippingText)||"",[I,E]=(0,u.useState)(P),D=(null==n?void 0:n.discountType)||x,[w,k]=(0,u.useState)(D),R=(null==n?void 0:n.taxType)||_,[L,N]=(0,u.useState)(R),[F,U]=(0,u.useState)(!1),[q,B]=(0,u.useState)(!1),H=(0,u.useMemo)((()=>(0,g.additionalChargeErrorHandler)({currency:t,value:I})),[t,I]),G=[F,q,H].some((e=>e));return(0,v.jsxs)(d.default,{children:[(0,v.jsx)(c.DrawerHeader,{title:l.fbt._("Add discount, shipping or tax",null,{hk:"nPDUK"}),type:c.DRAWER_HEADER_TYPE.SMALL,onBack:C!==M||O!==j||P!==I||D!==w||R!==L?()=>{a.ModalManager.open((0,v.jsx)(m.ConfirmDiscardModal,{onOK:h}))}:h,focusBackOrCancel:!0}),(0,v.jsxs)(f.default,{className:(0,i.default)(o.uiPadding.all16),children:[(0,v.jsx)(p.AdditionalChargesTextInput,{text:M,a8nText:"additional-charges-discount-input",label:l.fbt._("Discount",null,{hk:"3acZrp"}),symbol:w,currency:t,priceValue:r,setText:T,setError:U,setSymbol:k}),(0,v.jsx)(b.TextInput,{value:I,a8n:"additional-charges-shipping-input",placeholder:l.fbt._("Shipping ({currency_symbol})",[l.fbt._param("currency_symbol",(0,s.formatAmount1000ToParts)(t,0).symbol)],{hk:"H2WDY"}),onChange:E,theme:"small",maxLength:10,customStyleThemes:["desaturated"],error:H}),(0,v.jsx)(p.AdditionalChargesTextInput,{text:j,a8nText:"additional-charges-tax-input",label:l.fbt._("Tax",null,{hk:"2r5wzT"}),symbol:L,currency:t,priceValue:r,setText:A,setError:B,setSymbol:N}),(0,v.jsx)(y.OrderApplyChangesButton,{disabled:G,a8nText:"apply-additional-costs-button",title:l.fbt._("Apply",null,{hk:"3E5Tq7"}),onClick:()=>S({discountText:M,taxText:j,shippingText:I,discountType:w,taxType:L})})]})]})};var a=r(914597),o=r(128298),l=r(548360),u=r(667294),i=n(r(156720)),s=r(939519),d=n(r(60453)),c=r(994790),f=n(r(833308)),p=r(852088),m=r(903445),g=r(647188),h=r(859789),y=r(733877),b=r(990011),v=r(785893);const x=h.PERCENTAGE_SYMBOL,_=h.PERCENTAGE_SYMBOL},852088:(e,t,r)=>{"use strict";var n=r(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.AdditionalChargesTextInput=function(e){let{text:t,label:r,symbol:n,a8nText:m,currency:g,priceValue:h,setText:y,setError:b,setSymbol:v}=e;const x=(0,o.useMemo)((()=>{const e=(0,i.additionalChargeErrorHandler)({label:r,currency:g,fieldType:n,maxFlatValue:h/s.DEFAULT_OFFSET,enablePercentValueCheck:!0,value:t});return b(Boolean(e)),e}),[t,r,n,g,b,h]);return(0,c.jsxs)("div",{className:(0,l.default)(f),children:[(0,c.jsx)(d.TextInput,{value:t,a8n:m,placeholder:a.fbt._("{input_label} ({currency_or_percentage})",[a.fbt._param("input_label",r),a.fbt._param("currency_or_percentage",n)],{hk:"vf1Ko"}),onChange:e=>y(e),theme:"small",maxLength:10,customStyleThemes:["desaturated"],error:x}),(0,c.jsx)("div",{className:(0,l.default)(p),children:(0,c.jsx)(u.OrderDetailAmountTypeSelector,{currency:g,value:n,onChange:e=>{let{value:t}=e;return v(t)}})})]})};var a=r(548360),o=r(667294),l=n(r(156720)),u=r(970239),i=r(647188),s=r(859789),d=r(990011),c=r(785893);const f={position:"g0rxnol2"},p={position:"lhggkp7q",end:"ebjesfe0",zIndex:"mb8var44",top:"agjvi7sf"}},15607:(e,t,r)=>{"use strict";var n=r(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.OrderCatalogFormDrawer=function(e){let{currency:t,productsSelection:r,orderItems:n,priceMap:M,onBack:T,onAddProducts:O,onAddCustomItem:j,onProductSelectionChange:A}=e;const[P,I]=(0,i.useState)(!1),E=(0,d.default)(),D=(0,c.default)((()=>new y.default)),w=r.getSelected().reduce(((e,t)=>{var n,a;return e+(null!==(n=null!==(a=t.priceAmount1000)&&void 0!==a?a:M[t.id.toString()])&&void 0!==n?n:0)*Number(r.getVal(t))}),0),k=n.filter((e=>e.isCustomItem)).reduce(((e,t)=>e+t.price*t.quantity),0);return(0,S.jsxs)(p.default,{children:[(0,S.jsx)(g.DrawerHeader,{title:u.fbt._("Add items",null,{hk:"2U1Vru"}),type:g.DRAWER_HEADER_TYPE.SMALL,onBack:P?()=>{o.ModalManager.open((0,S.jsx)(x.ConfirmDiscardModal,{onOK:T}))}:T,focusBackOrCancel:!0}),(0,S.jsxs)(m.default,{children:[(0,S.jsxs)(h.default,{theme:"expand-height",xstyle:C.drawerSection,children:[(0,a.orderDetailsCustomItemEnabled)()&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(b.AddOrderItem,{title:u.fbt._("Create new item",null,{hk:"2GmSAs"}),onClick:j}),(0,S.jsx)("hr",{className:(0,s.default)(C.catalogBar,l.uiMargin.vert0)})]}),(0,S.jsx)("p",{className:(0,s.default)(C.catalogTitleText,l.uiPadding.start16,l.uiPadding.vert10),children:u.fbt._("Catalog items",null,{hk:"4chzUe"})}),(0,S.jsx)(v.default,{className:(0,s.default)(C.catalogProductsList),productsSelection:r,orderItems:n,flatListController:D.current,onProductSelectChange:function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];A(e,t),r||P||I(!0),E()}})]}),(0,S.jsx)(_.OrderTotalPrice,{xstyle:[l.uiPadding.all16,l.uiMargin.top10],visible:!0,disabled:!P,totalPrice:(0,f.formatAmount1000)(t,w+k),a8nButtonText:"save-products-button",onConfirm:O,title:u.fbt._("Subtotal",null,{hk:"4ciFet"}),confirmTitle:u.fbt._("Add to Order",null,{hk:"2SYeoP"})})]})]})};var a=r(408139),o=r(914597),l=r(128298),u=r(548360),i=r(667294),s=n(r(156720)),d=n(r(859312)),c=n(r(616223)),f=r(939519),p=n(r(60453)),m=n(r(69637)),g=r(994790),h=n(r(833308)),y=n(r(630855)),b=r(458795),v=n(r(231499)),x=r(903445),_=r(733877),S=r(785893);const C={catalogTitleText:{fontWeight:"m1e7cby3",lineHeight:"tkq7s68q",fontSize:"ovllcyds",color:"q70jrbp7"},catalogBar:{width:"ln8gz9je",borderEnd:"eta5aym1",borderBottom:"d9802myq",borderStart:"e4xiuwjv",borderTop:"gq6acybq"},catalogProductsList:{overflowX:"i44ccddp",overflowY:"ag5g9lrv",flexGrow:"ggj6brxn",flexShrink:"m0h2a7mj",flexBasis:"l07amlnk"},drawerSection:{display:"p357zi0d",overflowX:"i44ccddp",overflowY:"ag5g9lrv",flexDirection:"f8m0rgwh"}}},39504:(e,t,r)=>{"use strict";var n=r(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.CatalogFormProduct=function(e){let{product:t,productsSelection:r,onProductSelectChange:n}=e;const s=Number(r.getVal(t))||0,[d,c]=(0,o.useState)(!1);return(0,i.jsx)("div",{onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:(0,i.jsx)(l.default,{product:t,detail:(d||r.isSelected(t))&&(0,i.jsx)(u.default,{quantity:s,quantityTitle:a.fbt._("Items in order",null,{hk:"35Mpfd"}),isCollapsed:!d,onAddOneClick:()=>n(t,s+1),onRemoveOneClick:()=>n(t,s-1)}),managedFocus:!0,theme:"product-add-to-order"})})};var a=r(548360),o=r(667294),l=n(r(188990)),u=n(r(776044)),i=r(785893)},231499:(e,t,r)=>{"use strict";var n=r(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{className:t,productsSelection:r,orderItems:n,flatListController:x,onProductSelectChange:_}=e;const S=(0,f.default)(),C=(0,s.default)(),M=(0,i.default)(C,100),T=p.CatalogCollection.assertGet((0,l.getMaybeMeUser)()),[O,j]=(0,u.useState)(!1),[A,P]=(0,u.useState)(0),[I,E]=(0,u.useState)(!1),D=()=>{const e=new Set(n.map((e=>{let{id:t}=e;return t})));return T.productCollection.getProductModels().filter((t=>!e.has(t.id))).map((e=>({itemKey:e.id.toString(),product:e})))},w=e=>{e.forEach((e=>{const t=n.find((t=>{let{id:r}=t;return r===e.product.id}));void 0!==t&&_(e.product,Number(t.quantity),!0)}))},k=function(){var e=(0,a.default)((function*(){if(I)return;if(!T.afterCursor)return;const e=T.productCollection.getProductModels().length;j(!0),P(e);try{const t=yield p.CatalogCollection.update((0,l.getMaybeMeUser)());if(S.aborted)return;j(!1);const r=(Array.isArray(t)?t[0]:t).productCollection.getProductModels().length;if(w(D().slice(e)),r===A&&E(!0),e*m.PRODUCT_LIST_ITEM_HEIGHT<window.innerHeight)return k()}catch(e){j(!1),E(!0)}}));return function(){return e.apply(this,arguments)}}();(0,u.useEffect)((()=>{w(D()),k()}),[]),(0,d.useListener)(T.productCollection,"add",M);const R=(0,c.default)((e=>{O||e.scrollTop+o.SCROLL_FUDGE>e.scrollHeight-e.clientHeight&&k()}),100);return(0,v.jsxs)(h.default,{className:t,flatListControllers:[x],onScroll:e=>{e.currentTarget&&R(e.currentTarget)},children:[(0,v.jsx)(g.FlatList,{flatListController:x,direction:"vertical",forceConsistentRenderCount:!1,data:D(),renderItem:e=>{let{product:t}=e;return(0,v.jsx)(b.CatalogFormProduct,{product:t,productsSelection:r,onProductSelectChange:_})},defaultItemHeight:m.PRODUCT_LIST_ITEM_HEIGHT}),O&&(0,v.jsx)(y.default,{})]})};var a=n(r(348926)),o=r(941906),l=r(978820),u=r(667294),i=n(r(651799)),s=n(r(859312)),d=r(587550),c=n(r(290886)),f=n(r(803409)),p=r(599989),m=r(364481),g=r(747915),h=n(r(944942)),y=n(r(329796)),b=r(39504),v=r(785893)},903445:(e,t,r)=>{"use strict";var n=r(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ConfirmDiscardModal=function(e){let{onOK:t}=e;return(0,i.jsx)(l.default,{title:o.fbt._("Discard changes?",null,{hk:"1SaEaC"}),onOK:()=>{a.ModalManager.close(),t()},okText:o.fbt._("Discard",null,{hk:"3etb6C"}),onCancel:()=>a.ModalManager.close(),children:(0,i.jsx)(u.TextDiv,{theme:"muted",children:o.fbt._("If you close this, your draft will be discarded.",null,{hk:"4G5DVj"})})})};var a=r(914597),o=r(548360),l=n(r(452665)),u=r(113923),i=r(785893)},73668:(e,t,r)=>{"use strict";var n=r(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.CustomItemFormDrawer=function(e){let{currency:t,customItem:r,onBack:n,onSaveCustomItem:s}=e;const[_,S]=(0,u.useState)(null==r?void 0:r.name),[C,M]=(0,u.useState)(Number.isInteger(null==r?void 0:r.price)?String(Number(null==r?void 0:r.price)/1e3):null),[T,O]=(0,u.useState)(null==r?void 0:r.price),[j,A]=(0,u.useState)((null==r?void 0:r.isQuantitySet)?r.quantity:null),[P,I]=(0,u.useState)((null==r?void 0:r.isQuantitySet)?String(r.quantity):null),E=(0,u.useMemo)((()=>function(e){if(null==e)return"";const t=String(l.fbt._("Add a title",null,{hk:"7Lm6B"}));return""===e.trim()?t:""}(_)),[_]),D=(0,u.useMemo)((()=>function(e,t){if(null==t)return"";const r=String(l.fbt._("Enter a valid price",null,{hk:"4yb1Sg"}));return""!==t.trim()&&(0,d.validatePriceString)(e,t,y.MIN_PRICE,y.MAX_PRICE)?"":r}(t,C)),[t,C]),w=(0,u.useMemo)((()=>function(e){if(null==e)return"";const t=String(l.fbt._("Enter a valid quantity",null,{hk:"u6SoG"}));return x(Number(e))?"":t}(P)),[P]),k=function(e,t,r,n){const a=(null==e?void 0:e.isQuantitySet)?Number(n)!==e.quantity:null!=n;return(null==e?void 0:e.name)!==t||(null==e?void 0:e.price)!==r||a}(r,_,T,P);return(0,v.jsxs)(c.default,{children:[(0,v.jsx)(p.DrawerHeader,{title:r?l.fbt._("Update item",null,{hk:"1TL07p"}):l.fbt._("Create new item",null,{hk:"4xRwlm"}),type:p.DRAWER_HEADER_TYPE.SMALL,onBack:k?()=>{a.ModalManager.open((0,v.jsx)(g.ConfirmDiscardModal,{onOK:n}))}:n,focusBackOrCancel:!0}),(0,v.jsx)(f.default,{children:(0,v.jsxs)(m.default,{className:(0,i.default)(o.uiPadding.all16),children:[(0,v.jsx)(b.TextInput,{a8n:"custom-item-edit-name-input",value:_,placeholder:l.fbt._("Item name",null,{hk:"1TMRR7"}),onChange:e=>{S(e)},theme:"small",customStyleThemes:["desaturated"],maxLength:150,error:E}),(0,v.jsx)(b.TextInput,{a8n:"custom-item-edit-price-input",value:C,placeholder:l.fbt._("Price {symbol}",[l.fbt._param("symbol",(0,d.formatAmount1000ToParts)(t,0).symbol)],{hk:"3jcGcb"}),onChange:e=>{const r=(0,d.valueFromString)(t,e);O(r),M(e)},theme:"small",maxLength:30,customStyleThemes:["desaturated"],error:D}),(0,v.jsx)(b.TextInput,{a8n:"custom-item-edit-quantity-input",value:P,placeholder:l.fbt._("Quantity (Optional)",null,{hk:"4swiuO"}),onChange:e=>{let t=""===e?null:Number(e);x(t)||(t=null),A(t),I(""===e?null:e)},theme:"small",maxLength:30,customStyleThemes:["desaturated"],error:w}),(0,v.jsx)(h.OrderApplyChangesButton,{title:r?l.fbt._("Update Order",null,{hk:"HjU1X"}):l.fbt._("Add to Order",null,{hk:"3p1U18"}),disabled:null==_||null==C||!(!r||k)||[E,D,w].some((e=>e)),onClick:()=>{const e={name:_,priceAmount1000:+T,quantity:j,isQuantitySet:Number.isInteger(j)};s(e)},a8nText:"save-custom-item-button"})]})})]})};var a=r(914597),o=r(128298),l=r(548360),u=r(667294),i=n(r(156720)),s=r(109581),d=r(939519),c=n(r(60453)),f=n(r(69637)),p=r(994790),m=n(r(833308)),g=r(903445),h=r(733877),y=r(509468),b=r(990011),v=r(785893);function x(e){return Number.isInteger(e)&&+e>0&&+e<=s.MAX_QUANTITY}},970239:(e,t,r)=>{"use strict";var n=r(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.OrderDetailAmountTypeSelector=function(e){let{value:t,onChange:r,currency:n}=e;const d=l.formatLocalSymbol(n),c=a.fbt._("Select amount type",null,{hk:"1xddkG"}),f=[{id:"percentage",label:a.fbt._("by Percentage ({percentage-symbol})",[a.fbt._param("percentage-symbol",u.PERCENTAGE_SYMBOL)],{hk:"3fQwM3"}),value:u.PERCENTAGE_SYMBOL},{id:"flat-amount",label:a.fbt._("by Flat amount ({currency-symbol})",[a.fbt._param("currency-symbol",d)],{hk:"duPhj"}),value:d}],p=(0,o.useMemo)((()=>f.findIndex((e=>e.value===t))),[]);return(0,s.jsx)(i.default,{"aria-label":c,options:f,defaultIndex:p,onChange:r})};var a=r(548360),o=r(667294),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=d(t);if(r&&r.has(e))return r.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=a?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(n,o,l):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(r(939519)),u=r(859789),i=n(r(343369)),s=r(785893);function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(d=function(e){return e?r:t})(e)}},343369:(e,t,r)=>{"use strict";var n=r(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{defaultIndex:t=0,options:r,onChange:n,"aria-label":p}=e;const m=(0,a.useRef)(null),[g,h]=(0,a.useState)(!1),[y,b]=(0,a.useState)(t),v=r.map(((e,t)=>{const{id:r,label:a}=e;return(0,c.jsx)(u.DropdownItem,{a8n:`mi-${r}`,action:()=>{n(e),b(t)},children:(0,c.jsx)("div",{className:(0,o.default)(f),role:"button","aria-label":a,children:t===y?(0,c.jsx)(i.TextSpan,{weight:"bold",children:a}):a})},r)}));return(0,c.jsxs)("div",{ref:m,children:[(0,c.jsx)(l.default,{"aria-label":p,postfixIcon:"down",label:r[y].value,onClick:()=>h((e=>!e))}),g&&m.current&&(0,c.jsx)(s.UIE,{displayName:"ValuePicker",escapable:!0,popable:!0,dismissOnWindowResize:!0,requestDismiss:()=>h(!1),children:(0,c.jsx)(d.default,{contextMenu:{menu:v,anchor:m.current}})})]})};var a=r(667294),o=n(r(156720)),l=n(r(972332)),u=r(471174),i=r(113923),s=r(718644),d=n(r(624717)),c=r(785893);const f={boxSizing:"cm280p3y",color:"tviruh8d",cursor:"ajgl1lbb",fontSize:"f8jlpxt4",height:"lniyxyh2",lineHeight:"gz7w46tb",overflowX:"gfz4du6o",overflowY:"r7fjleex",paddingStart:"sta02ykp",paddingEnd:"pnfw7ual",paddingTop:"lqdozo90",textOverflow:"lhj4utae",whiteSpace:"le5p0ye3",position:"g0rxnol2"}},729886:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorMsgFromProducts=u,t.notifyIfAnyProductMissesPrice=void 0;var n=r(694816),a=r(548360),o=r(950452),l=r(785893);function u(e){const t=e.length;return 0===t?"":1===t?a.fbt._("Enter a price for {first-product-name}",[a.fbt._param("first-product-name",e[0])],{hk:"Lf39K"}):2===t?a.fbt._("Enter prices for {first-product-name} and {second-product-name}",[a.fbt._param("first-product-name",e[0]),a.fbt._param("second-product-name",e[1])],{hk:"1uLet0"}):a.fbt._({"*":"Enter prices for {first-product-name}, {second-product-name} and {other-items} other items",_1:"Enter prices for {first-product-name}, {second-product-name} and 1 other item"},[a.fbt._plural(t-2,"other-items"),a.fbt._param("first-product-name",e[0]),a.fbt._param("second-product-name",e[1])],{hk:"1Crsuq"})}t.notifyIfAnyProductMissesPrice=(e,t)=>{const r=u(e.reduce(((e,r)=>{var n;const a=null!==(n=r.price)&&void 0!==n?n:t[r.id];return Number.isInteger(a)||e.push(r.name||""),e}),[]));r&&n.ToastManager.open((0,l.jsx)(o.Toast,{duration:1e4,id:(0,o.genId)(),msg:r,action:{actionText:a.fbt._("OKAY",null,{hk:"3RIrWh"}),dismiss:!0,theme:"success"}}))}},163770:(e,t,r)=>{"use strict";var n=r(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{entryPoint:t,order:r,chat:n,onBack:b}=e;const[v,L]=(0,f.useState)(N.ORDER_SUMMARY),[q,B]=(0,f.useState)(null),[H,G]=(0,f.useState)(!1),[Y,Q]=(0,f.useState)((()=>function(e){if(!e)return[];const t={isCustomItem:!1,isQuantitySet:!0},r=e.products.map((e=>new E.default((0,o.default)((0,o.default)({},t),e))));return(0,I.notifyIfAnyProductMissesPrice)(r,{}),r}(r))),[W,z]=(0,f.useState)({}),[V,K]=(0,f.useState)(null),X=(0,m.default)((()=>new s.default([],(e=>e.id.toString())))).current,$=y.CatalogCollection.get((0,d.getMeUser)()),Z=(e,t)=>{z((r=>(0,o.default)((0,o.default)({},r),{},{[t]:e})))},J=(0,f.useMemo)((()=>Y.reduce(((e,t)=>{var r,n;return e+(null!==(r=null!==(n=t.price)&&void 0!==n?n:W[t.id])&&void 0!==r?r:0)*t.quantity}),0)),[Y,W]),ee=(0,j.calculateFlatAmounts)({orderSubtotal:J/j.DEFAULT_OFFSET,discountType:(null==V?void 0:V.discountType)||"",discountText:(null==V?void 0:V.discountText)||"",taxType:(null==V?void 0:V.taxType)||"",taxText:(null==V?void 0:V.taxText)||"",shippingText:(null==V?void 0:V.shippingText)||""}),te=(0,h.hasCatalog)(g.BusinessProfileCollection.get((0,d.getMaybeMeUser)())),re=()=>{const e=Y.some((e=>W[e.id]));new _.default.OrderDetailsActionsSmb({orderDetailsCreationAction:_.default.ORDER_DETAILS_CREATION_ACTION.SEND_ORDER_DETAILS,actionCategory:String(P.default.ORDER_DETAILS_CREATION),hasCatalog:te,hasAddedPrice:e,orderDetailEntryPoint:String(t)}).commit();const a=null!=r?r:M.OrderCollection.addOrder();a.products=Y.map((e=>{var t;return e.price=null!==(t=e.price)&&void 0!==t?t:W[e.id],e.currency=U,e})),a.currency=U,a.subtotal=J,a.triggerItemCollectionUpdate(),(0,w.sendOrderDetailsMessageAsMerchant)({order:a,chat:n,orderNote:"",offset:j.DEFAULT_OFFSET,total:ee.total,discount:ee.discount,shipping:ee.shipping,tax:ee.tax}),l.DrawerManager.closeDrawerRight()},ne=(0,p.default)((()=>{b?b():l.DrawerManager.closeDrawerRight()})),ae=()=>{!function(e,t,r){if(!e)return t.length>0;return t.length!==e.products.length||t.some(((t,n)=>{var a,o;return t.id!==e.products[n].id||t.quantity!==e.products[n].quantity||(null!==(a=null!==(o=t.price)&&void 0!==o?o:r[t.id])&&void 0!==a?a:null)!==e.products[n].price}))}(r,Y,W)?ne():i.ModalManager.open((0,R.jsx)(T.ConfirmDiscardModal,{onOK:ne}))},oe=e=>{!0!==e&&(0,I.notifyIfAnyProductMissesPrice)(Y,W),L(N.ORDER_SUMMARY)},le=()=>{L(N.CATALOG_PRODUCTS_FORM)},ue=(e,t)=>{const r=Number.isInteger(e)?e:null;B(r),G(!0===t),L(null==r||Y[r].isCustomItem?N.CUSTOM_ITEM_FORM:N.CATALOG_PRODUCTS_FORM)},ie=()=>{L(N.ADDITIONAL_CHARGES_FORM)},se=(e,t)=>{const r=e.length,n=e.reduce(((e,t,r)=>e.set(t.id,r)),new Map);return[...t].sort(((e,t)=>{var a,o;return(null!==(a=n.get(e.id))&&void 0!==a?a:r)-(null!==(o=n.get(t.id))&&void 0!==o?o:r)}))},de=e=>e.map((e=>{var t;return new E.default({id:e.id,name:e.name,price:e.priceAmount1000,thumbnailUrl:null===(t=e.getPreviewImage())||void 0===t?void 0:t.mediaUrl,quantity:Number(X.getVal(e)),isCustomItem:!1,isQuantitySet:!0})})),ce=(e,t,r)=>{const n=null==$?void 0:$.productCollection.getProductModels(),a=new Set(t.map((e=>{let{id:t}=e;return t}))),o=new Set(null==n?void 0:n.map((e=>{let{id:t}=e;return t})));return r.reduce(((e,t)=>{const r=a.has(t.id),n=o.has(t.id);return r||n?e:e.concat(t)}),e)},fe=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];te&&Q((t=>{const r=X.getSelected(),n=de(r),a=ce(n,r,t);return e&&(0,I.notifyIfAnyProductMissesPrice)(a,W),se(t,a)}))},pe=e=>X.getSelected().find((t=>{let{id:r}=t;return r===e.id})),me=(e,t)=>{X.setVal(e,t)},ge=e=>{if(!Y[e].isCustomItem){const t=pe(Y[e]);t&&me(t,0)}Q((t=>[...t.slice(0,e),...t.slice(e+1)]))},he=(e,t)=>{if(Y[e].isCustomItem)((e,t)=>{t?Q((r=>{const n=[...r];return n[e].quantity=t,n[e].isQuantitySet=!0,n})):ge(e)})(e,t);else{const r=pe(Y[e]);r&&me(r,t),fe(!1)}},ye=function(){var e=(0,a.default)((function*(e){var t;let r,n=null==$?void 0:$.productCollection.getProductModels(),a=(null===(t=n)||void 0===t?void 0:t.length)||0,o=0;for(;(!r||!X.isSelected(r))&&o<a;){var l,u;yield y.CatalogCollection.update((0,d.getMaybeMeUser)()),o=a,n=null==$?void 0:$.productCollection.getProductModels(),r=null===(l=n)||void 0===l?void 0:l.find((t=>t.id===e.id)),r&&me(r,e.quantity),a=null===(u=n)||void 0===u?void 0:u.length}}));return function(){return e.apply(this,arguments)}}();(0,f.useEffect)((()=>{(()=>{if(!r)return[];const e=null==$?void 0:$.productCollection.getProductModels();for(const t of r.products){const r=null==e?void 0:e.find((e=>e.id===t.id));r?me(r,t.quantity):ye(t)}})()}),[]);const be=F.indexOf(v);if(!v)return null;return(0,R.jsx)(c.default,{children:(0,R.jsx)(k.UIE,{displayName:`FlowDrawer${be}`,escapable:!0,children:(0,R.jsx)("div",{children:(e=>{switch(e){case N.CATALOG_PRODUCTS_FORM:return(0,R.jsx)(C.OrderCatalogFormDrawer,{currency:U,productsSelection:X,orderItems:Y,priceMap:W,onBack:oe,onAddProducts:()=>{fe(),oe(!0)},onAddCustomItem:()=>{ue(null,!0)},onProductSelectionChange:me});case N.CUSTOM_ITEM_FORM:return(0,R.jsx)(O.CustomItemFormDrawer,{currency:U,onBack:H?le:oe,onSaveCustomItem:e=>{fe(),(e=>{let{name:t,priceAmount1000:r,quantity:n,isQuantitySet:a}=e;const o=`${(0,A.getCustomItemIdPrefix)()}-${(0,x.default)()}`;Q((e=>se(e,[...e,new E.default({id:o,name:t,price:r,quantity:null!=n?n:1,isCustomItem:!0,isQuantitySet:a})])))})(e),oe()},customItem:Y[Number.isInteger(q)?Number(q):-1]});case N.ORDER_SUMMARY:return(0,R.jsx)(D.OrderSummaryDrawer,{chat:n,currency:U,priceMap:W,orderItems:Y,orderSubtotal:J,additionalCharges:V,flatAmounts:ee,onPriceChange:Z,onBack:ae,onSubmit:re,onAddItem:te&&(0,u.orderDetailsFromCatalogEnabled)()?le:ue,onAdditionalCharges:ie,onDeleteItem:ge,onItemQuantityChange:he});case N.ADDITIONAL_CHARGES_FORM:return(0,R.jsx)(S.AdditionalChargesFormDrawer,{currency:U,additionalCharges:V,subtotal:J,onBack:oe,onApply:e=>{K((t=>(0,o.default)((0,o.default)({},t),e))),oe()}})}})(v)})},be)})};var a=n(r(348926)),o=n(r(81109)),l=r(141455),u=r(408139),i=r(914597),s=n(r(578931)),d=r(978820),c=n(r(540436)),f=r(667294),p=n(r(616031)),m=n(r(616223)),g=r(493581),h=r(794010),y=r(599989),b=r(92059),v=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=L(t);if(r&&r.has(e))return r.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=a?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(n,o,l):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(r(939519)),x=n(r(248456)),_=n(r(11339)),S=r(608219),C=r(15607),M=r(584312),T=r(903445),O=r(73668),j=r(859789),A=r(834841),P=n(r(661944)),I=r(729886),E=n(r(852822)),D=r(152604),w=r(973150),k=r(718644),R=r(785893);function L(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(L=function(e){return e?r:t})(e)}const N=r(76672).Mirrored(["CATALOG_PRODUCTS_FORM","CUSTOM_ITEM_FORM","ORDER_SUMMARY","ADDITIONAL_CHARGES_FORM"]),F=Array.from(N.members()),U=v.currencyForCountryShortcode((0,b.getCountryShortcodeByPhone)((0,d.getMeUser)().user))}}]);
//# sourceMappingURL=https://web.whatsapp.com/3770.122517e7ed221ad6aa9f.js.map
