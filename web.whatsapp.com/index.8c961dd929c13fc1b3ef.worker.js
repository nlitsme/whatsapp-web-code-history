/*! Copyright (c) 2021 WhatsApp Inc. All Rights Reserved. */(()=>{var e={8103:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="function"==typeof WeakMap?new WeakMap:new Map;function r(e){var t=n.get(e);if(void 0!==t)return t;var r=Object.getOwnPropertyNames(e),i=new Set(r.map((t=>e[t])));return n.set(e,i),i}var i=Object.freeze(Object.defineProperties(Object.create(null),{isValid:{value:function(e){return r(this).has(e)}},cast:{value:function(e){return this.isValid(e)?e:void 0}},members:{value:function(){return r(this).values()}}}));function a(e){var n=Object.create(i);for(var r in e)t.call(e,r)&&Object.defineProperty(n,r,{value:e[r]});return Object.freeze(n)}var o=Object.freeze(Object.defineProperties(Object.create(null),{isValid:{value:function(e){return"string"==typeof e&&t.call(this,e)}},cast:{value:i.cast},members:{value:function(){return Object.getOwnPropertyNames(this)}}}));a.Mirrored=function(e){for(var t=Object.create(o),n=0,r=e.length;n<r;++n)Object.defineProperty(t,e[n],{value:e[n]});return Object.freeze(t)},Object.freeze(a.Mirrored),e.exports=Object.freeze(a)},2954:e=>{function t(e,t,n,r,i,a,o){try{var u=e[a](o),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(i,a){var o=e.apply(n,r);function u(e){t(o,i,a,u,s,"next",e)}function s(e){t(o,i,a,u,s,"throw",e)}u(void 0)}))}}},1260:e=>{e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},4859:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}}},3291:(e,t,n)=>{var r=n(8921);function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}e.exports=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var u=a?Object.getOwnPropertyDescriptor(e,o):null;u&&(u.get||u.set)?Object.defineProperty(n,o,u):n[o]=e[o]}return n.default=e,t&&t.set(e,n),n}},417:(e,t,n)=>{var r=n(1260);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}e.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}},9976:e=>{e.exports=function(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}},8921:e=>{function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=t=function(e){return typeof e}:e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(n)}e.exports=t},7715:(e,t,n)=>{"use strict";n.r(t);var r=Object.keys,i=Array.isArray,a="undefined"!=typeof self?self:"undefined"!=typeof window?window:n.g;function o(e,t){return"object"!=typeof t||r(t).forEach((function(n){e[n]=t[n]})),e}var u=Object.getPrototypeOf,s={}.hasOwnProperty;function c(e,t){return s.call(e,t)}function l(e,t){"function"==typeof t&&(t=t(u(e))),r(t).forEach((function(n){d(e,n,t[n])}))}var f=Object.defineProperty;function d(e,t,n,r){f(e,t,o(n&&c(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function h(e){return{from:function(t){return e.prototype=Object.create(t.prototype),d(e.prototype,"constructor",e),{extend:l.bind(null,e.prototype)}}}}var p=Object.getOwnPropertyDescriptor;function v(e,t){var n;return p(e,t)||(n=u(e))&&v(n,t)}var m=[].slice;function y(e,t,n){return m.call(e,t,n)}function g(e,t){return t(e)}function _(e){if(!e)throw new Error("Assertion Failed")}function b(e){a.setImmediate?setImmediate(e):setTimeout(e,0)}function w(e,t){return e.reduce((function(e,n,r){var i=t(n,r);return i&&(e[i[0]]=i[1]),e}),{})}function E(e,t){return function(){try{e.apply(this,arguments)}catch(e){t(e)}}}function O(e,t,n){try{e.apply(null,n)}catch(e){t&&t(e)}}function P(e,t){if(c(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,i=t.length;r<i;++r){var a=P(e,t[r]);n.push(a)}return n}var o=t.indexOf(".");if(-1!==o){var u=e[t.substr(0,o)];return void 0===u?void 0:P(u,t.substr(o+1))}}function S(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){_("string"!=typeof n&&"length"in n);for(var r=0,i=t.length;r<i;++r)S(e,t[r],n[r])}else{var a=t.indexOf(".");if(-1!==a){var o=t.substr(0,a),u=t.substr(a+1);if(""===u)void 0===n?delete e[o]:e[o]=n;else{var s=e[o];s||(s=e[o]={}),S(s,u,n)}}else void 0===n?delete e[t]:e[t]=n}}function x(e){var t={};for(var n in e)c(e,n)&&(t[n]=e[n]);return t}var C=[].concat;function I(e){return C.apply([],e)}var k="Boolean,String,Date,RegExp,Blob,File,FileList,ArrayBuffer,DataView,Uint8ClampedArray,ImageData,Map,Set".split(",").concat(I([8,16,32,64].map((function(e){return["Int","Uint","Float"].map((function(t){return t+e+"Array"}))})))).filter((function(e){return a[e]})).map((function(e){return a[e]}));function A(e){if(!e||"object"!=typeof e)return e;var t;if(i(e)){t=[];for(var n=0,r=e.length;n<r;++n)t.push(A(e[n]))}else if(k.indexOf(e.constructor)>=0)t=e;else for(var a in t=e.constructor?Object.create(e.constructor.prototype):{},e)c(e,a)&&(t[a]=A(e[a]));return t}function M(e,t,n,i){return n=n||{},i=i||"",r(e).forEach((function(r){if(c(t,r)){var a=e[r],o=t[r];"object"==typeof a&&"object"==typeof o&&a&&o&&""+a.constructor==""+o.constructor?M(a,o,n,i+r+"."):a!==o&&(n[i+r]=t[r])}else n[i+r]=void 0})),r(t).forEach((function(r){c(e,r)||(n[i+r]=t[r])})),n}var T="undefined"!=typeof Symbol&&Symbol.iterator,j=T?function(e){var t;return null!=e&&(t=e[T])&&t.apply(e)}:function(){return null},R={};function D(e){var t,n,r,a;if(1===arguments.length){if(i(e))return e.slice();if(this===R&&"string"==typeof e)return[e];if(a=j(e)){for(n=[];!(r=a.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"==typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var N="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function F(e,t){N=e,K=t}var K=function(){return!0},Y=!new Error("").stack;function L(){if(Y)try{throw L.arguments,new Error}catch(e){return e}return new Error}function U(e,t){var n=e.stack;return n?(t=t||0,0===n.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),n.split("\n").slice(t).filter(K).map((function(e){return"\n"+e})).join("")):""}var B=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],V=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(B),z={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed"};function q(e,t){this._e=L(),this.name=e,this.message=t}function W(e,t,n,r){this._e=L(),this.failures=t,this.failedKeys=r,this.successCount=n}function H(e,t){this._e=L(),this.name="BulkError",this.failures=t,this.message=function(e,t){return e+". Errors: "+t.map((function(e){return e.toString()})).filter((function(e,t,n){return n.indexOf(e)===t})).join("\n")}(e,t)}h(q).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+U(this._e,2))}},toString:function(){return this.name+": "+this.message}}),h(W).from(q),h(H).from(q);var G=V.reduce((function(e,t){return e[t]=t+"Error",e}),{}),X=q,Q=V.reduce((function(e,t){var n=t+"Error";function r(e,r){this._e=L(),this.name=n,e?"string"==typeof e?(this.message=e,this.inner=r||null):"object"==typeof e&&(this.message=e.name+" "+e.message,this.inner=e):(this.message=z[t]||n,this.inner=null)}return h(r).from(X),e[t]=r,e}),{});Q.Syntax=SyntaxError,Q.Type=TypeError,Q.Range=RangeError;var J=B.reduce((function(e,t){return e[t+"Error"]=Q[t],e}),{});var Z=V.reduce((function(e,t){return-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=Q[t]),e}),{});function $(){}function ee(e){return e}function te(e,t){return null==e||e===ee?t:function(n){return t(e(n))}}function ne(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function re(e,t){return e===$?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?ne(r,this.onsuccess):r),i&&(this.onerror=this.onerror?ne(i,this.onerror):i),void 0!==a?a:n}}function ie(e,t){return e===$?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?ne(n,this.onsuccess):n),r&&(this.onerror=this.onerror?ne(r,this.onerror):r)}}function ae(e,t){return e===$?t:function(n){var r=e.apply(this,arguments);o(n,r);var i=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var u=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?ne(i,this.onsuccess):i),a&&(this.onerror=this.onerror?ne(a,this.onerror):a),void 0===r?void 0===u?void 0:u:o(r,u)}}function oe(e,t){return e===$?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function ue(e,t){return e===$?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,i=arguments.length,a=new Array(i);i--;)a[i]=arguments[i];return n.then((function(){return t.apply(r,a)}))}return t.apply(this,arguments)}}Z.ModifyError=W,Z.DexieError=q,Z.BulkError=H;var se={},ce=function(){try{return new Function("let F=async ()=>{},p=F();return [p,Object.getPrototypeOf(p),Promise.resolve(),F.constructor];")()}catch(t){var e=a.Promise;return e?[e.resolve(),e.prototype,e.resolve()]:[]}}(),le=ce[0],fe=ce[1],de=ce[2],he=fe&&fe.then,pe=le&&le.constructor,ve=ce[3],me=!!de,ye=!1,ge=de?function(){de.then(Ue)}:a.setImmediate?setImmediate.bind(null,Ue):a.MutationObserver?function(){var e=document.createElement("div");new MutationObserver((function(){Ue(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:function(){setTimeout(Ue,0)},_e=function(e,t){Ie.push([e,t]),we&&(ge(),we=!1)},be=!0,we=!0,Ee=[],Oe=[],Pe=null,Se=ee,xe={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ft,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((function(e){try{ft(e[0],e[1])}catch(e){}}))}},Ce=xe,Ie=[],ke=0,Ae=[];function Me(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=$,this._lib=!1;var t=this._PSD=Ce;if(N&&(this._stackHolder=L(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==se)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&De(this,this._value))}this._state=null,this._value=null,++t.ref,Re(this,e)}var Te={get:function(){var e=Ce,t=Je;function n(n,r){var i=this,a=!e.global&&(e!==Ce||t!==Je);a&&tt();var o=new Me((function(t,o){Fe(i,new je(st(n,e,a),st(r,e,a),t,o,e))}));return N&&Le(o,this),o}return n.prototype=se,n},set:function(e){d(this,"then",e&&e.prototype===se?Te:{get:function(){return e},set:Te.set})}};function je(e,t,n,r,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=i}function Re(e,t){try{t((function(t){if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&Be();t&&"function"==typeof t.then?Re(e,(function(e,n){t instanceof Me?t._then(e,n):t.then(e,n)})):(e._state=!0,e._value=t,Ne(e)),n&&Ve()}}),De.bind(null,e))}catch(t){De(e,t)}}function De(e,t){if(Oe.push(t),null===e._state){var n=e._lib&&Be();t=Se(t),e._state=!1,e._value=t,N&&null!==t&&"object"==typeof t&&!t._promise&&O((function(){var n=v(t,"stack");t._promise=e,d(t,"stack",{get:function(){return ye?n&&(n.get?n.get.apply(t):n.value):e.stack}})})),function(e){Ee.some((function(t){return t._value===e._value}))||Ee.push(e)}(e),Ne(e),n&&Ve()}}function Ne(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)Fe(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),0===ke&&(++ke,_e((function(){0==--ke&&ze()}),[]))}function Fe(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++ke,_e(Ke,[n,e,t])}else e._listeners.push(t)}function Ke(e,t,n){try{Pe=t;var r,i=t._value;t._state?r=e(i):(Oe.length&&(Oe=[]),r=e(i),-1===Oe.indexOf(i)&&function(e){var t=Ee.length;for(;t;)if(Ee[--t]._value===e._value)return void Ee.splice(t,1)}(t)),n.resolve(r)}catch(e){n.reject(e)}finally{Pe=null,0==--ke&&ze(),--n.psd.ref||n.psd.finalize()}}function Ye(e,t,n){if(t.length===n)return t;var r="";if(!1===e._state){var i,a,o=e._value;null!=o?(i=o.name||"Error",a=o.message||o,r=U(o,0)):(i=o,a=""),t.push(i+(a?": "+a:"")+r)}return N&&((r=U(e._stackHolder,2))&&-1===t.indexOf(r)&&t.push(r),e._prev&&Ye(e._prev,t,n)),t}function Le(e,t){var n=t?t._numPrev+1:0;n<100&&(e._prev=t,e._numPrev=n)}function Ue(){Be()&&Ve()}function Be(){var e=be;return be=!1,we=!1,e}function Ve(){var e,t,n;do{for(;Ie.length>0;)for(e=Ie,Ie=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(Ie.length>0);be=!0,we=!0}function ze(){var e=Ee;Ee=[],e.forEach((function(e){e._PSD.onunhandled.call(null,e._value,e)}));for(var t=Ae.slice(0),n=t.length;n;)t[--n]()}function qe(e){return new Me(se,!1,e)}function We(e,t){var n=Ce;return function(){var r=Be(),i=Ce;try{return at(n,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{at(i,!1),r&&Ve()}}}l(Me.prototype,{then:Te,_then:function(e,t){Fe(this,new je(null,null,e,t,Ce))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"==typeof t?this.then(null,(function(e){return e instanceof t?n(e):qe(e)})):this.then(null,(function(e){return e&&e.name===t?n(e):qe(e)}))},finally:function(e){return this.then((function(t){return e(),t}),(function(t){return e(),qe(t)}))},stack:{get:function(){if(this._stack)return this._stack;try{ye=!0;var e=Ye(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{ye=!1}}},timeout:function(e,t){var n=this;return e<1/0?new Me((function(r,i){var a=setTimeout((function(){return i(new Q.Timeout(t))}),e);n.then(r,i).finally(clearTimeout.bind(null,a))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&d(Me.prototype,Symbol.toStringTag,"Promise"),xe.env=ot(),l(Me,{all:function(){var e=D.apply(null,arguments).map(nt);return new Me((function(t,n){0===e.length&&t([]);var r=e.length;e.forEach((function(i,a){return Me.resolve(i).then((function(n){e[a]=n,--r||t(e)}),n)}))}))},resolve:function(e){if(e instanceof Me)return e;if(e&&"function"==typeof e.then)return new Me((function(t,n){e.then(t,n)}));var t=new Me(se,!0,e);return Le(t,Pe),t},reject:qe,race:function(){var e=D.apply(null,arguments).map(nt);return new Me((function(t,n){e.map((function(e){return Me.resolve(e).then(t,n)}))}))},PSD:{get:function(){return Ce},set:function(e){return Ce=e}},newPSD:$e,usePSD:ut,scheduler:{get:function(){return _e},set:function(e){_e=e}},rejectionMapper:{get:function(){return Se},set:function(e){Se=e}},follow:function(e,t){return new Me((function(n,r){return $e((function(t,n){var r=Ce;r.unhandleds=[],r.onunhandled=n,r.finalize=ne((function(){var e=this;!function(e){function t(){e(),Ae.splice(Ae.indexOf(t),1)}Ae.push(t),++ke,_e((function(){0==--ke&&ze()}),[])}((function(){0===e.unhandleds.length?t():n(e.unhandleds[0])}))}),r.finalize),e()}),t,n,r)}))}});var He={awaits:0,echoes:0,id:0},Ge=0,Xe=[],Qe=0,Je=0,Ze=0;function $e(e,t,n,r){var i=Ce,a=Object.create(i);a.parent=i,a.ref=0,a.global=!1,a.id=++Ze;var u=xe.env;a.env=me?{Promise:Me,PromiseProp:{value:Me,configurable:!0,writable:!0},all:Me.all,race:Me.race,resolve:Me.resolve,reject:Me.reject,nthen:ct(u.nthen,a),gthen:ct(u.gthen,a)}:{},t&&o(a,t),++i.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()};var s=ut(a,e,n,r);return 0===a.ref&&a.finalize(),s}function et(){return He.id||(He.id=++Ge),++He.awaits,He.echoes+=7,He.id}function tt(e){!He.awaits||e&&e!==He.id||(0==--He.awaits&&(He.id=0),He.echoes=7*He.awaits)}function nt(e){return He.echoes&&e&&e.constructor===pe?(et(),e.then((function(e){return tt(),e}),(function(e){return tt(),dt(e)}))):e}function rt(e){++Je,He.echoes&&0!=--He.echoes||(He.echoes=He.id=0),Xe.push(Ce),at(e,!0)}function it(){var e=Xe[Xe.length-1];Xe.pop(),at(e,!1)}function at(e,t){var n,r=Ce;if((t?!He.echoes||Qe++&&e===Ce:!Qe||--Qe&&e===Ce)||(n=t?rt.bind(null,e):it,he.call(le,n)),e!==Ce&&(Ce=e,r===xe&&(xe.env=ot()),me)){var i=xe.env.Promise,o=e.env;fe.then=o.nthen,i.prototype.then=o.gthen,(r.global||e.global)&&(Object.defineProperty(a,"Promise",o.PromiseProp),i.all=o.all,i.race=o.race,i.resolve=o.resolve,i.reject=o.reject)}}function ot(){var e=a.Promise;return me?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(a,"Promise"),all:e.all,race:e.race,resolve:e.resolve,reject:e.reject,nthen:fe.then,gthen:e.prototype.then}:{}}function ut(e,t,n,r,i){var a=Ce;try{return at(e,!0),t(n,r,i)}finally{at(a,!1)}}function st(e,t,n){return"function"!=typeof e?e:function(){var r=Ce;n&&et(),at(t,!0);try{return e.apply(this,arguments)}finally{at(r,!1)}}}function ct(e,t){return function(n,r){return e.call(this,st(n,t,!1),st(r,t,!1))}}var lt="unhandledrejection";function ft(e,t){var n;try{n=t.onuncatched(e)}catch(e){}if(!1!==n)try{var r,i={promise:t,reason:e};if(a.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(lt,!0,!0),o(r,i)):a.CustomEvent&&o(r=new CustomEvent(lt,{detail:i}),i),r&&a.dispatchEvent&&(dispatchEvent(r),!a.PromiseRejectionEvent&&a.onunhandledrejection))try{a.onunhandledrejection(r)}catch(e){}r.defaultPrevented||console.warn("Unhandled rejection: "+(e.stack||e))}catch(e){}}var dt=Me.reject;function ht(e){var t={},n=function(n,r){if(r){for(var i=arguments.length,a=new Array(i-1);--i;)a[i-1]=arguments[i];return t[n].subscribe.apply(null,a),e}if("string"==typeof n)return t[n]};n.addEventType=u;for(var a=1,o=arguments.length;a<o;++a)u(arguments[a]);return n;function u(e,r,i){if("object"==typeof e)return s(e);r||(r=oe),i||(i=$);var a={subscribers:[],fire:i,subscribe:function(e){-1===a.subscribers.indexOf(e)&&(a.subscribers.push(e),a.fire=r(a.fire,e))},unsubscribe:function(e){a.subscribers=a.subscribers.filter((function(t){return t!==e})),a.fire=a.subscribers.reduce(r,i)}};return t[e]=n[e]=a,a}function s(e){r(e).forEach((function(t){var n=e[t];if(i(n))u(t,e[t][0],e[t][1]);else{if("asap"!==n)throw new Q.InvalidArgument("Invalid event config");var r=u(t,ee,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];r.subscribers.forEach((function(e){b((function(){e.apply(null,t)}))}))}))}}))}}var pt,vt="{version}",mt=String.fromCharCode(65535),yt=function(){try{return IDBKeyRange.only([[]]),[[]]}catch(e){return mt}}(),gt=-1/0,_t="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",bt="String expected.",wt=[],Et="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Ot=Et,Pt=Et,St=function(e){return!/(dexie\.js|dexie\.min\.js)/.test(e)};function xt(e,t){var n,u,s,f,h,p=xt.dependencies,v=o({addons:xt.addons,autoOpen:!0,indexedDB:p.indexedDB,IDBKeyRange:p.IDBKeyRange},t),m=v.addons,b=v.autoOpen,C=v.indexedDB,k=v.IDBKeyRange,T=this._dbSchema={},j=[],F=[],K={},Y=null,B=null,V=!1,z=null,q=!1,G="readonly",X="readwrite",J=this,Z=new Me((function(e){n=e})),ne=new Me((function(e,t){u=t})),oe=!0,se=!!Kt(C);function ce(e){this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null},this.stores({})}function le(e,t,n){var i=J._createTransaction(X,F,T);i.create(t),i._completion.catch(n);var a=i._reject.bind(i);$e((function(){Ce.trans=i,0===e?(r(T).forEach((function(e){fe(t,e,T[e].primKey,T[e].indexes)})),Me.follow((function(){return J.on.populate.fire(i)})).catch(a)):function(e,t,n){var i=[],a=j.filter((function(t){return t._cfg.version===e}))[0];if(!a)throw new Q.Upgrade("Dexie specification of currently installed DB version is missing");T=J._dbSchema=a._cfg.dbschema;var o=!1;function u(){return i.length?Me.resolve(i.shift()(t.idbtrans)).then(u):Me.resolve()}return j.filter((function(t){return t._cfg.version>e})).forEach((function(e){i.push((function(){var r=T,i=e._cfg.dbschema;Ne(r,n),Ne(i,n),T=J._dbSchema=i;var a=function(e,t){var n={del:[],add:[],change:[]};for(var r in e)t[r]||n.del.push(r);for(r in t){var i=e[r],a=t[r];if(i){var o={name:r,def:a,recreate:!1,del:[],add:[],change:[]};if(i.primKey.src!==a.primKey.src)o.recreate=!0,n.change.push(o);else{var u=i.idxByName,s=a.idxByName;for(var c in u)s[c]||o.del.push(c);for(c in s){var l=u[c],f=s[c];l?l.src!==f.src&&o.change.push(f):o.add.push(f)}(o.del.length>0||o.add.length>0||o.change.length>0)&&n.change.push(o)}}else n.add.push([r,a])}return n}(r,i);if(a.add.forEach((function(e){fe(n,e[0],e[1].primKey,e[1].indexes)})),a.change.forEach((function(e){if(e.recreate)throw new Q.Upgrade("Not yet support for changing primary key");var t=n.objectStore(e.name);e.add.forEach((function(e){de(t,e)})),e.change.forEach((function(e){t.deleteIndex(e.name),de(t,e)})),e.del.forEach((function(e){t.deleteIndex(e)}))})),e._cfg.contentUpgrade)return o=!0,Me.follow((function(){e._cfg.contentUpgrade(t)}))})),i.push((function(t){o&&Ot||function(e,t){for(var n=0;n<t.db.objectStoreNames.length;++n){var r=t.db.objectStoreNames[n];null==e[r]&&t.db.deleteObjectStore(r)}}(e._cfg.dbschema,t)}))})),u().then((function(){!function(e,t){r(e).forEach((function(n){t.db.objectStoreNames.contains(n)||fe(t,n,e[n].primKey,e[n].indexes)}))}(T,n)}))}(e,i,t).catch(a)}))}function fe(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach((function(e){de(i,e)})),i}function de(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function he(e,t,n){if(q||Ce.letThrough){var r=J._createTransaction(e,t,T);try{r.create()}catch(e){return dt(e)}return r._promise(e,(function(e,t){return $e((function(){return Ce.trans=r,n(e,t,r)}))})).then((function(e){return r._completion.then((function(){return e}))}))}if(!V){if(!b)return dt(new Q.DatabaseClosed);J.open().catch($)}return Z.then((function(){return he(e,t,n)}))}function me(e,t,n){var r=arguments.length;if(r<2)throw new Q.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var a=I(i);return[e,a,n]}function ye(e,t,n){this.name=e,this.schema=t,this._tx=n,this.hook=K[e]?K[e].hook:ht(null,{creating:[re,$],reading:[te,ee],updating:[ae,$],deleting:[ie,$]})}function ge(e,t,n){return(n?Tt:At)((function(n){e.push(n),t&&t()}))}function _e(e,t,n,r,i){return new Me((function(a,o){var u=n.length,s=u-1;if(0===u)return a();if(r){var c,l=Tt(o),f=kt(null);O((function(){for(var r=0;r<u;++r){c={onsuccess:null,onerror:null};var o=n[r];i.call(c,o[0],o[1],t);var d=e.delete(o[0]);d._hookCtx=c,d.onerror=l,d.onsuccess=r===s?kt(a):f}}),(function(e){throw c.onerror&&c.onerror(e),e}))}else for(var d=0;d<u;++d){var h=e.delete(n[d]);h.onerror=At(o),d===s&&(h.onsuccess=We((function(){return a()})))}}))}function be(e,t,n,r){var i=this;this.db=J,this.mode=e,this.storeNames=t,this.idbtrans=null,this.on=ht(this,"complete","error","abort"),this.parent=r||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Me((function(e,t){i._resolve=e,i._reject=t})),this._completion.then((function(){i.active=!1,i.on.complete.fire()}),(function(e){var t=i.active;return i.active=!1,i.on.error.fire(e),i.parent?i.parent._reject(e):t&&i.idbtrans&&i.idbtrans.abort(),dt(e)}))}function we(e,t,n){this._ctx={table:e,index:":id"===t?null:t,or:n}}function Ee(e,t){var n=null,r=null;if(t)try{n=t()}catch(e){r=e}var i=e._ctx,a=i.table;this._ctx={table:a,index:i.index,isPrimKey:!i.index||a.schema.primKey.keyPath&&i.index===a.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueMapper:a.hook.reading.fire}}function Oe(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Pe(e,t){return e._cfg.version-t._cfg.version}function Se(e,t,n){t.forEach((function(t){var r=n[t];e.forEach((function(e){t in e||(e===be.prototype||e instanceof be?d(e,t,{get:function(){return this.table(t)}}):e[t]=new ye(t,r))}))}))}function xe(e,t,n,r,i,a){var o=We(a?function(e,t,r){return n(a(e),t,r)}:n,i);e.onerror||(e.onerror=At(i)),e.onsuccess=E(t?function(){var n=e.result;if(n){var a=function(){n.continue()};t(n,(function(e){a=e}),r,i)&&o(n.value,n,(function(e){a=e})),a()}else r()}:function(){var t=e.result;if(t){var n=function(){t.continue()};o(t.value,t,(function(e){n=e})),n()}else r()},i)}function Ie(e,t){return C.cmp(e,t)}function ke(e,t){return Ie(e,t)>0?e:t}function Ae(e,t){return C.cmp(e,t)}function Te(e,t){return C.cmp(t,e)}function je(e,t){return e<t?-1:e===t?0:1}function Re(e,t){return e>t?-1:e===t?0:1}function De(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}function Ne(e,t){for(var n=t.db.objectStoreNames,r=0;r<n.length;++r){var i=n[r],o=t.objectStore(i);s="getAll"in o;for(var u=0;u<o.indexNames.length;++u){var c=o.indexNames[u],l=o.index(c).keyPath,f="string"==typeof l?l:"["+y(l).join("+")+"]";if(e[i]){var d=e[i].idxByName[f];d&&(d.name=c)}}}/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&a.WorkerGlobalScope&&a instanceof a.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(s=!1)}function Fe(e){J.on("blocked").fire(e),wt.filter((function(e){return e.name===J.name&&e!==J&&!e._vcFired})).map((function(t){return t.on("versionchange").fire(e)}))}this.version=function(e){if(Y||V)throw new Q.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=j.filter((function(t){return t._cfg.version===e}))[0];return t||(t=new ce(e),j.push(t),j.sort(Pe),oe=!1,t)},o(ce.prototype,{stores:function(e){this._cfg.storesSource=this._cfg.storesSource?o(this._cfg.storesSource,e):e;var t={};j.forEach((function(e){o(t,e._cfg.storesSource)}));var n=this._cfg.dbschema={};return this._parseStoresSpec(t,n),T=J._dbSchema=n,[K,J,be.prototype].forEach((function(e){for(var t in e)e[t]instanceof ye&&delete e[t]})),Se([K,J,be.prototype,this._cfg.tables],r(n),n),F=r(n),this},upgrade:function(e){return this._cfg.contentUpgrade=e,this},_parseStoresSpec:function(e,t){r(e).forEach((function(n){if(null!==e[n]){var r={},a=function(e){var t=[];return e.split(",").forEach((function(e){var n=(e=e.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;t.push(new Dt(n,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),i(r),/\./.test(e)))})),t}(e[n]),o=a.shift();if(o.multi)throw new Q.Schema("Primary key cannot be multi-valued");o.keyPath&&S(r,o.keyPath,o.auto?0:o.keyPath),a.forEach((function(e){if(e.auto)throw new Q.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new Q.Schema("Index must have a name and cannot be an empty string");S(r,e.keyPath,e.compound?e.keyPath.map((function(){return""})):"")})),t[n]=new Nt(n,o,a,r)}}))}}),this._allTables=K,this._createTransaction=function(e,t,n,r){return new be(e,t,n,r)},this._whenReady=function(e){return q||Ce.letThrough?e():new Me((function(e,t){if(!V){if(!b)return void t(new Q.DatabaseClosed);J.open().catch($)}Z.then(e,t)})).then(e)},this.verno=0,this.open=function(){if(V||Y)return Z.then((function(){return B?dt(B):J}));N&&(ne._stackHolder=L()),V=!0,B=null,q=!1;var t=n,i=null;return Me.race([ne,new Me((function(t,n){if(!C)throw new Q.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using old Safari versions, make sure to include indexedDB polyfill.");var a=oe?C.open(e):C.open(e,Math.round(10*J.verno));if(!a)throw new Q.MissingAPI("IndexedDB API not available");a.onerror=At(n),a.onblocked=We(Fe),a.onupgradeneeded=We((function(t){if(i=a.transaction,oe&&!J._allowEmptyDB){a.onerror=jt,i.abort(),a.result.close();var r=C.deleteDatabase(e);r.onsuccess=r.onerror=We((function(){n(new Q.NoSuchDatabase("Database "+e+" doesnt exist"))}))}else{i.onerror=At(n),le((t.oldVersion>Math.pow(2,62)?0:t.oldVersion)/10,i,n)}}),n),a.onsuccess=We((function(){if(i=null,Y=a.result,wt.push(J),oe)!function(){if(J.verno=Y.version/10,J._dbSchema=T={},0===(F=y(Y.objectStoreNames,0)).length)return;var e=Y.transaction(Ft(F),"readonly");F.forEach((function(t){for(var n=e.objectStore(t),r=n.keyPath,i=r&&"string"==typeof r&&-1!==r.indexOf("."),a=new Dt(r,r||"",!1,!1,!!n.autoIncrement,r&&"string"!=typeof r,i),o=[],u=0;u<n.indexNames.length;++u){var s=n.index(n.indexNames[u]);i=(r=s.keyPath)&&"string"==typeof r&&-1!==r.indexOf(".");var c=new Dt(s.name,r,!!s.unique,!!s.multiEntry,!1,r&&"string"!=typeof r,i);o.push(c)}T[t]=new Nt(t,a,o,{})})),Se([K],r(T),T)}();else if(Y.objectStoreNames.length>0)try{Ne(T,Y.transaction(Ft(Y.objectStoreNames),G))}catch(e){}Y.onversionchange=We((function(e){J._vcFired=!0,J.on("versionchange").fire(e)})),se||"__dbnames"===e||pt.dbnames.put({name:e}).catch($),t()}),n)}))]).then((function(){return z=[],Me.resolve(xt.vip(J.on.ready.fire)).then((function e(){if(z.length>0){var t=z.reduce(ue,$);return z=[],Me.resolve(xt.vip(t)).then(e)}}))})).finally((function(){z=null})).then((function(){return V=!1,J})).catch((function(e){try{i&&i.abort()}catch(e){}return V=!1,J.close(),dt(B=e)})).finally((function(){q=!0,t()}))},this.close=function(){var e=wt.indexOf(J);if(e>=0&&wt.splice(e,1),Y){try{Y.close()}catch(e){}Y=null}b=!1,B=new Q.DatabaseClosed,V&&u(B),Z=new Me((function(e){n=e})),ne=new Me((function(e,t){u=t}))},this.delete=function(){var t=arguments.length>0;return new Me((function(n,r){if(t)throw new Q.InvalidArgument("Arguments not allowed in db.delete()");function i(){J.close();var t=C.deleteDatabase(e);t.onsuccess=We((function(){se||pt.dbnames.delete(e).catch($),n()})),t.onerror=At(r),t.onblocked=Fe}V?Z.then(i):i()}))},this.backendDB=function(){return Y},this.isOpen=function(){return null!==Y},this.hasBeenClosed=function(){return B&&B instanceof Q.DatabaseClosed},this.hasFailed=function(){return null!==B},this.dynamicallyOpened=function(){return oe},this.name=e,l(this,{tables:{get:function(){return r(K).map((function(e){return K[e]}))}}}),this.on=ht(this,"populate","blocked","versionchange",{ready:[ue,$]}),this.on.ready.subscribe=g(this.on.ready.subscribe,(function(e){return function(t,n){xt.vip((function(){q?(B||Me.resolve().then(t),n&&e(t)):z?(z.push(t),n&&e(t)):(e(t),n||e((function e(){J.on.ready.unsubscribe(t),J.on.ready.unsubscribe(e)})))}))}})),this.transaction=function(){var e=me.apply(this,arguments);return this._transaction.apply(this,e)},this._transaction=function(e,t,n){var r=Ce.trans;r&&r.db===J&&-1===e.indexOf("!")||(r=null);var i=-1!==e.indexOf("?");e=e.replace("!","").replace("?","");try{var a=t.map((function(e){var t=e instanceof ye?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t}));if("r"==e||e==G)e=G;else{if("rw"!=e&&e!=X)throw new Q.InvalidArgument("Invalid transaction mode: "+e);e=X}if(r){if(r.mode===G&&e===X){if(!i)throw new Q.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&a.forEach((function(e){if(r&&-1===r.storeNames.indexOf(e)){if(!i)throw new Q.SubTransaction("Table "+e+" not included in parent transaction.");r=null}})),i&&r&&!r.active&&(r=null)}}catch(e){return r?r._promise(null,(function(t,n){n(e)})):dt(e)}return r?r._promise(e,o,"lock"):Ce.trans?ut(Ce.transless,(function(){return J._whenReady(o)})):J._whenReady(o);function o(){return Me.resolve().then((function(){var t,i=Ce.transless||Ce,o=J._createTransaction(e,a,T,r),u={trans:o,transless:i};r?o.idbtrans=r.idbtrans:o.create(),n.constructor===ve&&et();var s=Me.follow((function(){if(t=n.call(o,o))if(t.constructor===pe){var e=tt.bind(null,null);t.then(e,e)}else"function"==typeof t.next&&"function"==typeof t.throw&&(t=Rt(t))}),u);return(t&&"function"==typeof t.then?Me.resolve(t).then((function(e){return o.active?e:dt(new Q.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))})):s.then((function(){return t}))).then((function(e){return r&&o._resolve(),o._completion.then((function(){return e}))})).catch((function(e){return o._reject(e),dt(e)}))}))}},this.table=function(e){if(!c(K,e))throw new Q.InvalidTable("Table "+e+" does not exist");return K[e]},l(ye.prototype,{_trans:function(e,t,n){var r=this._tx||Ce.trans;return r&&r.db===J?r===Ce.trans?r._promise(e,t,n):$e((function(){return r._promise(e,t,n)}),{trans:r,transless:Ce.transless||Ce}):he(e,[this.name],t)},_idbstore:function(e,t,n){var r=this.name;return this._trans(e,(function(e,n,i){if(-1===i.storeNames.indexOf(r))throw new Q.NotFound("Table"+r+" not part of transaction");return t(e,n,i.idbtrans.objectStore(r),i)}),n)},get:function(e,t){if(e&&e.constructor===Object)return this.where(e).first(t);var n=this;return this._idbstore(G,(function(t,r,i){var a=i.get(e);a.onerror=At(r),a.onsuccess=We((function(){t(n.hook.reading.fire(a.result))}),r)})).then(t)},where:function(e){if("string"==typeof e)return new we(this,e);if(i(e))return new we(this,"["+e.join("+")+"]");var t=r(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter((function(e){return e.compound&&t.every((function(t){return e.keyPath.indexOf(t)>=0}))&&e.keyPath.every((function(e){return t.indexOf(e)>=0}))}))[0];if(n&&yt!==mt)return this.where(n.name).equals(n.keyPath.map((function(t){return e[t]})));n||console.warn("The query "+JSON.stringify(e)+" on "+this.name+" would benefit of a compound index ["+t.join("+")+"]");var a=this.schema.idxByName,o=t.reduce((function(t,n){return[t[0]||a[n],t[0]||!a[n]?De(t[1],(function(t){return""+P(t,n)==""+e[n]})):t[1]]}),[null,null]),u=o[0];return u?this.where(u.name).equals(e[u.keyPath]).filter(o[1]):n?this.filter(o[1]):this.where(t).equals("")},count:function(e){return this.toCollection().count(e)},offset:function(e){return this.toCollection().offset(e)},limit:function(e){return this.toCollection().limit(e)},reverse:function(){return this.toCollection().reverse()},filter:function(e){return this.toCollection().and(e)},each:function(e){return this.toCollection().each(e)},toArray:function(e){return this.toCollection().toArray(e)},orderBy:function(e){return new Ee(new we(this,i(e)?"["+e.join("+")+"]":e))},toCollection:function(){return new Ee(new we(this))},mapToClass:function(e,t){this.schema.mappedClass=e;var n=Object.create(e.prototype);t&&It(n,t),this.schema.instanceTemplate=n;var r=function(t){if(!t)return t;var n=Object.create(e.prototype);for(var r in t)if(c(t,r))try{n[r]=t[r]}catch(e){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),e},defineClass:function(e){return this.mapToClass(xt.defineClass(e),e)},bulkDelete:function(e){return this.hook.deleting.fire===$?this._idbstore(X,(function(t,n,r,i){t(_e(r,i,e,!1,$))})):this.where(":id").anyOf(e).delete().then((function(){}))},bulkPut:function(e,t){var n=this;return this._idbstore(X,(function(r,i,a){if(!a.keyPath&&!n.schema.primKey.auto&&!t)throw new Q.InvalidArgument("bulkPut() with non-inbound keys requires keys array in second argument");if(a.keyPath&&t)throw new Q.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(t&&t.length!==e.length)throw new Q.InvalidArgument("Arguments objects and keys must have the same length");if(0===e.length)return r();var o,u,s=function(e){0===c.length?r(e):i(new H(n.name+".bulkPut(): "+c.length+" of "+l+" operations failed",c))},c=[],l=e.length,f=n;if(n.hook.creating.fire===$&&n.hook.updating.fire===$){u=ge(c);for(var d=0,h=e.length;d<h;++d)(o=t?a.put(e[d],t[d]):a.put(e[d])).onerror=u;o.onerror=ge(c,s),o.onsuccess=Mt(s)}else{var p=t||a.keyPath&&e.map((function(e){return P(e,a.keyPath)})),v=p&&w(p,(function(t,n){return null!=t&&[t,e[n]]}));(p?f.where(":id").anyOf(p.filter((function(e){return null!=e}))).modify((function(){this.value=v[this.primKey],v[this.primKey]=null})).catch(W,(function(e){c=e.failures})).then((function(){for(var n=[],r=t&&[],i=p.length-1;i>=0;--i){var a=p[i];(null==a||v[a])&&(n.push(e[i]),t&&r.push(a),null!=a&&(v[a]=null))}return n.reverse(),t&&r.reverse(),f.bulkAdd(n,r)})).then((function(e){var t=p[p.length-1];return null!=t?t:e})):f.bulkAdd(e)).then(s).catch(H,(function(e){c=c.concat(e.failures),s()})).catch(i)}}),"locked")},bulkAdd:function(e,t){var n=this,r=this.hook.creating.fire;return this._idbstore(X,(function(i,a,o,u){if(!o.keyPath&&!n.schema.primKey.auto&&!t)throw new Q.InvalidArgument("bulkAdd() with non-inbound keys requires keys array in second argument");if(o.keyPath&&t)throw new Q.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(t&&t.length!==e.length)throw new Q.InvalidArgument("Arguments objects and keys must have the same length");if(0===e.length)return i();function s(e){0===d.length?i(e):a(new H(n.name+".bulkAdd(): "+d.length+" of "+h+" operations failed",d))}var c,l,f,d=[],h=e.length;if(r!==$){var p,v=o.keyPath;l=ge(d,null,!0),f=kt(null),O((function(){for(var n=0,i=e.length;n<i;++n){p={onerror:null,onsuccess:null};var a=t&&t[n],s=e[n],d=t?a:v?P(s,v):void 0,h=r.call(p,d,s,u);null==d&&null!=h&&(v?S(s=A(s),v,h):a=h),(c=null!=a?o.add(s,a):o.add(s))._hookCtx=p,n<i-1&&(c.onerror=l,p.onsuccess&&(c.onsuccess=f))}}),(function(e){throw p.onerror&&p.onerror(e),e})),c.onerror=ge(d,s,!0),c.onsuccess=kt(s)}else{l=ge(d);for(var m=0,y=e.length;m<y;++m)(c=t?o.add(e[m],t[m]):o.add(e[m])).onerror=l;c.onerror=ge(d,s),c.onsuccess=Mt(s)}}))},add:function(e,t){var n=this.hook.creating.fire;return this._idbstore(X,(function(r,i,a,o){var u={onsuccess:null,onerror:null};if(n!==$){var s=null!=t?t:a.keyPath?P(e,a.keyPath):void 0,c=n.call(u,s,e,o);null==s&&null!=c&&(a.keyPath?S(e,a.keyPath,c):t=c)}try{var l=null!=t?a.add(e,t):a.add(e);l._hookCtx=u,l.onerror=Tt(i),l.onsuccess=kt((function(t){var n=a.keyPath;n&&S(e,n,t),r(t)}))}catch(e){throw u.onerror&&u.onerror(e),e}}))},put:function(e,t){var n=this,r=this.hook.creating.fire,i=this.hook.updating.fire;if(r!==$||i!==$){var a=this.schema.primKey.keyPath,o=void 0!==t?t:a&&P(e,a);return null==o?this.add(e):(e=A(e),this._trans(X,(function(){return n.where(":id").equals(o).modify((function(){this.value=e})).then((function(r){return 0===r?n.add(e,t):o}))}),"locked"))}return this._idbstore(X,(function(n,r,i){var a=void 0!==t?i.put(e,t):i.put(e);a.onerror=At(r),a.onsuccess=We((function(t){var r=i.keyPath;r&&S(e,r,t.target.result),n(a.result)}))}))},delete:function(e){return this.hook.deleting.subscribers.length?this.where(":id").equals(e).delete():this._idbstore(X,(function(t,n,r){var i=r.delete(e);i.onerror=At(n),i.onsuccess=We((function(){t(i.result)}))}))},clear:function(){return this.hook.deleting.subscribers.length?this.toCollection().delete():this._idbstore(X,(function(e,t,n){var r=n.clear();r.onerror=At(t),r.onsuccess=We((function(){e(r.result)}))}))},update:function(e,t){if("object"!=typeof t||i(t))throw new Q.InvalidArgument("Modifications must be an object.");if("object"!=typeof e||i(e))return this.where(":id").equals(e).modify(t);r(t).forEach((function(n){S(e,n,t[n])}));var n=P(e,this.schema.primKey.keyPath);return void 0===n?dt(new Q.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(n).modify(t)}}),l(be.prototype,{_lock:function(){return _(!Ce.global),++this._reculock,1!==this._reculock||Ce.global||(Ce.lockOwnerFor=this),this},_unlock:function(){if(_(!Ce.global),0==--this._reculock)for(Ce.global||(Ce.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{ut(e[1],e[0])}catch(e){}}return this},_locked:function(){return this._reculock&&Ce.lockOwnerFor!==this},create:function(e){var t=this;if(!this.mode)return this;if(_(!this.idbtrans),!e&&!Y)switch(B&&B.name){case"DatabaseClosedError":throw new Q.DatabaseClosed(B);case"MissingAPIError":throw new Q.MissingAPI(B.message,B);default:throw new Q.OpenFailed(B)}if(!this.active)throw new Q.TransactionInactive;return _(null===this._completion._state),(e=this.idbtrans=e||Y.transaction(Ft(this.storeNames),this.mode)).onerror=We((function(n){jt(n),t._reject(e.error)})),e.onabort=We((function(n){jt(n),t.active&&t._reject(new Q.Abort(e.error)),t.active=!1,t.on("abort").fire(n)})),e.oncomplete=We((function(){t.active=!1,t._resolve()})),this},_promise:function(e,t,n){var r=this;if(e===X&&this.mode!==X)return dt(new Q.ReadOnly("Transaction is readonly"));if(!this.active)return dt(new Q.TransactionInactive);if(this._locked())return new Me((function(i,a){r._blockedFuncs.push([function(){r._promise(e,t,n).then(i,a)},Ce])}));if(n)return $e((function(){var e=new Me((function(e,n){r._lock();var i=t(e,n,r);i&&i.then&&i.then(e,n)}));return e.finally((function(){return r._unlock()})),e._lib=!0,e}));var i=new Me((function(e,n){var i=t(e,n,r);i&&i.then&&i.then(e,n)}));return i._lib=!0,i},_root:function(){return this.parent?this.parent._root():this},waitFor:function(e){var t=this._root();if(e=Me.resolve(e),t._waitingFor)t._waitingFor=t._waitingFor.then((function(){return e}));else{t._waitingFor=e,t._waitingQueue=[];var n=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(n.get(-1/0).onsuccess=e)}()}var r=t._waitingFor;return new Me((function(n,i){e.then((function(e){return t._waitingQueue.push(We(n.bind(null,e)))}),(function(e){return t._waitingQueue.push(We(i.bind(null,e)))})).finally((function(){t._waitingFor===r&&(t._waitingFor=null)}))}))},abort:function(){this.active&&this._reject(new Q.Abort),this.active=!1},tables:{get:(f="Transaction.tables",h=function(){return K},function(){return console.warn(f+" is deprecated. See https://github.com/dfahlander/Dexie.js/wiki/Deprecations. "+U(L(),1)),h.apply(this,arguments)})},table:function(e){return new ye(e,J.table(e).schema,this)}}),l(we.prototype,(function(){function e(e,t,n){var r=e instanceof we?new Ee(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function t(e){return new Ee(e,(function(){return k.only("")})).limit(0)}function n(e,t,n,r,i,a){for(var o=Math.min(e.length,r.length),u=-1,s=0;s<o;++s){var c=t[s];if(c!==r[s])return i(e[s],n[s])<0?e.substr(0,s)+n[s]+n.substr(s+1):i(e[s],r[s])<0?e.substr(0,s)+r[s]+n.substr(s+1):u>=0?e.substr(0,u)+t[u]+n.substr(u+1):null;i(e[s],c)<0&&(u=s)}return o<r.length&&"next"===a?e+n.substr(e.length):o<e.length&&"prev"===a?e.substr(0,n.length):u<0?null:e.substr(0,u)+r[u]+n.substr(u+1)}function r(t,r,i,a){var o,u,s,c,l,f,d,h=i.length;if(!i.every((function(e){return"string"==typeof e})))return e(t,bt);function p(e){o=function(e){return"next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}(e),u=function(e){return"next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}(e),s="next"===e?je:Re;var t=i.map((function(e){return{lower:u(e),upper:o(e)}})).sort((function(e,t){return s(e.lower,t.lower)}));c=t.map((function(e){return e.upper})),l=t.map((function(e){return e.lower})),f=e,d="next"===e?"":a}p("next");var v=new Ee(t,(function(){return k.bound(c[0],l[h-1]+a)}));v._ondirectionchange=function(e){p(e)};var m=0;return v._addAlgorithm((function(e,t,i){var a=e.key;if("string"!=typeof a)return!1;var o=u(a);if(r(o,l,m))return!0;for(var p=null,v=m;v<h;++v){var y=n(a,o,c[v],l[v],s,f);null===y&&null===p?m=v+1:(null===p||s(p,y)>0)&&(p=y)}return t(null!==p?function(){e.continue(p+d)}:i),!1})),v}return{between:function(n,r,i,a){i=!1!==i,a=!0===a;try{return Ie(n,r)>0||0===Ie(n,r)&&(i||a)&&(!i||!a)?t(this):new Ee(this,(function(){return k.bound(n,r,!i,!a)}))}catch(t){return e(this,_t)}},equals:function(e){return new Ee(this,(function(){return k.only(e)}))},above:function(e){return new Ee(this,(function(){return k.lowerBound(e,!0)}))},aboveOrEqual:function(e){return new Ee(this,(function(){return k.lowerBound(e)}))},below:function(e){return new Ee(this,(function(){return k.upperBound(e,!0)}))},belowOrEqual:function(e){return new Ee(this,(function(){return k.upperBound(e)}))},startsWith:function(t){return"string"!=typeof t?e(this,bt):this.between(t,t+mt,!0,!0)},startsWithIgnoreCase:function(e){return""===e?this.startsWith(e):r(this,(function(e,t){return 0===e.indexOf(t[0])}),[e],mt)},equalsIgnoreCase:function(e){return r(this,(function(e,t){return e===t[0]}),[e],"")},anyOfIgnoreCase:function(){var e=D.apply(R,arguments);return 0===e.length?t(this):r(this,(function(e,t){return-1!==t.indexOf(e)}),e,"")},startsWithAnyOfIgnoreCase:function(){var e=D.apply(R,arguments);return 0===e.length?t(this):r(this,(function(e,t){return t.some((function(t){return 0===e.indexOf(t)}))}),e,mt)},anyOf:function(){var n=D.apply(R,arguments),r=Ae;try{n.sort(r)}catch(t){return e(this,_t)}if(0===n.length)return t(this);var i=new Ee(this,(function(){return k.bound(n[0],n[n.length-1])}));i._ondirectionchange=function(e){r="next"===e?Ae:Te,n.sort(r)};var a=0;return i._addAlgorithm((function(e,t,i){for(var o=e.key;r(o,n[a])>0;)if(++a===n.length)return t(i),!1;return 0===r(o,n[a])||(t((function(){e.continue(n[a])})),!1)})),i},notEqual:function(e){return this.inAnyRange([[gt,e],[e,yt]],{includeLowers:!1,includeUppers:!1})},noneOf:function(){var t=D.apply(R,arguments);if(0===t.length)return new Ee(this);try{t.sort(Ae)}catch(t){return e(this,_t)}var n=t.reduce((function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[gt,t]]}),null);return n.push([t[t.length-1],yt]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},inAnyRange:function(n,r){if(0===n.length)return t(this);if(!n.every((function(e){return void 0!==e[0]&&void 0!==e[1]&&Ae(e[0],e[1])<=0})))return e(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Q.InvalidArgument);var i=!r||!1!==r.includeLowers,a=r&&!0===r.includeUppers;var o,u=Ae;function s(e,t){return u(e[0],t[0])}try{(o=n.reduce((function(e,t){for(var n=0,r=e.length;n<r;++n){var i=e[n];if(Ie(t[0],i[1])<0&&Ie(t[1],i[0])>0){i[0]=Ie(a=i[0],o=t[0])<0?a:o,i[1]=ke(i[1],t[1]);break}}var a,o;return n===r&&e.push(t),e}),[])).sort(s)}catch(t){return e(this,_t)}var c=0,l=a?function(e){return Ae(e,o[c][1])>0}:function(e){return Ae(e,o[c][1])>=0},f=i?function(e){return Te(e,o[c][0])>0}:function(e){return Te(e,o[c][0])>=0};var d=l,h=new Ee(this,(function(){return k.bound(o[0][0],o[o.length-1][1],!i,!a)}));return h._ondirectionchange=function(e){"next"===e?(d=l,u=Ae):(d=f,u=Te),o.sort(s)},h._addAlgorithm((function(e,t,n){for(var r=e.key;d(r);)if(++c===o.length)return t(n),!1;return!!function(e){return!l(e)&&!f(e)}(r)||(0===Ie(r,o[c][1])||0===Ie(r,o[c][0])||t((function(){u===Ae?e.continue(o[c][0]):e.continue(o[c][1])})),!1)})),h},startsWithAnyOf:function(){var n=D.apply(R,arguments);return n.every((function(e){return"string"==typeof e}))?0===n.length?t(this):this.inAnyRange(n.map((function(e){return[e,e+mt]}))):e(this,"startsWithAnyOf() only works with strings")}}})),l(Ee.prototype,(function(){function e(e,t){e.filter=De(e.filter,t)}function t(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return De(r(),t())}:t,e.justLimit=n&&!r}function n(e,t){if(e.isPrimKey)return t;var n=e.table.schema.idxByName[e.index];if(!n)throw new Q.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return t.index(n.name)}function i(e,t){var r=n(e,t);return e.keysOnly&&"openKeyCursor"in r?r.openKeyCursor(e.range||null,e.dir+e.unique):r.openCursor(e.range||null,e.dir+e.unique)}function a(e,t,n,r,a){var o=e.replayFilter?De(e.filter,e.replayFilter()):e.filter;e.or?function(){var u={},s=0;function l(){2==++s&&n()}function f(e,n,i){if(!o||o(n,i,l,r)){var a=n.primaryKey,s=""+a;"[object ArrayBuffer]"===s&&(s=""+new Uint8Array(a)),c(u,s)||(u[s]=!0,t(e,n,i))}}e.or._iterate(f,l,r,a),xe(i(e,a),e.algorithm,f,l,r,!e.keysOnly&&e.valueMapper)}():xe(i(e,a),De(e.algorithm,o),t,n,r,!e.keysOnly&&e.valueMapper)}return{_read:function(e,t){var n=this._ctx;return n.error?n.table._trans(null,dt.bind(null,n.error)):n.table._idbstore(G,e).then(t)},_write:function(e){var t=this._ctx;return t.error?t.table._trans(null,dt.bind(null,t.error)):t.table._idbstore(X,e,"locked")},_addAlgorithm:function(e){var t=this._ctx;t.algorithm=De(t.algorithm,e)},_iterate:function(e,t,n,r){return a(this._ctx,e,t,n,r)},clone:function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&o(n,e),t._ctx=n,t},raw:function(){return this._ctx.valueMapper=null,this},each:function(e){var t=this._ctx;return this._read((function(n,r,i){a(t,e,n,r,i)}))},count:function(e){var t=this._ctx;if(Oe(t,!0))return this._read((function(e,r,i){var a=n(t,i),o=t.range?a.count(t.range):a.count();o.onerror=At(r),o.onsuccess=function(n){e(Math.min(n.target.result,t.limit))}}),e);var r=0;return this._read((function(e,n,i){a(t,(function(){return++r,!1}),(function(){e(r)}),n,i)}),e)},sortBy:function(e,t){var n=e.split(".").reverse(),r=n[0],i=n.length-1;function a(e,t){return t?a(e[n[t]],t-1):e[r]}var o="next"===this._ctx.dir?1:-1;function u(e,t){var n=a(e,i),r=a(t,i);return n<r?-o:n>r?o:0}return this.toArray((function(e){return e.sort(u)})).then(t)},toArray:function(e){var t=this._ctx;return this._read((function(e,r,i){if(s&&"next"===t.dir&&Oe(t,!0)&&t.limit>0){var o=t.table.hook.reading.fire,u=n(t,i),c=t.limit<1/0?u.getAll(t.range,t.limit):u.getAll(t.range);c.onerror=At(r),c.onsuccess=Mt(o===ee?e:function(t){try{e(t.map(o))}catch(e){r(e)}})}else{var l=[];a(t,(function(e){l.push(e)}),(function(){e(l)}),r,i)}}),e)},offset:function(e){var n=this._ctx;return e<=0||(n.offset+=e,Oe(n)?t(n,(function(){var t=e;return function(e,n){return 0===t||(1===t?(--t,!1):(n((function(){e.advance(t),t=0})),!1))}})):t(n,(function(){var t=e;return function(){return--t<0}}))),this},limit:function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),t(this._ctx,(function(){var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}}),!0),this},until:function(t,n){return e(this._ctx,(function(e,r,i){return!t(e.value)||(r(i),n)})),this},first:function(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)},last:function(e){return this.reverse().first(e)},filter:function(t){return e(this._ctx,(function(e){return t(e.value)})),function(e,t){e.isMatch=De(e.isMatch,t)}(this._ctx,t),this},and:function(e){return this.filter(e)},or:function(e){return new we(this._ctx.table,e,this)},reverse:function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},desc:function(){return this.reverse()},eachKey:function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.key,n)}))},eachUniqueKey:function(e){return this._ctx.unique="unique",this.eachKey(e)},eachPrimaryKey:function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.primaryKey,n)}))},keys:function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.key)})).then((function(){return n})).then(e)},primaryKeys:function(e){var t=this._ctx;if(s&&"next"===t.dir&&Oe(t,!0)&&t.limit>0)return this._read((function(e,r,i){var a=n(t,i),o=t.limit<1/0?a.getAllKeys(t.range,t.limit):a.getAllKeys(t.range);o.onerror=At(r),o.onsuccess=Mt(e)})).then(e);t.keysOnly=!t.isMatch;var r=[];return this.each((function(e,t){r.push(t.primaryKey)})).then((function(){return r})).then(e)},uniqueKeys:function(e){return this._ctx.unique="unique",this.keys(e)},firstKey:function(e){return this.limit(1).keys((function(e){return e[0]})).then(e)},lastKey:function(e){return this.reverse().firstKey(e)},distinct:function(){var t=this._ctx,n=t.index&&t.table.schema.idxByName[t.index];if(!n||!n.multi)return this;var r={};return e(this._ctx,(function(e){var t=e.primaryKey.toString(),n=c(r,t);return r[t]=!0,!n})),this},modify:function(e){var t=this,n=this._ctx.table.hook,i=n.updating.fire,a=n.deleting.fire;return this._write((function(n,u,s,l){var f;if("function"==typeof e)f=i===$&&a===$?e:function(t){var n=A(t);if(!1===e.call(this,t,this))return!1;if(c(this,"value")){var o=M(n,this.value),u=i.call(this,o,this.primKey,n,l);u&&(t=this.value,r(u).forEach((function(e){S(t,e,u[e])})))}else a.call(this,this.primKey,t,l)};else if(i===$){var d=r(e),h=d.length;f=function(t){for(var n=!1,r=0;r<h;++r){var i=d[r],a=e[i];P(t,i)!==a&&(S(t,i,a),n=!0)}return n}}else{var p=e;e=x(p),f=function(t){var n=!1,a=i.call(this,e,this.primKey,A(t),l);return a&&o(e,a),r(e).forEach((function(r){var i=e[r];P(t,r)!==i&&(S(t,r,i),n=!0)})),a&&(e=x(p)),n}}var v=0,m=0,y=!1,g=[],_=[],b=null;function w(e){return e&&(g.push(e),_.push(b)),u(new W("Error modifying one or more objects",g,m,_))}function E(){y&&m+g.length===v&&(g.length>0?w():n(m))}t.clone().raw()._iterate((function(e,t){b=t.primaryKey;var n={primKey:t.primaryKey,value:e,onsuccess:null,onerror:null};function r(e){return g.push(e),_.push(n.primKey),E(),!0}if(!1!==f.call(n,e,n)){var i=!c(n,"value");++v,O((function(){var e=i?t.delete():t.update(n.value);e._hookCtx=n,e.onerror=Tt(r),e.onsuccess=kt((function(){++m,E()}))}),r)}else n.onsuccess&&n.onsuccess(n.value)}),(function(){y=!0,E()}),w,s)}))},delete:function(){var e=this,t=this._ctx,n=t.range,r=t.table.hook.deleting.fire,i=r!==$;if(!i&&Oe(t)&&(t.isPrimKey&&!Pt||!n))return this._write((function(e,t,r){var i=At(t),a=n?r.count(n):r.count();a.onerror=i,a.onsuccess=function(){var o=a.result;O((function(){var t=n?r.delete(n):r.clear();t.onerror=i,t.onsuccess=function(){return e(o)}}),(function(e){return t(e)}))}}));var a=i?2e3:1e4;return this._write((function(n,o,u,s){var c=0,l=e.clone({keysOnly:!t.isMatch&&!i}).distinct().limit(a).raw(),f=[],d=function(){return l.each(i?function(e,t){f.push([t.primaryKey,t.value])}:function(e,t){f.push(t.primaryKey)}).then((function(){return i?f.sort((function(e,t){return Ae(e[0],t[0])})):f.sort(Ae),_e(u,s,f,i,r)})).then((function(){var e=f.length;return c+=e,f=[],e<a?c:d()}))};n(d())}))}}})),o(this,{Collection:Ee,Table:ye,Transaction:be,Version:ce,WhereClause:we}),J.on("versionchange",(function(e){e.newVersion>0?console.warn("Another connection wants to upgrade database '"+J.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+J.name+"'. Closing db now to resume the delete request."),J.close()})),J.on("blocked",(function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('"+J.name+"') was blocked"):console.warn("Upgrade '"+J.name+"' blocked by other connection holding version "+e.oldVersion/10)})),m.forEach((function(e){e(J)}))}function Ct(e){if("function"==typeof e)return new e;if(i(e))return[Ct(e[0])];if(e&&"object"==typeof e){var t={};return It(t,e),t}return e}function It(e,t){return r(t).forEach((function(n){var r=Ct(t[n]);e[n]=r})),e}function kt(e){return We((function(t){var n=t.target,r=n._hookCtx,i=r.value||n.result,a=r&&r.onsuccess;a&&a(i),e&&e(i)}),e)}function At(e){return We((function(t){return jt(t),e(t.target.error),!1}))}function Mt(e){return We((function(t){e(t.target.result)}))}function Tt(e){return We((function(t){var n=t.target,r=n.error,i=n._hookCtx,a=i&&i.onerror;return a&&a(r),jt(t),e(r),!1}))}function jt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}function Rt(e){var t=function(t){return e.next(t)},n=a(t),r=a((function(t){return e.throw(t)}));function a(e){return function(t){var a=e(t),o=a.value;return a.done?o:o&&"function"==typeof o.then?o.then(n,r):i(o)?Me.all(o).then(n,r):n(o)}}return a(t)()}function Dt(e,t,n,r,i,a,o){this.name=e,this.keyPath=t,this.unique=n,this.multi=r,this.auto=i,this.compound=a,this.dotted=o;var u="string"==typeof t?t:t&&"["+[].join.call(t,"+")+"]";this.src=(n?"&":"")+(r?"*":"")+(i?"++":"")+u}function Nt(e,t,n,r){this.name=e,this.primKey=t||new Dt,this.indexes=n||[new Dt],this.instanceTemplate=r,this.mappedClass=null,this.idxByName=w(n,(function(e){return[e.name,e]}))}function Ft(e){return 1===e.length?e[0]:e}function Kt(e){var t=e&&(e.getDatabaseNames||e.webkitGetDatabaseNames);return t&&t.bind(e)}F(N,St),l(xt,Z),l(xt,{delete:function(e){var t=new xt(e),n=t.delete();return n.onblocked=function(e){return t.on("blocked",e),this},n},exists:function(e){return new xt(e).open().then((function(e){return e.close(),!0})).catch(xt.NoSuchDatabaseError,(function(){return!1}))},getDatabaseNames:function(e){var t=Kt(xt.dependencies.indexedDB);return t?new Me((function(e,n){var r=t();r.onsuccess=function(t){e(y(t.target.result,0))},r.onerror=At(n)})).then(e):pt.dbnames.toCollection().primaryKeys(e)},defineClass:function(){return function(e){e&&o(this,e)}},applyStructure:It,ignoreTransaction:function(e){return Ce.trans?ut(Ce.transless,e):e()},vip:function(e){return $e((function(){return Ce.letThrough=!0,e()}))},async:function(e){return function(){try{var t=Rt(e.apply(this,arguments));return t&&"function"==typeof t.then?t:Me.resolve(t)}catch(e){return dt(e)}}},spawn:function(e,t,n){try{var r=Rt(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:Me.resolve(r)}catch(e){return dt(e)}},currentTransaction:{get:function(){return Ce.trans||null}},waitFor:function(e,t){var n=Me.resolve("function"==typeof e?xt.ignoreTransaction(e):e).timeout(t||6e4);return Ce.trans?Ce.trans.waitFor(n):n},Promise:Me,debug:{get:function(){return N},set:function(e){F(e,"dexie"===e?function(){return!0}:St)}},derive:h,extend:o,props:l,override:g,Events:ht,getByKeyPath:P,setByKeyPath:S,delByKeyPath:function(e,t){"string"==typeof t?S(e,t,void 0):"length"in t&&[].map.call(t,(function(t){S(e,t,void 0)}))},shallowClone:x,deepClone:A,getObjectDiff:M,asap:b,maxKey:yt,minKey:gt,addons:[],connections:wt,MultiModifyError:Q.Modify,errnames:G,IndexSpec:Dt,TableSchema:Nt,dependencies:function(){try{return{indexedDB:a.indexedDB||a.mozIndexedDB||a.webkitIndexedDB||a.msIndexedDB,IDBKeyRange:a.IDBKeyRange||a.webkitIDBKeyRange}}catch(e){return{indexedDB:null,IDBKeyRange:null}}}(),semVer:vt,version:vt.split(".").map((function(e){return parseInt(e)})).reduce((function(e,t,n){return e+t/Math.pow(10,2*n)})),default:xt,Dexie:xt}),Me.rejectionMapper=function(e,t){if(!e||e instanceof q||e instanceof TypeError||e instanceof SyntaxError||!e.name||!J[e.name])return e;var n=new J[e.name](t||e.message,e);return"stack"in e&&d(n,"stack",{get:function(){return this.inner.stack}}),n},(pt=new xt("__dbnames")).version(1).stores({dbnames:"name"}),function(){var e="Dexie.DatabaseNames";try{void 0!==typeof localStorage&&void 0!==a.document&&(JSON.parse(localStorage.getItem(e)||"[]").forEach((function(e){return pt.dbnames.put({name:e}).catch($)})),localStorage.removeItem(e))}catch(e){}}(),t.default=xt},7677:e=>{"use strict";e.exports=function(e,t,n,r,i,a,o,u){if(!e){var s;if(void 0===t)s=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,r,i,a,o,u],l=0;(s=new Error(t.replace(/%s/g,(function(){return c[l++]})))).name="Invariant Violation"}throw s.framesToPop=1,s}}},1449:(e,t)=>{"use strict";t.Z=g;var n,r="undefined"!=typeof Promise?Promise:null,i=0,a=[],o=[],u=[],s={sentinel:"CONTINUE_AS_IF_NO_HANDLER"},c={sentinel:"RETRY_ASYNCHRONOUSLY"},l={sentinel:"TO_STRING"},f={sentinel:"DID_ERROR"},d=null,h=[],p=16,v=64,m=128,y=512;function g(e,t){this._flags=0,this._value=void 0,this._onFulfilled=void 0,this._onRejected=void 0,this._context=void 0,this._resolveLevel=0,this._control=void 0,this.x=void 0,this._thenableParent=null,this._parent=void 0,this._child=void 0,this._children=void 0,this.control=void 0,t&&(this._context=t.this),"function"==typeof e&&(this._onFulfilled=e,this._flags|=4,this._flags|=256,H(e,this._context,(e=>K(this,0,!0,!1,e)),(e=>K(this,0,!1,!1,e))))}function _(e){if(void 0===e)return n;if(N(e))return e;var t=new g;return K(t,0,!0,!1,e),Q(t,y),t}function b(e){var t=new g;return t._value=e,Q(t,514),h.push(t),t}function w(e){var t=arguments.length-1;if(0===t)return this.then(void 0,e);for(var n=new Array(t),r=0;r<t;r++)n[r]=U(arguments[r]);var i=B(n,arguments[t]),a=F(this,void 0,i);return a._onRejected&&Q(a,m),a}function E(e){return new g((function(t,n){var r=e.length;if(0!==r)for(var i=new Array(e.length),a=0;a<e.length;a++)i[a]=F(e[a],o,n);else t([]);function o(e){if(0==--r){for(var n=[],a=0;a<i.length;a++){var o=i[a];n.push(o&&3&o._flags?o._value:e)}t(n)}return e}}))}function O(e,t){this.errors=e||[],this.message=t||"".concat(this.errors.length," errors")}function P(e){var t="";if(e._flags&m)t=(e._onFulfilled||e._onRejected).call(e._context,l);else if(e._control)t=".addRawControl(".concat(e._control.name,", ").concat(e._control.foo,")");else if(e._flags&p)t=".endWithControls(".concat(Object.keys(e.control),")");else if(e._flags&y)t=1&e._flags?"Promise.resolve(".concat(void 0===e._value?"":e._value,")"):"Promise.reject(".concat(void 0===e._value?"":e._value,")");else if(256&e._flags)switch(3&e._flags){case 2:case 0:case 1:t="new Promise(".concat(e._onFulfilled,")")}else e._onFulfilled&&e._onRejected?t=".then(".concat(e._onFulfilled,", ").concat(e._onRejected,")"):e._onFulfilled?t=".then(".concat(e._onFulfilled,")"):e._onRejected&&(t=".catch(".concat(e._onRejected,")"));return t}function S(e){this.message=e||"StackPromise timed out"}function x(e,t,n,r){this.name=e,this.foo=t,this.lightning=!!n,this.canRunMultipleTimes=!!r}function C(e,t){return function(){for(var n,r,i=e._parent;i&&!(3&i._flags)&&!(i._flags&p);i=i._parent)!i._control||i._control.name!==t||4&i._flags||(n=i);if(!n)return g.NO_ACTIVE_CONTROL;if(n._control.canRunMultipleTimes||Q(n,4),arguments.length>0){r=new Array(arguments.length);for(var a=0;a<arguments.length;a++)r[a]=arguments[a]}return n._control.foo.call(n._context,(e=>Y(n,n._resolveLevel,!0,!1,e)),(e=>Y(n,n._resolveLevel,!1,!1,e)),n._parent,r)}}function I(e){this.message=e,this.stack=new Error(e||this.name).stack}g.resolve=_,g.reject=b,g.prototype.then=function(e,t){"function"!=typeof e&&(e=void 0),"function"!=typeof t&&(t=void 0);var n=new g;n._onFulfilled=e,n._onRejected=t,n._context=this._context,this._flags&v&&Q(n,v);var r=3&this._flags;return 0===r?j(this,n):(Q(this,8),(1===r?e:t)?(n._parent=this,o.push(n),M()):(n._parent=this,Q(n,r),n._value=this._value,2===r&&h.push(n))),n},g.prototype.catch=w,g.prototype.catchType=w,g.prototype.catchTypes=w,g.prototype.catchTypes3=w,g.prototype.catchEqualTo=w,g.prototype.catchConditional=w,g.prototype.end=function(e){var t=this.then();if(Q(t,p),t.control={},t._context=void 0,e){var n=e.controls;if(n)for(var r=0;r<n.length;r++){var i=n[r];t.control[i]=C(t,i)}return t}},g.prototype.endWithControls=function(){var e=this.then();Q(e,p),e.control={},e._context=void 0;for(var t=0;t<arguments.length;t++){var n=arguments[t];e.control[n]=C(e,n)}return e},g.all=E,g.allSettled=function(e){return new g((function(t){var n=Array.from(e),r=n.length;if(0!==r)for(var i=new Array(n.length),a=s(!1),o=s(!0),u=0;u<n.length;u++)i[u]=F(n[u],a,o);else t([]);function s(e){return function(n){var a=e?{status:"rejected",reason:n}:{status:"fulfilled",value:n};if(0==--r){for(var o=[],u=0;u<i.length;u++){var s=i[u];o.push(s&&3&s._flags?s._value:a)}t(o)}return a}}}))},g.any=function(e){return new g((function(t,n){var r=e.length;0===r&&n(new O([],"StackPromise.any called with []"));var i=new Array(e.length);function a(e){if(0==--r){for(var t=[],a=0;a<i.length;a++){var o=i[a];t.push(o&&3&o._flags?o._value:e)}n(new O(t))}return e}for(var o=0;o<e.length;o++)i[o]=F(e[o],t,a)}))},g.props=function(e){var t=Object.keys(e),n=g.all(t.map((t=>e[t])));function r(e){for(var n={},r=0;r<e.length;r++)n[t[r]]=e[r];return n}switch(3&n._flags){case 2:return n;case 0:return Q(n.then(r),32);case 1:return n._value=r(n._value),n}},g.map=function(e,t){var n=!0;var r=E(e.map((function(e,r){return _(e).then(function(e){return function(r){return n&&t(r,e)}}(r))})));switch(3&r._flags){case 2:n=!1;break;case 0:Q(r=r.catch((function(){return n=!1,s})),32)}return r},g.reduce=function(e,t,n){return _(e).reduce(t,n)},g.prototype.reduce=function(e,t){return t=D(t),F(this,(function(n,r){if(0===n.length)return t;if(r)return c;for(var i=new Array(n.length),a=0;a<n.length;a++){var o=i[a]=D(n[a]);N(o)&&Q(o,8)}var u=this,s=0;return function n(){for(var r=i.length;;){var a=s,o=i[a];if(N(o))switch(3&o._flags){case 2:return o;case 0:return o.then(n);case 1:o=o._value}if(N(t))switch(3&t._flags){case 2:return t;case 0:return t.then(n);case 1:t=t._value}var c=e.call(u,t,o,a,r);if(++s===r)return c;if(N(c=D(c)))switch(3&c._flags){case 2:return c;case 0:return t=c,c.then(n);case 1:Q(c,8),t=c._value}else t=c}}()}))},g.each=function(e,t){return _(e).each(t)},g.prototype.each=function(e){var t=[];return this.reduce((function(n,r,i,a){return t.push(r),e.call(this,r,i,a)})).then((()=>t))},g.mapSeries=function(e,t){return _(e).mapSeries(t)},g.prototype.mapSeries=function(e){return this.reduce((function(t,n,r,i){var a=D(e.call(this,n,r,i));return N(a)?a.then((e=>(t.push(e),t))):(t.push(a),t)}),[])},g.race=function(e){var t=D(e);if(N(t)){var n=t.then((e=>g.race(e)));return n._context=void 0,n._flags&=-65,n}return new g((function(e,n){for(var r=0;r<t.length;r++){var i=D(t[r]);if(!N(i)||3&i._flags)for(e(i),r++;r<t.length;r++){var a=t[r];N(a)&&Q(a,8)}else i.then(e,n)}}))},O.prototype=Object.create(Error.prototype,{name:{value:"AggregateError"}}),g.AggregateError=O,g.onPossiblyUnhandledRejection=function(e,t){console.error("StackPromise did not catch ".concat(e),t,e)},g.prototype.toString=function(){for(var e,t=[],n=this,r=!1;n;n=n._parent){e=n,!r&&3&n._flags&&(r=!0,n._flags&y||(1&n._flags?t.push("[resolved value: ".concat(n._value,"]")):t.push("[rejected reason: ".concat(n._value,"]"))));var i=P(n);1024&n._flags&&(i="~".concat(i)),t.push(i)}return t.reverse(),768&e._flags||(t[0]="[Promise]".concat(t[0])),t.join("\n")},g.prototype.timeout=function(e,t){if(0!=(3&this._flags))return this.then();var n;function r(r){return r===l?".timeout(".concat(e,", ").concat(t,")"):(clearTimeout(n),s)}var i=this.then(r,r);return Q(i,160),n=setTimeout((function(e,t){3&e._flags||Y(e,0,!1,!1,t instanceof Error?t:new S(t))}),e,i,t),i},S.prototype=Object.create(Error.prototype,{name:{value:"TimeoutError"}}),g.TimeoutError=S,g.prototype.isFulfilled=function(){return!!(1&this._flags)},g.prototype.isRejected=function(){return!!(2&this._flags)},g.prototype.isPending=function(){return!(3&this._flags)},g.prototype.value=function(){if(1&this._flags)return this._value;throw new Error(2&this._flags?"value() called on StackPromise that was rejected":"value() called on StackPromise that is pending")},g.prototype.reason=function(){if(2&this._flags)return this._value;throw new Error(1&this._flags?"reason() called on StackPromise that was fulfilled, not rejected":"reason() called on StackPromise that is pending")},g.loop=function(e,t){return _(t).loop(e)},g.prototype.loop=function(e){var t=F(this.then((function(n){var r=this,i=0,a=e=>Y(t,0,!0,!1,e);return function n(o){return new g((function(t){t(e.call(r,a,o,i++))})).then((function(e){if(!(3&t._flags))return n(e)}))}(n)})),(function(t){return t===l?".loop(".concat(e,")"):s}));return Q(t,m),t},g.prototype.checkpoint=function(e){function t(t){return t===l?".checkpoint(".concat(e,")"):2&e._flags?e:s}e=_(e);var n=this.then(t,t);return Q(n,m),n},g.prototype.finally=function(e){function t(t){return t===l?".finally(".concat(e,")"):(e.call(this,t),s)}return Q(this.then(t,t),m)},g.prototype.get=function(e){var t=this.then((function(t){return t===l?".get('".concat(e,"')"):t[e]}));return Q(t,m),t},g.prototype.tap=function(e){return Q("function"!=typeof e?this.then(T):this.then((function(t){return t===l?".tap(".concat(e,")"):(e.call(this,t),s)})),m)},g.prototype.spread=function(e){var t=this.then((function(t){return t===l?".spread(".concat(e,")"):e.apply(this,t)}));return Q(t,m),t},g.prototype.throw=function(e){return this.then((()=>b(e)))},g.Control=x,g.NO_ACTIVE_CONTROL=new Error("No active control was found."),g.prototype.addControl=function(e){if(!(e instanceof x))throw new Error("addControl must be given Control, but got ".concat(e));var t=this.then(e.lightning?void 0:T);return t._control=e,t},g.prototype.addRawControl=function(e,t,n,r){return this.addControl(new x(e,t,n,r))},g.prototype.addResolveControl=function(e,t,n,r){return this.addControl(new x(e,(function(e,n,r,i){try{e(t.apply(this,i))}catch(e){n(e)}}),n,r))},g.prototype.addRejectControl=function(e,t,n,r){return this.addControl(new x(e,(function(e,n,r,i){try{n(t.apply(this,i))}catch(e){n(e)}}),n,r))},I.prototype=Object.create(Error.prototype,{name:{value:"CancellationError"}}),g.CancellationError=I;var k,A=new x("cancel",(function(e,t,n,r){t(new I(r&&r[0]))}),!1,!1);function M(){var e,t;0===i&&(o.length||h.length)&&(i=1,k||(t=0,k="undefined"==typeof MutationObserver||self&&self.navigator&&self.navigator.standalone?r?function(){r.resolve().then(W)}:"function"==typeof setImmediate?function(){setImmediate(W)}:function(){setTimeout(W,0)}:(e=document.createTextNode(""),new MutationObserver(W).observe(e,{characterData:!0}),function(){e.data=t=1-t})),k())}function T(e){return e===l?".tap()":s}function j(e,t){Q(e,8),t._parent=e,e._children?e._children.push(t):e._child?(e._children=[e._child,t],e._child=void 0):e._child=t}function R(e){if(e&&("object"==typeof e||"function"==typeof e)){var t;try{t=e.then}catch(e){return d=e,f}if("function"==typeof t)return t}}function D(e){if(!e||N(e))return e;var t=R(e);if(t===f)return b(d);if(t){var n=new g((function(n,r){t.call(e,n,r)}));return n._thenableParent=e,n}return e}function N(e){return e instanceof g}function F(e,t,n){var r,i,a,o,u=N(e=D(e)),l=!1;if(u){if(!(3&e._flags))return Q(e.then(t,n),32);Q(e,8),l=!!(e._flags&v),a=e._context,r=1&e._flags?t:n,i=e._value}else r=t,i=e;if(!r)return _(e).then();if((i=X(r,a,i,!0))===f)o=b(d);else{if(i===c)return _(e).then(t,n);if(i===s)return u?e.then():_(e);o=_(i)}return l&&(o=o.cancellable()),void 0!==a&&((o=o.then())._context=a),o}function K(e,t,n,r,i){if(t===e._resolveLevel){var a=++e._resolveLevel;if(Q(e,4),e._thenableParent=null,n)if(i===e)e._parent=void 0,V(e,!1,r,new TypeError("promise resolved to itself"));else if(N(i)){var o=3&i._flags;0===o?j(i,e):(e._parent=i,Q(e,1024),Q(i,8),V(e,1===o,r,i._value))}else{var u=R(i);u===f?(e._parent=void 0,V(e,!1,r,d)):u?(e._parent=void 0,e._thenableParent=i,H(u,i,(t=>K(e,a,!0,!1,t)),(t=>K(e,a,!1,!1,t)))):V(e,!0,r,i)}else V(e,!1,r,i)}}function Y(e,t,n,r,i){t===e._resolveLevel&&(L(e),K(e,t,n,r,i))}function L(e){if(e._parent){var t=e._parent;if(e._parent=void 0,t._child===e)t._child=void 0;else if(t._children){for(var n=t._children,r=0;r<n.length;r++)if(n[r]===e){n.splice(r,1);break}0===n.length&&(t._children=void 0)}}}function U(e){if(null==e)throw new Error("Invalid .catch guard ".concat(e));if("function"==typeof e)return e;if("object"==typeof e)throw new Error("Object guards in .catch are currently unsupported");return function(t){return t===e}}function B(e,t){return function(n,r){return n===l?".catch(..., ".concat(t,")"):e&&!function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r===Error||r.prototype instanceof Error){if(t instanceof r)return!0}else if(r(t))return!0}return!1}(e,n)?s:r?c:t.call(this,n)}}function V(e,t,n,r){if(Q(e,4|(t?1:2)),e._value=r,e._child)z(e._child,t,n,r),e._child=void 0;else if(e._children){var i=e._children;e._children=void 0;for(var a=0;a<i.length;a++)z(i[a],t,n,r)}else t||8&e._flags||h.push(e)}function z(e,t,n,r){e._resolveLevel++;var i=G(e,t);if(i&&32&e._flags){Q(e,4);var a=X(i,e._context,r,!0);if(a!==c)return void(a===f?(e._parent=void 0,V(e,!1,n,d)):a===s?V(e,t,n,r):(e._parent=void 0,K(e,e._resolveLevel,!0,n,a)));e._flags&=-5}i?((n?u:o).push(e),M()):V(e,t,n,r)}function q(e,t){for(;0!==e.length;)t.push(e.pop())}function W(){for(;0!==a.length||0!==o.length;){0===a.length&&q(o,a);var e=a.pop(),t=e._parent,n=!!(t&&1&t._flags),r=t&&t._value,l=G(e,n);if(Q(e,4),l){var p=void 0;do{p=X(l,e._context,r,!1)}while(p===c);p===f?(r=d,n=!1,e._parent=void 0):p!==s&&(r=p,n=!0,e._parent=void 0)}3&e._flags||(K(e,e._resolveLevel,n,!0,r),q(u,a))}for(i--;0!==h.length;){var v=h.pop();8&v._flags||g.onPossiblyUnhandledRejection(v._value,v)}}function H(e,t,n,r){try{e.call(t,n,r)}catch(e){r(e)}}function G(e,t){if(!(4&e._flags))return t?e._onFulfilled:e._onRejected}function X(e,t,n,r){try{return r?e.call(t,n,!0):e.call(t,n)}catch(e){return d=e,f}}function Q(e,t){return e._flags|=t,e}g.prototype.addCancelControl=function(){return Q(this.addControl(A),v)},g.sit=function(e,t){var n=new g;return n._control=new x(e,(function(e,n,r,i){e(t?t.apply(void 0,i):i&&i[0])})),n},g.prototype.cancellable=function(){return Q(this.then(),v)},g.prototype.uncancellable=function(){var e=this.then();return e._flags&=-65,e},g.prototype.cancel=function(e){for(var t,n=this;n&&!(3&n._flags);n=n._parent)n._flags&v&&(t=n);if(t)if(void 0===e&&(e=new I),G(t,!1)){var r=new g;L(t),j(r,t),Y(r,0,!1,!1,e)}else Y(t,t._resolveLevel,!1,!1,e)},K(n=new g,0,!0,!1,void 0)},3487:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConflictResolutionState=t.SyncModelType=t.SyncActionState=t.CollectionSyncState=t.CollectionState=t.CollectionName=t.Actions=t.LABEL_ASSOCIATION_SYNC_VERSION=t.DEFAULT_COLLECTION_VERSION=t.MAX_PATCH_SIZE=t.MIN_PATCH_SIZE=t.MAX_INLINE_MUTATIONS=t.MIN_INLINE_MUTATIONS=t.FINITE_FAILURE_EXPIRY_DURATION=t.BACKOFF_BASE=t.BACKOFF_MAX_TIMEOUT=t.BACKOFF_MIN_TIMEOUT=void 0;t.BACKOFF_MIN_TIMEOUT=1e3;t.BACKOFF_MAX_TIMEOUT=36e5;t.BACKOFF_BASE=2;t.FINITE_FAILURE_EXPIRY_DURATION=6048e5;t.MIN_INLINE_MUTATIONS=100;t.MAX_INLINE_MUTATIONS=2e3;t.MIN_PATCH_SIZE=10;t.MAX_PATCH_SIZE=100;t.DEFAULT_COLLECTION_VERSION=0;t.LABEL_ASSOCIATION_SYNC_VERSION=3;var r=n(8103)({Star:"star",Contact:"contact",Mute:"mute",Pin:"pin",SettingPushName:"setting_pushName",LabelEdit:"label_edit",LabelMessage:"label_message",LabelJid:"label_jid",QuickReply:"quick_reply",LocaleSetting:"setting_locale",Archive:"archive",MarkChatAsRead:"markChatAsRead",ClearChat:"clearChat",DeleteMessageForMe:"deleteMessageForMe",Sentinel:"sentinel"});t.Actions=r;var i=n(8103)({Generic:"generic",Regular:"regular",RegularLow:"regular_low",RegularHigh:"regular_high",CriticalBlock:"critical_block",CriticalUnblockLow:"critical_unblock_low"});t.CollectionName=i;var a=n(8103).Mirrored(["Success","SuccessHasMore","Conflict","ErrorRetry","ErrorFatal","Blocked"]);t.CollectionState=a;var o=n(8103).Mirrored(["UpToDate","Dirty","FailingFiniteRetry","Fatal","Blocked"]);t.CollectionSyncState=o;var u=n(8103).Mirrored(["Success","Malformed","Orphan","Unsupported","Skipped","Failed"]);t.SyncActionState=u;var s=n(8103).Mirrored(["Msg","Chat"]);t.SyncModelType=s;var c=n(8103).Mirrored(["ApplyRemoteAndDropLocal","SkipRemote","SkipRemoteAndDropLocal"]);t.ConflictResolutionState=c},7620:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7677)),a=r(n(1941));var o=new class{init(){return this._promise||(this._promise=new Promise((e=>{this._resolver=e})).timeout(5e3)),this._promise}isConnected(){return null!=this._port}getPort(){return this._port}waitForConnection(){return(0,a.default)(this._promise,"ConnectionManager Initialization Promise")}connectVia(e){if(this.isConnected())throw new Error("Connection already established");(0,i.default)(this._resolver,"ConnectionManager not initialized"),this._port=e,this._resolver()}};t.default=o},6936:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={isLogoutInProgress:!1}},4391:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7677)),a=n(1800),o=n(7110),u=r(n(1941)),s=n(4012);var c=new class{constructor(){this._pending=new Map,this._onResponseReceipt=e=>{var t=(0,s.unwrapResponsePayload)(e.data);if(null!=t){var{invocationId:n,result:r}=t;if(this._pending.has(n)){var{resolve:i}=(0,u.default)(this._pending.get(n),"this._pending.get(invocationId)");i(r),this._pending.delete(n)}}}}setConnectionManager(e){this._conn=e,e.waitForConnection().then((()=>{var t=(0,u.default)(e.getPort(),"Port obtained from ConnectionManager after connection");t.addEventListener("message",this._onResponseReceipt),t.start()}))}invoke(e,t){return(0,i.default)(this._conn,"Connection has not been inited"),this._conn.waitForConnection().then((()=>{(0,i.default)(this._conn,"Connection has not been inited");var n=(0,u.default)(this._conn.getPort(),"Port obtained from ConnectionManager after connection"),r=(0,o.genInvocationId)();return n.postMessage((0,a.buildInvocationPayload)({invocationId:r,method:e,args:t})),new Promise(((e,t)=>{this._pending.set(r,{resolve:e,reject:t})}))}))}};t.default=c},2929:(e,t,n)=>{"use strict";var r=n(3291);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(1800),a=r(n(9458)),o=n(4012);var u=new class{constructor(){this._onMessage=(e,t)=>{var n=t.data,r=(0,i.unwrapInvocationPayload)(n);if(null!=r){var{method:u,args:s,invocationId:c}=r;a.get()[u](...s).then((t=>{e.postMessage((0,o.buildResponsePayload)(c,t))}))}}}respondTo(e){e.addEventListener("message",(t=>this._onMessage(e,t))),e.start()}};t.default=u},7110:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.genInvocationId=function(){return n++},t.extractInvocationId=function(e){if(null!=e&&"number"==typeof e)return e};var n=1},9458:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.set=function(e){i=e},t.get=s,t.sendLogs=function(){throw new Error("Not yet implemented")},t.log=void 0;var i,a=r(n(6890)),o=r(n(1985)),u=r(n(1941));function s(){return(0,u.default)(i,"InvocationInterface was not inited")}var c=(0,o.default)(((e,t=!1,n,r,i)=>(o,...u)=>{var c,l=(0,a.default)(o,u,!t);return n&&(c={name:n.name,stack:n.stack}),s().logImpl(e,l,c,r,i),l}),((e,t,n,r,i)=>n||i?null:String(e)+String(Boolean(t))+String(Boolean(r))));t.log=c},3141:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.buildHandshakePayload=function(e){return{__command:a.HANDSHAKE_COMMAND,__port:e}},t.extractPortFromHandshakePayload=function(e){if(null!=e&&null!=e.__command&&e.__command===a.HANDSHAKE_COMMAND){if(null!=e.__port)return(0,i.default)(e.__port instanceof MessagePort,"Malformed connection payload"),e.__port}};var i=r(n(7677)),a=n(4624)},1800:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.buildInvocationPayload=function({invocationId:e,method:t,args:n}){return{__id:e,__command:o.INVOCATION_COMMAND,__method:t,__args:n}},t.unwrapInvocationPayload=function(e){if(null!=e&&e.__command===o.INVOCATION_COMMAND){(0,i.default)(e.__id,"Invocation ID missing");var t=(0,a.extractInvocationId)(e.__id);(0,i.default)(null!=t&&e.__method&&"string"==typeof e.__method&&e.__id&&e.__args&&Array.isArray(e.__args),"Malformed invocation message");var n=e,r=n.__method,u=n.__args;return{method:r,args:u,invocationId:t}}};var i=r(n(7677)),a=n(7110),o=n(4624)},4012:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.buildResponsePayload=function(e,t){return{__id:e,__command:o.RESPONSE_COMMAND,__result:t}},t.unwrapResponsePayload=function(e){if(null!=e&&e.__command===o.RESPONSE_COMMAND){(0,i.default)(null!=e.__id,"Invocation ID missing");var t=(0,a.extractInvocationId)(e.__id);return(0,i.default)(null!=t&&e.hasOwnProperty("__result"),"Malformed response message"),{result:e.__result,invocationId:t}}};var i=r(n(7677)),a=n(7110),o=n(4624)},4624:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RESPONSE_COMMAND=t.INVOCATION_COMMAND=t.HANDSHAKE_COMMAND=void 0;t.HANDSHAKE_COMMAND="@@handshake";t.INVOCATION_COMMAND="@@invoke";t.RESPONSE_COMMAND="@@response"},2186:(e,t,n)=>{"use strict";var r=n(3291),i=n(4859);t.Z=function(){a||((0,o.default)("undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope,"Connect can only be called in WebWorker scope"),self.addEventListener("message",v),a=Promise.resolve(u.default.init()),l.default.setConnectionManager(u.default),d.set(s.default));return(0,h.default)(a,"connection")};var a,o=i(n(7677)),u=i(n(7620)),s=i(n(1612)),c=n(3141),l=i(n(4391)),f=i(n(2929)),d=r(n(9458)),h=i(n(1941)),p=[];function v(e){var t=e.data;if(!u.default.isConnected()){var n=(0,c.extractPortFromHandshakePayload)(t);if(null!=n)return u.default.connectVia(n),e.stopImmediatePropagation(),f.default.respondTo(n),void(0,h.default)(a,"connection").then((()=>{(0,o.default)("undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope,"Connect can only be called in WebWorker scope"),self.removeEventListener("message",v),p.forEach((e=>{self.dispatchEvent(e)}))}))}p.push(e)}},1612:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(6936)),a=n(3012),o=r(n(4391)),u={whoAmI:()=>o.default.invoke("whoAmI",[]),logImpl:(e,t,n,r,i)=>o.default.invoke("logImpl",[e,t,n,r,i]),initFromStorage:()=>(0,a.init)(),setLogoutState:e=>(i.default.isLogoutInProgress=e,Promise.resolve())};t.default=u},2206:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(9976)),a=r(n(2954)),o=r(n(7715)),u=r(n(7677)),s=(n(522),r(n(1941))),c=n(1054);function l(){var e=(0,i.default)(["Operation "," failed with args: ",""]);return l=function(){return e},e}function f(){var e=(0,i.default)(["idb faild to do Operation: "," on Table: ",". Failed with error ",""]);return f=function(){return e},e}var d=n(1449).Z;function h(){return(h=(0,a.default)((function*(){throw new Error("feature is not yet implemented")}))).apply(this,arguments)}function p(){return(p=(0,a.default)((function*(){throw new Error("feature is not yet implemented")}))).apply(this,arguments)}class v{constructor(e,t,n,r,i,a){this.table=e,this.view=n,this.db=t,this.propFilter=r,this.tableEncryptedColumns=new Map(Object.keys(i).map((e=>[e,i[e]]))),this.shouldUseDbMsgEncKeyForEncryptedCol=a}asyncView(e){var t=this;return(0,a.default)((function*(){if(!t._hasEncryptedColumn())return t.view(e);var n=yield t._decryptColumns(e);return t.view(n)}))()}_decryptColumns(e){var t=this;return(0,a.default)((function*(){(0,u.default)("object"==typeof e,"Called `_decryptColumns` with primitive value");var n=Array.from(t.tableEncryptedColumns.entries()).map((([n,r])=>{var i=e[n];return(null==i?void 0:i._data)&&(null==i?void 0:i.iv)?function(){return p.apply(this,arguments)}(i,n,r,t.shouldUseDbMsgEncKeyForEncryptedCol).then((t=>{e[n]=t})):i}));return yield Promise.all(n),e}))()}_encryptColumns(e){var t=Array.from(this.tableEncryptedColumns.entries()).map((([t,n])=>{var r=e[t];return null==r?r:function(){return h.apply(this,arguments)}(r,t,n,this.shouldUseDbMsgEncKeyForEncryptedCol).then((n=>{e[t]=n}))}));return Promise.all(t).then((()=>e))}_addAndEncrypt(e){var t=this;return(0,a.default)((function*(){if(!t._hasEncryptedColumn())return t.table.add(e);var n=yield t._encryptSingleUpdate(e);return t.table.add(n)}))()}_putAndEncrypt(e){var t=this;return(0,a.default)((function*(){if(!t._hasEncryptedColumn())return t.table.put(e);var n=yield t._encryptColumns(e);return t.table.put(n)}))()}_bulkAddAndEncrypt(e){return this._hasEncryptedColumn()?this._encryptBulkUpdates(e).then((e=>this.table.bulkAdd(e))):this.table.bulkAdd(e)}_bulkPutAndEncrypt(e){return this._hasEncryptedColumn()?o.default.waitFor(this._encryptBulkUpdates(e)).then((e=>this.table.bulkPut(e))):this.table.bulkPut(e)}_encryptBulkUpdates(e){if(!this._hasEncryptedColumn())return d.resolve(e);var t=[],n=e.map(((e,n)=>this._encryptColumns(e).then((e=>{t[n]=e}))));return Promise.all(n).then((()=>t))}_encryptSingleUpdate(e){var t=this;return(0,a.default)((function*(){return t._hasEncryptedColumn()?yield t._encryptColumns(e):e}))()}asyncViewMap(e,t=!0){if(!this._hasEncryptedColumn()||!t)return Promise.resolve(e.map((e=>e?this.view(e):null)));var n=e.map((e=>null!=e?this.asyncView(e):d.resolve(null)));return d.resolve(null==o.default.currentTransaction?Promise.all(n):o.default.waitFor(Promise.all(n)))}preflightEncryptSingleRecord(e){return this.tableEncryptedColumns,Object.keys(e).forEach((t=>{this.tableEncryptedColumns.has(t)||delete e[t]})),this._encryptColumns(e)}postflightDecryptSingleRecord(e){var t=this;return(0,a.default)((function*(){var n=yield t._decryptColumns(e);return t.view(n)}))()}bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(e){return E(e,this.tableEncryptedColumns),d.resolve(this.table.bulkAdd(e)).catch((t=>{throw w(t,"bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY",this.table.name,e),t}))}bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(e){return E(e,this.tableEncryptedColumns),d.resolve(this.table.bulkPut(e)).catch((t=>{throw w(t,"bulkCreateOrReplace",this.table.name,e),t}))}create(e){var t=this.propFilter(e);return d.resolve(this._addAndEncrypt(t)).catch((t=>{throw w(t,"create",this.table.name,e),t}))}createOrReplace(e){var t=this.propFilter(e);return d.resolve(this._putAndEncrypt(t)).catch((t=>{throw w(t,"createOrReplace",this.table.name,e),t}))}createOrMerge(e,t){var n=this;return(0,a.default)((function*(){var r=n.propFilter(t),i=yield n._encryptColumns(r);return d.resolve(n.db.transaction("rw",n.table,(()=>{n.table.where(":id").equals(e).modify((e=>{Object.assign(e,i)})).then((e=>{if(1!==e)return n.table.add(i)}))})).then((()=>{}))).catch((r=>{throw w(r,"createOrMerge",n.table.name,e,t),r}))}))()}get(e){return d.resolve(this.table.get(e)).then((e=>e?this.asyncView(e):null)).catch((t=>{throw w(t,"get",this.table.name,e),t}))}merge(e,t){var n=this;return(0,a.default)((function*(){var r=n.propFilter(t),i=yield n._encryptSingleUpdate(r);return d.resolve(n.table.update(e,i)).catch((r=>{throw w(r,"merge",n.table.name,e,t),r}))}))()}remove(e){return d.resolve(this.table.delete(e)).catch((t=>{throw w(t,"remove",this.table.name,e),t}))}bulkCreate(e){var t=e.map((e=>this.propFilter(e)));return d.resolve(this.db.transaction("rw",this.table,(()=>this._bulkAddAndEncrypt(t)))).catch((t=>{throw w(t,"bulkCreate",this.table.name,e),t}))}bulkCreateOrReplace(e){var t=e.map((e=>this.propFilter(e)));return d.resolve(this.db.transaction("rw",this.table,(()=>this._bulkPutAndEncrypt(t)))).catch((t=>{throw w(t,"bulkCreateOrReplace",this.table.name,e),t}))}bulkCreateOrMerge(e){var t=this;return(0,a.default)((function*(){var n=new Map,r=t._primaryKey();function i(){return(i=(0,a.default)((function*(e){var n=t.table.where(":id").anyOf(Array.from(e.keys()));return yield n.modify((t=>{Object.assign(t,e.get(t[r])),e.delete(t[r])})),Array.from(e.values())}))).apply(this,arguments)}return(yield t._encryptBulkUpdates(e)).forEach((e=>{var i=t.propFilter(e);(0,u.default)(r in i,"Called `bulkCreateOrMerge` with item(s) not including the primary key"),n.set(i[r],i)})),d.resolve(t.db.transaction("rw",t.table,(()=>function(){return i.apply(this,arguments)}(n).then((e=>0===e.length?d.resolve():t.table.bulkPut(e)))))).catch((n=>{throw w(n,"bulkCreateOrMerge",t.table.name,e),n}))}))()}bulkGet(e,t=!0){return d.resolve(this.db.transaction("r",this.table,(()=>{var t=e.map((e=>this.table.get(e)));return o.default.Promise.all(t)}))).then((e=>this.asyncViewMap(e,t))).catch((t=>{throw w(t,"bulkGet",this.table.name,e),t}))}bulkRemove(e){return d.resolve(this.db.transaction("rw",this.table,(()=>this.table.bulkDelete(e)))).catch((t=>{throw w(t,"bulkRemove",this.table.name,e),t}))}all(e,t){var n=_(this.table.orderBy(e&&e.index?g(e.index):":id"),e);t&&(n=n.until(t));var r=null;switch(null==e?void 0:e.returnKeyType){case"keys":r=d.resolve(n.keys());break;case"primary_key":r=d.resolve(n.primaryKeys());break;default:r=d.resolve(n.toArray()).then((t=>this.asyncViewMap(t,null==e?void 0:e.shouldDecrypt)))}return r.catch((t=>{throw w(t,"all",this.table.name,e),t}))}count(){return d.resolve(this.table.count()).catch((e=>{throw w(e,"count",this.table.name),e}))}equals(e,t,n){return d.resolve(_(this.table.where(g(e)).equals(t),n).toArray()).then((e=>this.asyncViewMap(e,null==n?void 0:n.shouldDecrypt))).catch((r=>{throw w(r,"equals",this.table.name,e,t,n),r}))}anyOf(e,t,n){return d.resolve(_(this.table.where(g(e)).anyOf(t),n).toArray()).then((e=>this.asyncViewMap(e,null==n?void 0:n.shouldDecrypt))).catch((r=>{throw w(r,"anyOf",this.table.name,e,t,n),r}))}greaterThan(e,t,n){var r=n&&n.inclusive?this.table.where(g(e)).aboveOrEqual(t):this.table.where(g(e)).above(t);return d.resolve(_(r,n).toArray()).then((e=>this.asyncViewMap(e,null==n?void 0:n.shouldDecrypt))).catch((r=>{throw w(r,"greaterThan",this.table.name,e,t,n),r}))}lessThan(e,t,n){var r=n&&n.inclusive?this.table.where(g(e)).belowOrEqual(t):this.table.where(g(e)).below(t);return d.resolve(_(r,n).toArray()).then((e=>this.asyncViewMap(e))).catch((r=>{throw w(r,"lessThan",this.table.name,e,t,n),r}))}between(e,t,n,r,i){var a=_(this.table.where(g(e)).between(t,n,!(!r||!r.lowerInclusive),!(!r||!r.upperInclusive)),r),o=null;switch(null==r?void 0:r.returnKeyType){case"keys":o=d.resolve(a.keys());break;case"primary_key":o=d.resolve(a.primaryKeys());break;default:o=i?d.resolve(a.until(i).toArray()).then((()=>[])):d.resolve(a.toArray()).then((e=>this.asyncViewMap(e,null==r?void 0:r.shouldDecrypt)))}return o.catch((i=>{throw w(i,"between",this.table.name,e,t,n,r),i}))}forEachSortedBy(e,t){var n=this;return this.table.orderBy(e).each(function(){var e=(0,a.default)((function*(e){var r=yield n._decryptColumns(e);return t(r)}));return function(){return e.apply(this,arguments)}}()).catch((n=>{throw w(n,"forEachSortedBy",this.table.name,e,t),n}))}forEach(e){var t=this;return this.table.each(function(){var n=(0,a.default)((function*(n){var r=yield t._decryptColumns(n);return e(r)}));return function(){return n.apply(this,arguments)}}()).catch((t=>{throw w(t,"forEach",this.table.name,e),t}))}clear(){return d.resolve(this.table.clear()).catch((e=>{throw w(e,"clear",this.table.name),e}))}_primaryKey(){return this.table.schema.primKey.name}_hasEncryptedColumn(){return this.tableEncryptedColumns.size>0}}function m(e){if(e.length>1)return e.forEach((e=>{(0,u.default)(e.primaryKey&&e.primaryKey===c.PRIMARY_KEY_TYPE.COMPOSITE,"Invalid column passed to `formatPrimaryKey`")})),"[".concat(e.map((e=>e.name)).join("+"),"]");var t=e[0];return(0,u.default)(t.primaryKey&&t.primaryKey!==c.PRIMARY_KEY_TYPE.COMPOSITE,"Invalid column passed to `formatPrimaryKey`"),t.primaryKey===c.PRIMARY_KEY_TYPE.AUTO_INCREMENT?"".concat(t.name,"++"):t.name}function y(e){switch(e.type){case c.INDEX_TYPE.SIMPLE:return e.column;case c.INDEX_TYPE.COMPOSITE:return"[".concat(e.columns.join("+"),"]");case c.INDEX_TYPE.ARRAY:return"*".concat(e.column);case c.INDEX_TYPE.UNIQUE:return"&".concat(e.column)}throw new Error('Cannot format index of type "'.concat(e.type,'"'))}function g(e){return 1===e.length?e[0]:"[".concat(e.join("+"),"]")}function _(e,t){var n=e;return t&&t.reverse&&(n=n.reverse()),t&&null!=t.offset&&(n=n.offset(t.offset)),t&&null!=t.limit&&0!==t.limit&&(n=n.limit(t.limit)),n}function b(e){return d.resolve(e)}function w(e,t,n,...r){__LOG__(3,!0)(f(),t,n,e),__LOG__(2)(l(),t,r)}function E(e,t){var n=Array.from(t.entries());e.forEach((()=>{n.forEach((([t,n])=>{if(e[t]&&!(e[t]._keyId&&e[t]._data&&e[t].iv))throw new Error("[CRITICAL] Records contain unencrypted field")}))}))}t.default=class{constructor(e,t=b){this.tableNames=new Map,this.tableColumns=new Map,this.tableEncryptedColumns=new Map,this.name=e,this.db=new o.default(this.name),this.transformSchema=t}initialize(e,t,n){return function(e,t,n,r,i){return Promise.reduce(e,((e,a)=>i((0,c.cloneSchema)(a)).then((i=>{if((0,u.default)(!(i.name in e),"Multiple tables resulted in the same transformed name"),i.deleted)return e[i.name]=null,e;t.set(a.name,i.name),n.set(a.name,i.columns.map((e=>e.name))),r.set(a.name,i.encryptedColumns||{});var o=i.columns.filter((e=>e.primaryKey));(0,u.default)(o.length>=1,'No primary key was defined for "'.concat(a.name,'"'));var s=[m(o)].concat(i.indexes.map(y)).join(", ");return e[i.name]=s,e}))),{})}(t,this.tableNames,this.tableColumns,this.tableEncryptedColumns,this.transformSchema).then((t=>{this.db.version(e+1).stores(t).upgrade((e=>{var t;if(n)return null===(t=e[n.name])||void 0===t?void 0:t.toCollection().modify(n.callback)}))}))}open(){return d.resolve(this.db.open())}transact(e,t,n="rw"){return d.resolve(this.db.transaction(n,e,(()=>t())))}close(){return this.db.close(),d.resolve()}view(e,t,n,r){(0,u.default)(this.tableNames.has(e),'Attemped to get view for uninitialized table "'.concat(e,'"')),(0,u.default)(this.tableColumns.has(e),'Attemped to get columns for uninitialized table "'.concat(e,'"'));var i=n?function(e){if(!e)return e=>e;return t=>{var n={};return e.forEach((e=>{t.hasOwnProperty(e)&&(n[e]=t[e])})),n}}(this.tableColumns.get(e)):e=>e;return new v(this.db.table(this.tableNames.get(e)),this.db,t,i,(0,s.default)(this.tableEncryptedColumns.get(e),"this.tableEncryptedColumns.get(table)"),r)}available(){return d.resolve(!0)}reset(){return this.tableNames=new Map,d.resolve(this.db.delete()).finally((()=>{this.db=new o.default(this.name)}))}}},7433:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(6936));t.default=class{constructor(e){this._view=e}_read(e){return i.default.isLogoutInProgress?Promise.reject(new Error("dropping db read operation due to logout")):e(this._view())}_write(e){return i.default.isLogoutInProgress?Promise.reject(new Error("dropping db write operation due to logout")):e(this._view())}create(e){return this._write((t=>t.create(e)))}preflightEncryptSingleRecord(e){return this._write((t=>t.preflightEncryptSingleRecord(e)))}postflightDecryptSingleRecord(e){return this._write((t=>t.postflightDecryptSingleRecord(e)))}bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(e){return this._write((t=>t.bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(e)))}bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(e){return this._write((t=>t.bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(e)))}createOrReplace(e){return this._write((t=>t.createOrReplace(e)))}createOrMerge(e,t){return this._write((n=>n.createOrMerge(e,t)))}get(e){return this._read((t=>t.get(e)))}merge(e,t){return this._write((n=>n.merge(e,t)))}remove(e){return this._write((t=>t.remove(e)))}bulkCreate(e){return this._write((t=>t.bulkCreate(e)))}bulkCreateOrReplace(e){return this._write((t=>t.bulkCreateOrReplace(e)))}bulkCreateOrMerge(e){return this._write((t=>t.bulkCreateOrMerge(e)))}bulkGet(e,t){return this._read((n=>n.bulkGet(e,t)))}bulkRemove(e){return this._write((t=>t.bulkRemove(e)))}all(e,t){return this._read((n=>n.all(e,t)))}count(){return this._read((e=>e.count()))}equals(e,t,n){return this._read((r=>r.equals(e,t,n)))}anyOf(e,t,n){return this._read((r=>r.anyOf(e,t,n)))}greaterThan(e,t,n){return this._read((r=>r.greaterThan(e,t,n)))}lessThan(e,t,n){return this._read((r=>r.lessThan(e,t,n)))}between(e,t,n,r,i){return this._read((a=>a.between(e,t,n,r,i)))}forEachSortedBy(e,t){return this._read((n=>n.forEachSortedBy(e,t)))}forEach(e){return this._read((t=>t.forEach(e)))}clear(){return this._write((e=>e.clear()))}}},1695:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7677)),a=r(n(6053));class o extends a.default{constructor(e){super(),(0,i.default)("AbstractPrimaryKey"!==this.constructor.name,"Cannot instantiate abstract class AbstractPrimaryKey"),Array.isArray(e)?this.columns=[...e]:this.columns=[e]}validate(e){(0,i.default)(0===e.columns.length,"Attempted to add primary key after other columns")}apply(){throw new Error("Subclass of `AbstractPrimaryKey` must implement `apply` method")}}t.default=o},6879:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7677)),a=r(n(6053)),o=n(1054);class u extends a.default{constructor(e){super(),this.column=e}validate(e){var t=e.columns.find((e=>e.name===this.column));(0,i.default)(t,'Attempted to add index on non-existent column "'.concat(this.column,'" in "').concat(e.name,'"')),(0,i.default)(t&&(!t.primaryKey||t.primaryKey===o.PRIMARY_KEY_TYPE.COMPOSITE),'Cannot add index on primary key on table "'.concat(e.name,'"')),(0,i.default)(!e.indexes.some((e=>(e.type===o.INDEX_TYPE.ARRAY||e.type===o.INDEX_TYPE.SIMPLE||e.type===o.INDEX_TYPE.UNIQUE)&&(0,o.indexContainsColumn)(e,this.column))),'Attempted to add index "'.concat(this.column,'" which already exists in "').concat(e.name,'"'))}apply(e){var t=(0,o.cloneSchema)(e);return t.indexes.push(this._getIndex()),t}_getIndex(){return{type:o.INDEX_TYPE.ARRAY,column:this.column}}}t.default=u},530:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7677)),a=r(n(6053)),o=n(1054);class u extends a.default{constructor(e){super(),this.name=e}validate(e){(0,i.default)(!e.columns.find((e=>e.name===this.name)),'Attempted to add column "'.concat(this.name,'" to "').concat(e.name,'" but it already exists'))}apply(e){var t=(0,o.cloneSchema)(e);return t.columns.push({name:this.name}),t}}t.default=u},9387:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7677)),a=r(n(6053)),o=n(1054);class u extends a.default{constructor(e){super(),this.columns=[...e]}validate(e){this.columns.forEach((t=>{(0,i.default)(e.columns.find((e=>e.name===t)),'Attempted to add index on non-existent column "'.concat(t,'" in "').concat(e.name,'"'))})),(0,i.default)(this.columns.length>1,"Attempted to add composite index for only 1 column"),(0,i.default)(-1===(0,o.findIndex)(e,this._getIndex()),"Attempted to add index [".concat(String(this.columns),'], which already exists in "').concat(e.name,'"'));var t=e.columns.filter((e=>e.primaryKey&&e.primaryKey===o.PRIMARY_KEY_TYPE.COMPOSITE)).map((e=>e.name));(0,i.default)(t.length!==this.columns.length||t.some((e=>!this.columns.includes(e))),"Attempted to add index [".concat(String(this.columns),'], which already is the primary key in "').concat(e.name,'"'))}apply(e){var t=(0,o.cloneSchema)(e);return t.indexes.push(this._getIndex()),t}_getIndex(){return{type:o.INDEX_TYPE.COMPOSITE,columns:this.columns}}}t.default=u},522:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ENCRYPTED_VALUE_TYPE=void 0;var i=r(n(7677)),a=r(n(6053)),o=n(1054),u=Object.freeze({STRING:"String",ARRAY_BUFFER:"ArrayBuffer"});t.ENCRYPTED_VALUE_TYPE=u;class s extends a.default{constructor(e,t){super(),this.name=e,this.dataType=t}validate(e){(0,i.default)(!e.columns.find((e=>e.name===this.name)),'Attempted to add encrypted column "'.concat(this.name,'" to "').concat(e.name,'" but it already exists'))}apply(e){var t=(0,o.cloneSchema)(e);return t.columns.push({name:this.name}),t.encryptedColumns[this.name]=this.dataType,t}}t.default=s},146:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7677)),a=r(n(6053)),o=n(1054);class u extends a.default{constructor(e){super(),this.keyPath=e,this.column=e.split(".")[0]}validate(e){var t=e.columns.find((e=>e.name===this.column));(0,i.default)(t,'Attempted to add index on non-existent column "'.concat(this.column,'" in "').concat(e.name,'"')),(0,i.default)(t&&(!t.primaryKey||t.primaryKey===o.PRIMARY_KEY_TYPE.COMPOSITE),'Cannot add index on primary key on table "'.concat(e.name,'"')),(0,i.default)(!e.indexes.some((e=>(e.type===o.INDEX_TYPE.ARRAY||e.type===o.INDEX_TYPE.SIMPLE||e.type===o.INDEX_TYPE.UNIQUE)&&(0,o.indexContainsColumn)(e,this.column))),'Attempted to add index "'.concat(this.column,'" which already exists in "').concat(e.name,'"'))}apply(e){var t=(0,o.cloneSchema)(e);return t.indexes.push(this._getIndex()),t}_getIndex(){return{type:o.INDEX_TYPE.SIMPLE,column:this.keyPath}}}t.default=u},5745:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7677)),a=r(n(6053)),o=n(1054);class u extends a.default{constructor(e){super(),this.column=e}validate(e){var t=e.columns.find((e=>e.name===this.column));(0,i.default)(t,'Attempted to add index on non-existent column "'.concat(this.column,'" in "').concat(e.name,'"')),(0,i.default)(t&&(!t.primaryKey||t.primaryKey===o.PRIMARY_KEY_TYPE.COMPOSITE),'Cannot add index on primary key on table "'.concat(e.name,'"')),(0,i.default)(!e.indexes.some((e=>(e.type===o.INDEX_TYPE.ARRAY||e.type===o.INDEX_TYPE.SIMPLE||e.type===o.INDEX_TYPE.UNIQUE)&&(0,o.indexContainsColumn)(e,this.column))),'Attempted to add index "'.concat(this.column,'" which already exists in "').concat(e.name,'"'))}apply(e){var t=(0,o.cloneSchema)(e);return t.indexes.push(this._getIndex()),t}_getIndex(){return{type:o.INDEX_TYPE.UNIQUE,column:this.column}}}t.default=u},2948:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7677)),a=r(n(1695)),o=n(1054);class u extends a.default{validate(e){super.validate(e),(0,i.default)(this.columns&&1===this.columns.length,"Attempted to add UserDefinedPrimaryKey over wrong number of columns")}apply(e){var t=(0,o.cloneSchema)(e);return t.columns.unshift({name:this.columns[0],primaryKey:o.PRIMARY_KEY_TYPE.AUTO_INCREMENT}),t}}t.default=u},9667:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7677)),a=r(n(1695)),o=n(1054);class u extends a.default{validate(e){super.validate(e),(0,i.default)(this.columns&&this.columns.length>1,"Attempted to add composite primary key for only 1 column")}apply(e){var t=(0,o.cloneSchema)(e);return this.columns.forEach((e=>{t.columns.push({name:e,primaryKey:o.PRIMARY_KEY_TYPE.COMPOSITE})})),t}}t.default=u},6053:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7677));t.default=class{constructor(){(0,i.default)("Mutation"!==this.constructor.name,"Cannot instantiate abstract class Mutation")}validate(){throw new Error("Subclasses of Mutaton must implement `validate`")}apply(){throw new Error("Subclasses of Mutaton must implement `apply`")}}},1252:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7677)),a=r(n(6053)),o=n(1054);class u extends a.default{constructor(e){super(),this.column=e}validate(e){(0,i.default)(-1!==(0,o.findIndex)(e,this._getIndex()),'Attempted to remove non-existent index "'.concat(this.column,'" on "').concat(e.name,'"'))}apply(e){var t=(0,o.cloneSchema)(e),n=(0,o.findIndex)(e,this._getIndex());return t.indexes.splice(n,1),t}_getIndex(){return{type:o.INDEX_TYPE.ARRAY,column:this.column}}}t.default=u},6546:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7677)),a=r(n(6053)),o=n(1054);class u extends a.default{constructor(e){super(),this.name=e}validate(e){var t=e.columns.find((e=>e.name===this.name));(0,i.default)(t,'Attempted to remove column "'.concat(this.name,'" from "').concat(e.name,"\" but it doesn't exist")),(0,i.default)(!t.primaryKey,'Attempted to remove primary key column "'.concat(this.name,'". Removing primary keys is not supported.')),(0,i.default)(!e.indexes.some((e=>(0,o.indexContainsColumn)(e,this.name))),'Attempted to remove column "'.concat(this.name,'" from "').concat(e.name,'" but an index exists with the column'))}apply(e){var t=(0,o.cloneSchema)(e);return t.columns.splice(t.columns.findIndex((e=>e.name===this.name)),1),t}}t.default=u},9605:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7677)),a=r(n(6053)),o=n(1054);class u extends a.default{constructor(e){super(),this.columns=[...e].sort()}validate(e){(0,i.default)(-1!==(0,o.findIndex)(e,this._getIndex()),"Attempted to remove non-existent index [".concat(String(this.columns),'] on "').concat(e.name,'"'))}apply(e){var t=(0,o.cloneSchema)(e),n=(0,o.findIndex)(e,this._getIndex());return t.indexes.splice(n,1),t}_getIndex(){return{type:o.INDEX_TYPE.COMPOSITE,columns:this.columns}}}t.default=u},600:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7677)),a=r(n(6053)),o=n(1054);class u extends a.default{constructor(e){super(),this.column=e}validate(e){(0,i.default)(-1!==(0,o.findIndex)(e,this._getIndex()),'Attempted to remove non-existent index "'.concat(this.column,'" on "').concat(e.name,'"'))}apply(e){var t=(0,o.cloneSchema)(e),n=(0,o.findIndex)(e,this._getIndex());return t.indexes.splice(n,1),t}_getIndex(){return{type:o.INDEX_TYPE.SIMPLE,column:this.column}}}t.default=u},8642:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7677)),a=r(n(1695)),o=n(1054);class u extends a.default{validate(e){super.validate(e),(0,i.default)(this.columns&&1===this.columns.length,"Attempted to add UserDefinedPrimaryKey over wrong number of columns")}apply(e){var t=(0,o.cloneSchema)(e);return t.columns.unshift({name:this.columns[0],primaryKey:o.PRIMARY_KEY_TYPE.USER_DEFINED}),t}}t.default=u},0:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.sortMutations=function(e){return[...e].sort(_)};var i=r(n(7677)),a=r(n(6879)),o=r(n(530)),u=r(n(9387)),s=r(n(522)),c=r(n(146)),l=r(n(5745)),f=r(n(2948)),d=r(n(9667)),h=r(n(1252)),p=r(n(6546)),v=r(n(9605)),m=r(n(600)),y=r(n(8642)),g=[v.default,h.default,m.default,p.default,f.default,y.default,d.default,o.default,c.default,a.default,u.default,l.default,s.default];function _(e,t){var n=g.indexOf(e.constructor),r=g.indexOf(t.constructor);return(0,i.default)(-1!==n,"Mutation ".concat(e.constructor.name," is not a known mutation type")),(0,i.default)(-1!==r,"Mutation ".concat(e.constructor.name," is not a known mutation type")),n-r}},1054:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.emptySchema=function(e){return{name:e,columns:[],indexes:[],encryptedColumns:{}}},t.cloneSchema=function(e){return{name:e.name,columns:e.columns.map((e=>(0,i.default)({},e))),indexes:e.indexes.map(c),encryptedColumns:(0,i.default)({},e.encryptedColumns||{}),deleted:e.deleted}},t.freezeSchema=function(e){return Object.freeze({name:e.name,columns:Object.freeze(e.columns.map(Object.freeze)),indexes:Object.freeze(e.indexes.map(s)),encryptedColumns:Object.freeze((0,i.default)({},e.encryptedColumns||{})),deleted:e.deleted})},t.findIndex=function(e,t){return e.indexes.findIndex((e=>function(e,t){if(e.type!==t.type)return!1;switch(e.type){case u.SIMPLE:case u.ARRAY:case u.UNIQUE:return(0,a.default)(t.type===e.type,"Index types are not equal"),e.column===t.column;case u.COMPOSITE:return(0,a.default)(t.type===e.type,"Index types are not equal"),e.columns.length===t.columns.length&&!e.columns.some((e=>!t.columns.includes(e)))}throw new Error("cannot compare unknown indexes of types: ".concat(e.type,", ").concat(t.type))}(t,e)))},t.indexContainsColumn=function(e,t){switch(e.type){case u.SIMPLE:case u.ARRAY:case u.UNIQUE:return e.column===t;case u.COMPOSITE:return!!e.columns.find((e=>e===t))}throw new Error("cannot check indexes of unknown index type: ".concat(e.type))},t.INDEX_TYPE=t.PRIMARY_KEY_TYPE=void 0;var i=r(n(417)),a=r(n(7677)),o=Object.freeze({AUTO_INCREMENT:"auto-increment",USER_DEFINED:"user-defined",COMPOSITE:"composite"});t.PRIMARY_KEY_TYPE=o;var u=Object.freeze({SIMPLE:"simple",COMPOSITE:"composite",ARRAY:"array",UNIQUE:"unique"});function s(e){switch(e.type){case u.SIMPLE:return Object.freeze({type:u.SIMPLE,column:e.column});case u.ARRAY:return Object.freeze({type:u.ARRAY,column:e.column});case u.COMPOSITE:return Object.freeze({type:u.COMPOSITE,columns:Object.freeze(e.columns.map(Object.freeze))});case u.UNIQUE:return Object.freeze({type:u.UNIQUE,column:e.column})}throw new Error("cannot freeze index of unknown type: ".concat(e.type))}function c(e){switch(e.type){case u.SIMPLE:return{type:u.SIMPLE,column:e.column};case u.UNIQUE:return{type:u.UNIQUE,column:e.column};case u.COMPOSITE:return{type:u.COMPOSITE,columns:e.columns.map((e=>e))};case u.ARRAY:return{type:u.ARRAY,column:e.column}}throw new Error("cannot clone unknown index type: ".concat(e.type))}t.INDEX_TYPE=u},2488:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.MissingVersionError=t.InvalidVersionError=t.DuplicateVersionError=void 0;class n extends Error{}t.DuplicateVersionError=n;class r extends Error{}t.InvalidVersionError=r;class i extends Error{}t.MissingVersionError=i;t.default=class{constructor(){this.versions=new Set,this._max=-1}claim(e){if(e<0)throw new r("Versions must by greater than or equal to zero!");if(this.versions.has(e))throw new n("Version #".concat(e," has already been claimed!"));this.versions.add(e),this._max=Math.max(this.max,e)}version(e){if(e<0)throw new r("Versions must by greater than or equal to zero!");return e}validate(){for(var e=0;e<=this.max;++e)if(!this.versions.has(e))throw new i("Schema version #".concat(e," is missing!"))}get max(){return this._max}}},6957:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.NotInitializedError=t.NoSuchTableError=t.NoSuchDatabaseError=t.NoFallbackError=t.DuplicateTableError=t.DuplicateDatabaseError=t.AlreadyInitializedError=void 0;var i=r(n(7433)),a=r(n(2488)),o=r(n(8030));class u extends Error{}t.AlreadyInitializedError=u;class s extends Error{}t.DuplicateDatabaseError=s;class c extends Error{}t.DuplicateTableError=c;class l extends Error{}t.NoFallbackError=l;class f extends Error{}t.NoSuchDatabaseError=f;class d extends Error{}t.NoSuchTableError=d;class h extends Error{}t.NotInitializedError=h;t.default=class{constructor(e){this.tables=new Map,this.views=new Map,this.state=1,this.versions=new a.default,this._database=e}add(e){if(this.tables.has(e))throw new c('Table "'.concat(e,'" already added. Reuse the definition.'));var t=new o.default(e,this.versions);return this.tables.set(e,t),t}_getBackingDB(){return this._database}_unsafeGetOrCreateView(e){if(this.views.has(e))return this.views.get(e);var t=this._database.view(e.name,e.rowview,e.shouldEnablePropFilter,e.shouldUseDbMsgEncKeyForEncryptedCol);return this.views.set(e,t),t}_guardInitializedThunk(e){return()=>{if(3&this.state)throw new h("Storage must be initialized before accessing a table!");return e()}}table(e){var t=this.tables.get(e);if(!t)throw new d("Unknown table ".concat(e," requested, ensure table is defined!"));if(!this._getBackingDB())throw new f('Unable to find associated database with table "'.concat(e,'"'));return new i.default(this._guardInitializedThunk((()=>this._unsafeGetOrCreateView(t))))}lock(e,t){if(3&this.state)return Promise.reject(new h("Initialize storage before attempting to lock tables!"));for(var n=0;n<e.length;++n)if(!this.tables.has(e[n]))return Promise.reject(new d('Requested lock of unknown table "'.concat(e[n],'"')));var r=e.map((e=>{var t=this.tables.get(e);if(t)return t;throw new d('Requested lock of unknown table "'.concat(e,'"'))})).map((e=>this._unsafeGetOrCreateView(e)));return this._getBackingDB().transact(e,(()=>t(r)))}_getUpgraderForCurrentVersion(e,t){for(var n=0;n<e.length;n++)if(e[n].maxVersion===t){var r=e[n].upgraders.get(t);if(r)return{name:e[n].name,callback:r}}}initialize(){return 4&this.state?Promise.reject(new u("Storage instance has already been initialized")):(this.versions.validate(),(this._database?this._database.available():Promise.reject(new f('"'.concat(this._database.constructor.name,'" failed availability check!')))).then((()=>{var e=Array.from(this.tables.values()),t=this._getBackingDB();if(e&&t){var n=new Array(this.versions.max+1);return Promise.each(n,((n,r)=>{var i=r,a=e.map((e=>e.schema(i))).filter(Boolean);return t.initialize(r,a,this._getUpgraderForCurrentVersion(e,i))})).then((()=>t.open()))}})).then((()=>this.state=4)).then((()=>{})))}purge(){return this.state=2,this.views=new Map,this._getBackingDB().reset().then((()=>{}))}}},8030:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(417)),a=r(n(7677)),o=n(1054),u=n(0);function s(e){return e}t.default=class{constructor(e,t){this.maxVersion=-1,this.versions=new Map,this.upgraders=new Map,this.shouldEnablePropFilter=!0,this.shouldUseDbMsgEncKeyForEncryptedCol=!1,this.name=e,this.versionManager=t}version(e,t,n){this.versionManager.claim(e),(0,a.default)(!this.versions.has(e),'Table "'.concat(this.name,'" already has version #').concat(+e," defined!")),(0,a.default)(e>this.maxVersion,"Versions for table ".concat(this.name," must be defined in order")),this.maxVersion=e;var r=this.schema(e)||(0,o.emptySchema)(this.name),i=(0,u.sortMutations)(t).reduce(((e,t)=>(t.validate(e),t.apply(e))),(0,o.cloneSchema)(r));return this.versions.set(e,(0,o.freezeSchema)(i)),this.upgraders.set(e,n),this}delete(e){this.versionManager.claim(e),(0,a.default)(!this.versions.has(e),'Table "'.concat(this.name,'" already has version #').concat(+e," defined!")),(0,a.default)(e>this.maxVersion,"Versions for table ".concat(this.name," must be defined in order")),this.maxVersion=e;var t=this.schema(e)||(0,o.emptySchema)(this.name),n=(0,i.default)((0,i.default)({},t),{},{deleted:!0});return this.versions.set(e,(0,o.freezeSchema)(n)),this}view(e){return this.rowview=e,this}enablePropFilter(e){return this.shouldEnablePropFilter=e,this}useDbMsgEncKeyForEncryptedCol(e){return this.shouldUseDbMsgEncKeyForEncryptedCol=e,this}schema(e){var t=this.versions.get(e);if(t)return t;var n=Array.from(this.versions.keys()).map(s).sort(((e,t)=>e-t)).filter((t=>t<e)).pop();return n||0===n?this.versions.get(n)||(0,o.emptySchema)(this.name):null}}},4319:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.initializeWithoutGKs=function(){null==f&&((0,s.createStorage)(),(0,u.addTable)(),(0,o.addTable)(),(0,c.addTable)(),f=(0,s.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)(l()),SEND_LOGS("Failed to initialize model storage"),e})));return f},t.destroy=function(){return(0,s.destroyStorage)().catch((()=>d.resolve(new a.default(s.DATABASE_NAME).delete()))).finally((()=>{f=null}))},t.clearInitializePromise=function(){f=null};var i=r(n(9976)),a=r(n(7715)),o=n(7211),u=n(8685),s=n(7993),c=n(6001);function l(){var e=(0,i.default)(["Assertion failed!"]);return l=function(){return e},e}var f,d=n(1449).Z},5855:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("chat").version((0,u.chatCreateTable)(),[new o.default("id"),new i.default("t"),new i.default("unreadCount"),new i.default("archive"),new i.default("isReadOnly"),new i.default("isAnnounceGrpRestrict"),new i.default("modifyTag"),new i.default("muteExpiration"),new i.default("name"),new i.default("notSpam"),new i.default("pin"),new i.default("changeNumberOldJid"),new i.default("changeNumberNewJid"),new i.default("ephemeralDuration"),new i.default("ephemeralSettingTimestamp"),new i.default("unreadMsgAnchorId"),new i.default("endOfHistoryTransferType")]).view((e=>({id:e.id,t:e.t,unreadCount:e.unreadCount,unreadMsgAnchorId:e.unreadMsgAnchorId,archive:e.archive,isReadOnly:e.isReadOnly,isAnnounceGrpRestrict:e.isAnnounceGrpRestrict,modifyTag:e.modifyTag,muteExpiration:e.muteExpiration,name:e.name,notSpam:e.notSpam,pin:e.pin,changeNumberOldJid:e.changeNumberOldJid,changeNumberNewJid:e.changeNumberNewJid,endOfHistoryTransfer:e.endOfHistoryTransfer,endOfHistoryTransferType:e.endOfHistoryTransferType,ephemeralDuration:e.ephemeralDuration,ephemeralSettingTimestamp:e.ephemeralSettingTimestamp})))},t.getTable=function(){return(0,a.getStorage)().table("chat")};var i=r(n(530)),a=n(7993),o=r(n(8642)),u=n(9290)},7211:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("collection-version").version((0,u.collectionVersionCreateTable)(),[new o.default("collection"),new i.default("version"),new i.default("state"),new i.default("finiteFailureStartTime"),new i.default("ltHash")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("collection-version")};var i=r(n(530)),a=n(7993),o=r(n(8642)),u=n(9290)},2303:(e,t,n)=>{"use strict";var r=n(3291),i=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,f.getStorage)().add("message").version((0,h.messageCreateTable)(),[new d.default("id"),new o.default("internalId"),new l.default("internalId"),new o.default("rowId"),new l.default("rowId"),new o.default("type"),new o.default("subtype"),new o.default("t"),new o.default("notifyName"),new o.default("from"),new o.default("to"),new o.default("author"),new o.default("self"),new o.default("ack"),new o.default("invis"),new o.default("isStarred"),new c.default("isStarred"),new o.default("mentionedJidList"),new o.default("count"),new o.default("devicesAdded"),new o.default("devicesRemoved"),new o.default("isThisDeviceAdded"),new o.default("recipients"),new o.default("protocolMessageKey"),new o.default("templateParams"),new u.default(["internalId","isStarred"]),new o.default("vcardWAids"),new a.default("vcardWAids"),new o.default("hasLink"),new o.default("isMediaMsg"),new o.default("isDocMsg"),new u.default(["internalId","isMediaMsg"]),new u.default(["internalId","isDocMsg"]),new u.default(["internalId","hasLink"]),new o.default("offline"),new o.default("isOffline"),new s.default("offlineBuffer",s.ENCRYPTED_VALUE_TYPE.ARRAY_BUFFER),new l.default("isOffline"),new o.default("ephemeralStartTimestamp"),new o.default("ephemeralDuration"),new o.default("ephemeralSettingTimestamp"),new o.default("ephemeralOutOfSync"),new o.default("expiredTimestamp"),new c.default("expiredTimestamp"),new o.default("directPath"),new o.default("mimetype"),new o.default("duration"),new o.default("filehash"),new o.default("uploadhash"),new o.default("size"),new o.default("filename"),new o.default("streamingSidecar"),new o.default("mediaKey"),new o.default("mediaKeyTimestamp"),new o.default("pageCount"),new o.default("isGif"),new o.default("gifAttribution"),new o.default("isViewOnce"),new o.default("width"),new o.default("height"),new o.default("scanLengths"),new o.default("scansSidecar"),new o.default("interactiveAnnotations"),new o.default("firstFrameLength"),new o.default("firstFrameSidecar"),new o.default("isAnimated"),new o.default("thumbnail"),new o.default("richPreviewType"),new o.default("doNotPlayInline"),new o.default("broadcast"),new o.default("broadcastParticipants"),new o.default("broadcastId"),new o.default("quotedMsg"),new o.default("quotedStanzaID"),new o.default("quotedRemoteJid"),new o.default("quotedParticipant"),new o.default("footer"),new o.default("hydratedButtons"),new o.default("selectedId"),new o.default("selectedIndex"),new o.default("vcardFormattedName"),new o.default("isVcardOverMmsDocument"),new o.default("businessOwnerJid"),new o.default("productId"),new o.default("currencyCode"),new o.default("priceAmount1000"),new o.default("retailerId"),new o.default("url"),new o.default("productImageCount"),new o.default("paymentCurrency"),new o.default("paymentMessageReceiverJid"),new o.default("paymentTransactionTimestamp"),new o.default("paymentStatus"),new o.default("paymentNoteMsg"),new o.default("paymentRequestMessageKey"),new o.default("paymentExpiryTimestamp"),new o.default("message"),new o.default("orderTitle"),new o.default("itemCount"),new o.default("orderId"),new o.default("surface"),new o.default("status"),new o.default("token"),new o.default("textColor"),new o.default("backgroundColor"),new o.default("font"),new o.default("isForwarded"),new o.default("forwardingScore"),new o.default("ctwaContext"),new o.default("mdDowngrade"),new o.default("messageRangeIndex"),new c.default("messageRangeIndex"),new o.default("vcardList"),new o.default("totalAmount1000"),new o.default("totalCurrencyCode"),new o.default("list"),new o.default("listResponse"),new o.default("isDynamicReplyButtonsMsg"),new o.default("dynamicReplyButtons"),new o.default("selectedButtonId"),new o.default("sellerJid"),new o.default("deprecatedMms3Url"),new o.default("encFilehash"),new s.default("msgRowOpaqueData",s.ENCRYPTED_VALUE_TYPE.ARRAY_BUFFER)]).view((e=>e)).enablePropFilter(!0).useDbMsgEncKeyForEncryptedCol(!0)},t.getTable=function(){return(0,f.getStorage)().table("message")};var a=i(n(6879)),o=i(n(530)),u=i(n(9387)),s=r(n(522)),c=i(n(146)),l=i(n(5745)),f=n(7993),d=i(n(8642)),h=n(9290)},8685:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,u.getStorage)().add("pending-mutations").version((0,s.pendingMutationsCreateTable)(),[new o.default("id"),new i.default("collection"),new i.default("index"),new a.default("index"),new i.default("timestamp"),new a.default("collection"),new i.default("version"),new i.default("operation"),new i.default("binarySyncAction")]).view((e=>e))},t.getTable=function(){return(0,u.getStorage)().table("pending-mutations")};var i=r(n(530)),a=r(n(146)),o=r(n(2948)),u=n(7993),s=n(9290)},6001:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,u.getStorage)().add("sync-actions").version((0,c.syncActionsCreateTable)(),[new s.default("index"),new i.default("keyId"),new i.default("version"),new i.default("actionState"),new o.default("actionState"),new i.default("modelId"),new i.default("modelType"),new a.default(["modelId","modelType","actionState"]),new i.default("valueMac"),new i.default("indexMac"),new o.default("indexMac"),new i.default("collection"),new o.default("collection"),new i.default("timestamp"),new i.default("action"),new o.default("action"),new i.default("binarySyncAction")]).view((e=>e))},t.getTable=function(){return(0,u.getStorage)().table("sync-actions")};var i=r(n(530)),a=r(n(9387)),o=r(n(146)),u=(n(3487),n(7993)),s=r(n(8642)),c=n(9290)},7993:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.createStorage=function(){var e=new a.default(u);s=new o.default(e)},t.getStorage=function(){return(0,i.default)(null!=s,"[model-storage] Storage should be created first before being accessed"),s},t.destroyStorage=function(){if(null==s)return Promise.reject(new Error("[model-storage] Storage should be created first before being destroyed"));return s.purge().then((()=>{s=null})).catch((e=>{throw s=null,e}))},t.DATABASE_NAME=void 0;var i=r(n(7677)),a=r(n(2206)),o=r(n(6957)),u="model-storage";t.DATABASE_NAME=u;var s=null},3012:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=function(){return(0,i.initializeWithoutGKs)().then((()=>(0,r.getTable)().all().then((e=>Promise.all(e.map((e=>{var t=e.id||"";return(0,a.getTable)().between(["internalId"],"".concat(e.id,"_/"),"".concat(e.id,"_g"),{reverse:!0,limit:20}).then((e=>e.length>0&&null!=e[0].isOffline?{chatId:t,messages:[e[0]]}:{chatId:t,messages:e.reverse()}))}))).then((t=>[e,t]))))))};var r=n(5855),i=n(4319),a=n(2303);self.Promise=n(1449).Z},9290:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pendingMutationsCreateTable=function(){return(0,r.getStorage)().versions.version(0)},t.collectionVersionCreateTable=function(){return(0,r.getStorage)().versions.version(1)},t.syncActionsCreateTable=function(){return(0,r.getStorage)().versions.version(2)},t.contactCreateTable=function(){return(0,r.getStorage)().versions.version(3)},t.blocklistCreateTable=function(){return(0,r.getStorage)().versions.version(4)},t.profilePicThumbCreateTable=function(){return(0,r.getStorage)().versions.version(5)},t.chatCreateTable=function(){return(0,r.getStorage)().versions.version(6)},t.messageCreateTable=function(){return(0,r.getStorage)().versions.version(7)},t.messageInfoCreateTable=function(){return(0,r.getStorage)().versions.version(8)},t.participantCreateTable=function(){return(0,r.getStorage)().versions.version(9)},t.orphanReceiptCreateTable=function(){return(0,r.getStorage)().versions.version(10)},t.deviceListCreateTable=function(){return(0,r.getStorage)().versions.version(11)},t.inactiveReceiptCreateTable=function(){return(0,r.getStorage)().versions.version(12)},t.verifiedBusinessNameCreateTable=function(){return(0,r.getStorage)().versions.version(13)},t.historySyncNotificationsCreateTable=function(){return(0,r.getStorage)().versions.version(14)},t.encryptedMutationsCreateTable=function(){return(0,r.getStorage)().versions.version(15)},t.labelCreateTable=function(){return(0,r.getStorage)().versions.version(16)},t.labelAssociationCreateTable=function(){return(0,r.getStorage)().versions.version(17)},t.quickReplyCreateTable=function(){return(0,r.getStorage)().versions.version(18)},t.abpropsConfigCreateTable=function(){return(0,r.getStorage)().versions.version(19)},t.groupMetadataCreateTable=function(){return(0,r.getStorage)().versions.version(20)},t.syncKeysCreateTable=function(){return(0,r.getStorage)().versions.version(21)},t.tasksScheduledTimeCreateTable=function(){return(0,r.getStorage)().versions.version(22)},t.activeMessageRangesCreateTable=function(){return(0,r.getStorage)().versions.version(23)},t.ftsIndexingQueueCreateTable=function(){return(0,r.getStorage)().versions.version(24)},t.cartCreateTable=function(){return(0,r.getStorage)().versions.version(25)},t.missingKeysCreateTable=function(){return(0,r.getStorage)().versions.version(26)};var r=n(7993)},1198:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(var n=[],r=e.length,i=t.length,a=Math.max(r,i),o=0;o<a;o++)o<r&&n.push(e[o]),o<i&&n.push(t[o]);return n}},6890:(e,t,n)=>{"use strict";var r=n(4859);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r=String){var a=(0,i.default)(e,t.map(r)).join(""),o=n?4e3:Number.POSITIVE_INFINITY;a.length>o&&(a=a.slice(0,o).replace(/\s+$/," [truncated]"));return a};var i=r(n(1198))},1985:(e,t)=>{"use strict";function n(e,t){var r=function(...n){var i=t?t.apply(this,n):n[0];if(!i)return e.apply(this,n);var a=r.cache;if(a.has(i))return a.get(i);var o=e.apply(this,n);return r.cache=a.set(i,o)||a,o};return r.cache=new(n.Cache||Map),r}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n.Cache=Map;var r=n;t.default=r},1941:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t="?"){if(null==e)throw new Error("Unexpected null or undefined: ".concat(t));return e}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{self.Promise=n(1449).Z;var{log:e,sendLogs:t}=n(9458);self.__LOG__=e,self.SEND_LOGS=t;(0,n(2186).Z)().then((()=>{self.addEventListener("message",(()=>{}))}))})()})();