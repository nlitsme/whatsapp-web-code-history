/*! Copyright (c) 2023 WhatsApp Inc. All Rights Reserved. */
(self.webpackChunkwhatsapp_web_client=self.webpackChunkwhatsapp_web_client||[]).push([[6235],{273925:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JobBuilder=void 0,t.definePersistedJob=function(){return new o([])};var r=n(811158),s=n(632157);class o{constructor(e){this.steps=e}step(e,t){return this._stepWithOptions(e,"function"==typeof t?{code:t}:t)}_stepWithOptions(e,t){const{stopRetryIf:n,requirements:u,code:c}=t;let l=a(u,c,n);if(n){const{timePassedSeconds:e,appCrashed:t,onStopRetry:o}=n,u=a(null,function(e){return(t,n,s)=>Promise.resolve(e(t,n,s)).then((e=>e instanceof r.InterruptJob?e:new r.InterruptJob(e)))}(o),n);null!=e&&(l=i(((t,n,r)=>{let{jobStartTime:o}=r;return(0,s.happenedWithin)(o,e)}),l,u)),t&&(l=i(((e,t,n)=>{let{afterCrash:r}=n;return!r}),l,u))}return new o([...this.steps,{stepName:e,info:l}])}finalStep(e,t){const n=this.step(e,t);return{end:()=>n.steps}}}function i(e,t,n){return(r,s,o)=>e(r,s,o)?t(r,s,o):n(r,s,o)}function a(e,t,n){const r={requirements:e,code:t,stopRetryIf:n};return()=>r}t.JobBuilder=o},193182:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defineWebPersistedJob=function(){return(0,r.definePersistedJob)()};var r=n(273925)},69056:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteReactionsByParentMessageKey=function(e){const t=[];return(0,o.getStorage)().lock(["reactions"],function(){var n=(0,s.default)((function*(n){let[r]=n;return(yield r.equals(["parentMsgKey"],e)).forEach((e=>t.push([e.parentMsgKey,e.senderUserJid]))),r.bulkRemove(t)}));return function(){return n.apply(this,arguments)}}())},t.deleteReactionsByParentMessageKeys=function(e){const t=[];return(0,o.getStorage)().lock(["reactions"],function(){var n=(0,s.default)((function*(n){let[r]=n;const s=yield r.anyOf(["parentMsgKey"],e);return s.forEach((e=>t.push([e.parentMsgKey,e.senderUserJid]))),yield r.bulkRemove(t),s.map((e=>e.msgKey))}));return function(){return n.apply(this,arguments)}}())},t.deleteReactionsByRecords=function(e){return(0,o.getStorage)().lock(["reactions"],function(){var t=(0,s.default)((function*(t){let[n]=t;yield n.bulkRemove(e)}));return function(){return t.apply(this,arguments)}}())};var s=r(n(348926)),o=n(732011)},116235:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteReations=void 0;var s=r(n(348926)),o=n(69056),i=n(384766),a=n(193182),u=r(n(565754));const c=(0,a.defineWebPersistedJob)().step("deleteReactions",(e=>{let{chatId:t,parentMsgKeys:n}=e;return __LOG__(2)`Persisted: deleteReaction persisted job started`,{chatId:t,parentMsgKeys:n}})).step("deleteReactionsFromReactionsTable",function(){var e=(0,s.default)((function*(e){let{chatId:t,parentMsgKeys:n}=e;const r=yield(0,o.deleteReactionsByParentMessageKeys)(n);return r||(__LOG__(2)`Persisted: Deleting reactions from Reactions table returned undefined, parentMsgKeys length ${n.length}`,[])}));return function(){return e.apply(this,arguments)}}()).finalStep("deleteReactionsFromMessageTable",function(){var e=(0,s.default)((function*(e,t){let{chatId:n,parentMsgKeys:r}=t;const s=[];return e||__LOG__(2)`Persisted: Deleting reactions from Msg table, reactionMsgKeys is undefined, parentMsgKeys length ${r.length}`,e.forEach((e=>{u.default.fromString(e).fromMe&&s.push(e)})),s.length>0&&(yield(0,i.removeMessagesFromHistory)(s)),e}));return function(){return e.apply(this,arguments)}}()).end();t.deleteReations=c}}]);
//# sourceMappingURL=https://web.whatsapp.com/6235.962c3cd8f396422e07c2.js.map
